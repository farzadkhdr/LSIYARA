<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Car Rental Management System</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #4361ee;
            --secondary: #3f37c9;
            --success: #4cc9f0;
            --info: #4895ef;
            --warning: #f72585;
            --danger: #e63946;
            --light: #f8f9fa;
            --dark: #212529;
            --sidebar-bg: #2b2d42;
            --sidebar-hover: #3d405b;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f5f7fb;
            color: #333;
            overflow-x: hidden;
        }
        
        .sidebar {
            background-color: var(--sidebar-bg);
            color: white;
            height: 100vh;
            position: fixed;
            transition: all 0.3s;
            overflow-y: auto;
            z-index: 1000;
        }
        
        .sidebar .nav-link {
            color: rgba(255, 255, 255, 0.8);
            padding: 12px 20px;
            margin: 5px 0;
            border-radius: 5px;
            transition: all 0.3s;
            cursor: pointer;
        }
        
        .sidebar .nav-link:hover, .sidebar .nav-link.active {
            background-color: var(--sidebar-hover);
            color: white;
        }
        
        .sidebar .nav-link i {
            margin-right: 10px;
            width: 20px;
            text-align: center;
        }
        
        .main-content {
            margin-left: 250px;
            padding: 20px;
            transition: all 0.3s;
            min-height: 100vh;
        }
        
        .card {
            border: none;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
            transition: transform 0.3s;
        }
        
        .card:hover {
            transform: translateY(-5px);
        }
        
        .card-header {
            background-color: white;
            border-bottom: 1px solid #eaeaea;
            font-weight: 600;
            padding: 15px 20px;
            border-radius: 10px 10px 0 0 !important;
        }
        
        .dashboard-card {
            text-align: center;
            padding: 20px;
        }
        
        .dashboard-card i {
            font-size: 2.5rem;
            margin-bottom: 15px;
        }
        
        .stats-number {
            font-size: 2rem;
            font-weight: 700;
        }
        
        .stats-label {
            font-size: 0.9rem;
            color: #6c757d;
        }
        
        .btn-primary {
            background-color: var(--primary);
            border: none;
        }
        
        .btn-primary:hover {
            background-color: var(--secondary);
        }
        
        .table th {
            background-color: #f8f9fa;
            font-weight: 600;
        }
        
        .search-box {
            position: relative;
        }
        
        .search-box input {
            padding-right: 40px;
        }
        
        .search-box i {
            position: absolute;
            right: 15px;
            top: 12px;
            color: #6c757d;
        }
        
        .car-image, .customer-image {
            width: 60px;
            height: 60px;
            object-fit: cover;
            border-radius: 5px;
        }
        
        .status-available {
            color: #28a745;
            font-weight: 600;
        }
        
        .status-rented {
            color: #dc3545;
            font-weight: 600;
        }
        
        .logo-container {
            padding: 20px;
            text-align: center;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .logo {
            max-width: 150px;
            height: auto;
        }
        
        .action-buttons .btn {
            margin-right: 5px;
        }
        
        .section {
            display: none;
            animation: fadeIn 0.5s ease-in;
        }
        
        .section.active {
            display: block;
        }
        
        .autocomplete-items {
            position: absolute;
            border: 1px solid #d4d4d4;
            border-bottom: none;
            border-top: none;
            z-index: 99;
            top: 100%;
            left: 0;
            right: 0;
            background-color: white;
            max-height: 200px;
            overflow-y: auto;
        }
        
        .autocomplete-items div {
            padding: 10px;
            cursor: pointer;
            background-color: #fff;
            border-bottom: 1px solid #d4d4d4;
        }
        
        .autocomplete-items div:hover {
            background-color: #e9e9e9;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .mobile-menu-btn {
            display: none;
            position: fixed;
            top: 15px;
            left: 15px;
            z-index: 1100;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 5px;
            padding: 8px 12px;
            font-size: 1.2rem;
        }
        
        .overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            z-index: 999;
        }
        
        @media (max-width: 768px) {
            .sidebar {
                width: 250px;
                transform: translateX(-100%);
            }
            
            .sidebar.mobile-open {
                transform: translateX(0);
            }
            
            .main-content {
                margin-left: 0;
            }
            
            .mobile-menu-btn {
                display: block;
            }
            
            .overlay.mobile-open {
                display: block;
            }
            
            .logo-container {
                padding: 15px;
            }
        }
    </style>
</head>
<body>
    <!-- Mobile Menu Button -->
    <button class="mobile-menu-btn" id="mobileMenuBtn">
        <i class="fas fa-bars"></i>
    </button>
    
    <!-- Overlay for mobile -->
    <div class="overlay" id="overlay"></div>
    
    <div class="container-fluid">
        <div class="row">
            <!-- Sidebar -->
            <div class="col-md-2 sidebar p-0" id="sidebar">
                <div class="logo-container">
                    <img src="https://via.placeholder.com/150x50/4361ee/ffffff?text=CarRental" alt="Logo" class="logo" id="systemLogo">
                    <h5 class="mt-2 d-none d-md-block" id="systemName">CarRental Pro</h5>
                </div>
                <nav class="nav flex-column p-3">
                    <a class="nav-link active" data-section="dashboard"><i class="fas fa-tachometer-alt"></i> <span>Dashboard</span></a>
                    <a class="nav-link" data-section="car-inventory"><i class="fas fa-car"></i> <span>Car Inventory</span></a>
                    <a class="nav-link" data-section="customers"><i class="fas fa-users"></i> <span>Customers</span></a>
                    <a class="nav-link" data-section="rentals"><i class="fas fa-handshake"></i> <span>Rentals</span></a>
                    <a class="nav-link" data-section="returns"><i class="fas fa-undo"></i> <span>Returns</span></a>
                    <a class="nav-link" data-section="payments"><i class="fas fa-money-bill-wave"></i> <span>Payments</span></a>
                    <a class="nav-link" data-section="reports"><i class="fas fa-chart-bar"></i> <span>Reports</span></a>
                    <a class="nav-link" data-section="settings"><i class="fas fa-cog"></i> <span>Settings</span></a>
                    <a class="nav-link" data-section="backup"><i class="fas fa-database"></i> <span>Backup</span></a>
                </nav>
                <div class="p-3 mt-auto">
                    <div class="text-center text-muted small">
                        Developed by <span id="developerName">farzad programmer</span>
                    </div>
                </div>
            </div>
            
            <!-- Main Content -->
            <div class="col-md-10 main-content" id="mainContent">
                <!-- Dashboard Section -->
                <div class="section active" id="dashboard">
                    <div class="d-flex justify-content-between align-items-center mb-4">
                        <h2>Dashboard</h2>
                        <div class="d-flex">
                            <div class="search-box me-3">
                                <input type="text" class="form-control" placeholder="Search...">
                                <i class="fas fa-search"></i>
                            </div>
                            <div class="dropdown">
                                <button class="btn btn-outline-secondary dropdown-toggle" type="button" id="dropdownMenuButton" data-bs-toggle="dropdown" aria-expanded="false">
                                    <i class="fas fa-user-circle me-1"></i> Admin
                                </button>
                                <ul class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                                    <li><a class="dropdown-item" href="#">Profile</a></li>
                                    <li><a class="dropdown-item" href="#">Settings</a></li>
                                    <li><hr class="dropdown-divider"></li>
                                    <li><a class="dropdown-item" href="#">Logout</a></li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Stats Cards -->
                    <div class="row">
                        <div class="col-md-3">
                            <div class="card dashboard-card">
                                <i class="fas fa-money-bill-wave text-success"></i>
                                <div class="stats-number" id="totalPayments">$12,540</div>
                                <div class="stats-label">Total Payments</div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="card dashboard-card">
                                <i class="fas fa-car text-primary"></i>
                                <div class="stats-number" id="rentedCars">24</div>
                                <div class="stats-label">Rented Cars</div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="card dashboard-card">
                                <i class="fas fa-warehouse text-info"></i>
                                <div class="stats-number" id="carsInStock">42</div>
                                <div class="stats-label">Cars in Stock</div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="card dashboard-card">
                                <i class="fas fa-users text-warning"></i>
                                <div class="stats-number" id="totalCustomers">68</div>
                                <div class="stats-label">Total Customers</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Recent Rentals and Cars -->
                    <div class="row mt-4">
                        <div class="col-md-8">
                            <div class="card">
                                <div class="card-header d-flex justify-content-between align-items-center">
                                    <span>Recent Rentals</span>
                                    <a href="#" class="btn btn-sm btn-primary">View All</a>
                                </div>
                                <div class="card-body">
                                    <div class="table-responsive">
                                        <table class="table table-hover">
                                            <thead>
                                                <tr>
                                                    <th>Customer</th>
                                                    <th>Car Model</th>
                                                    <th>Rent Date</th>
                                                    <th>Return Date</th>
                                                    <th>Status</th>
                                                    <th>Actions</th>
                                                </tr>
                                            </thead>
                                            <tbody id="recentRentalsTable">
                                                <!-- Data will be populated by JavaScript -->
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-md-4">
                            <div class="card">
                                <div class="card-header d-flex justify-content-between align-items-center">
                                    <span>Available Cars</span>
                                    <a href="#" class="btn btn-sm btn-primary">View All</a>
                                </div>
                                <div class="card-body">
                                    <div class="list-group" id="availableCarsList">
                                        <!-- Data will be populated by JavaScript -->
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Car Inventory Section -->
                <div class="section" id="car-inventory">
                    <div class="d-flex justify-content-between align-items-center mb-4">
                        <h2>Car Inventory</h2>
                        <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addCarModal">
                            <i class="fas fa-plus me-1"></i> Add New Car
                        </button>
                    </div>
                    
                    <div class="card">
                        <div class="card-header d-flex justify-content-between align-items-center">
                            <span>All Cars</span>
                            <div class="search-box">
                                <input type="text" class="form-control" id="carSearch" placeholder="Search by car name or license...">
                                <i class="fas fa-search"></i>
                            </div>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-hover">
                                    <thead>
                                        <tr>
                                            <th>Image</th>
                                            <th>Car Model</th>
                                            <th>Color</th>
                                            <th>License</th>
                                            <th>Daily Rate</th>
                                            <th>Status</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="carsTable">
                                        <!-- Data will be populated by JavaScript -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Customers Section -->
                <div class="section" id="customers">
                    <div class="d-flex justify-content-between align-items-center mb-4">
                        <h2>Customers</h2>
                        <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addCustomerModal">
                            <i class="fas fa-plus me-1"></i> Add New Customer
                        </button>
                    </div>
                    
                    <div class="card">
                        <div class="card-header d-flex justify-content-between align-items-center">
                            <span>All Customers</span>
                            <div class="search-box">
                                <input type="text" class="form-control" id="customerSearch" placeholder="Search by customer name...">
                                <i class="fas fa-search"></i>
                            </div>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-hover">
                                    <thead>
                                        <tr>
                                            <th>Image</th>
                                            <th>Full Name</th>
                                            <th>Phone</th>
                                            <th>ID Type</th>
                                            <th>ID Number</th>
                                            <th>Debt</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="customersTable">
                                        <!-- Data will be populated by JavaScript -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Rentals Section -->
                <div class="section" id="rentals">
                    <div class="d-flex justify-content-between align-items-center mb-4">
                        <h2>Rentals</h2>
                        <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addRentalModal">
                            <i class="fas fa-plus me-1"></i> New Rental
                        </button>
                    </div>
                    
                    <div class="card">
                        <div class="card-header d-flex justify-content-between align-items-center">
                            <span>All Rentals</span>
                            <div class="d-flex">
                                <div class="search-box me-2">
                                    <input type="text" class="form-control" id="rentalCustomerSearch" placeholder="Search by customer name...">
                                    <i class="fas fa-search"></i>
                                </div>
                                <div class="search-box">
                                    <input type="text" class="form-control" id="rentalCarSearch" placeholder="Search by car name...">
                                    <i class="fas fa-search"></i>
                                </div>
                            </div>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-hover">
                                    <thead>
                                        <tr>
                                            <th>Customer</th>
                                            <th>Car Model</th>
                                            <th>Rent Date</th>
                                            <th>Return Date</th>
                                            <th>Total Amount</th>
                                            <th>Penalty</th>
                                            <th>Status</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="rentalsTable">
                                        <!-- Data will be populated by JavaScript -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Returns Section -->
                <div class="section" id="returns">
                    <div class="d-flex justify-content-between align-items-center mb-4">
                        <h2>Car Returns</h2>
                    </div>
                    
                    <div class="card">
                        <div class="card-header d-flex justify-content-between align-items-center">
                            <span>Return History</span>
                            <div class="d-flex">
                                <input type="date" class="form-control me-2" id="returnDateFilter">
                                <button class="btn btn-primary" id="filterReturns">Filter</button>
                            </div>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-hover">
                                    <thead>
                                        <tr>
                                            <th>Customer</th>
                                            <th>Car Model</th>
                                            <th>Return Date</th>
                                            <th>Final Amount</th>
                                            <th>Penalty</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="returnsTable">
                                        <!-- Data will be populated by JavaScript -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Payments Section -->
                <div class="section" id="payments">
                    <div class="d-flex justify-content-between align-items-center mb-4">
                        <h2>Payments</h2>
                    </div>
                    
                    <div class="card">
                        <div class="card-header d-flex justify-content-between align-items-center">
                            <span>Payment Records</span>
                            <div class="search-box">
                                <input type="text" class="form-control" id="paymentCustomerSearch" placeholder="Search by customer name...">
                                <i class="fas fa-search"></i>
                            </div>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-hover">
                                    <thead>
                                        <tr>
                                            <th>Customer</th>
                                            <th>Amount Paid</th>
                                            <th>Payment Date</th>
                                            <th>Remaining Debt</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="paymentsTable">
                                        <!-- Data will be populated by JavaScript -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Reports Section -->
                <div class="section" id="reports">
                    <div class="d-flex justify-content-between align-items-center mb-4">
                        <h2>Reports</h2>
                    </div>
                    
                    <div class="card">
                        <div class="card-header">
                            <span>Generate Reports</span>
                        </div>
                        <div class="card-body">
                            <div class="row mb-3">
                                <div class="col-md-4">
                                    <label for="reportStartDate">Start Date</label>
                                    <input type="date" class="form-control" id="reportStartDate">
                                </div>
                                <div class="col-md-4">
                                    <label for="reportEndDate">End Date</label>
                                    <input type="date" class="form-control" id="reportEndDate">
                                </div>
                                <div class="col-md-4">
                                    <label for="reportSearch">Search (Car or Customer)</label>
                                    <input type="text" class="form-control" id="reportSearch" placeholder="Search...">
                                </div>
                            </div>
                            <button class="btn btn-primary" id="generateReport">Generate Report</button>
                            
                            <div class="mt-4" id="reportResults">
                                <!-- Report results will be displayed here -->
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Settings Section -->
                <div class="section" id="settings">
                    <div class="d-flex justify-content-between align-items-center mb-4">
                        <h2>Settings</h2>
                    </div>
                    
                    <div class="card">
                        <div class="card-header">
                            <span>System Settings</span>
                        </div>
                        <div class="card-body">
                            <div class="mb-3">
                                <label for="systemLogoUpload" class="form-label">System Logo</label>
                                <input class="form-control" type="file" id="systemLogoUpload">
                                <button class="btn btn-primary mt-2" id="uploadLogo">Upload Logo</button>
                            </div>
                            
                            <div class="mb-3">
                                <label for="systemNameInput" class="form-label">System Name</label>
                                <input type="text" class="form-control" id="systemNameInput" value="CarRental Pro">
                            </div>
                            
                            <div class="mb-3">
                                <label for="systemMessages" class="form-label">System Messages</label>
                                <textarea class="form-control" id="systemMessages" rows="3"></textarea>
                            </div>
                            
                            <div class="mb-3">
                                <label class="form-label">Developer</label>
                                <input type="text" class="form-control" id="developerNameInput" value="farzad programmer" readonly>
                            </div>
                            
                            <button class="btn btn-primary" id="saveSettings">Save Settings</button>
                        </div>
                    </div>
                </div>
                
                <!-- Backup Section -->
                <div class="section" id="backup">
                    <div class="d-flex justify-content-between align-items-center mb-4">
                        <h2>Backup & Restore</h2>
                    </div>
                    
                    <div class="card">
                        <div class="card-header">
                            <span>Data Management</span>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-4">
                                    <div class="card dashboard-card">
                                        <i class="fas fa-download text-primary"></i>
                                        <div class="stats-number">Create Backup</div>
                                        <button class="btn btn-primary mt-2" id="createBackup">Create Backup</button>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="card dashboard-card">
                                        <i class="fas fa-upload text-success"></i>
                                        <div class="stats-number">Restore Backup</div>
                                        <input class="form-control mt-2" type="file" id="restoreBackupFile">
                                        <button class="btn btn-success mt-2" id="restoreBackup">Restore Backup</button>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="card dashboard-card">
                                        <i class="fas fa-history text-info"></i>
                                        <div class="stats-number">Backup History</div>
                                        <button class="btn btn-info mt-2" id="viewBackupHistory">View History</button>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="mt-4" id="backupHistory">
                                <!-- Backup history will be displayed here -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Car Modal -->
    <div class="modal fade" id="addCarModal" tabindex="-1" aria-labelledby="addCarModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="addCarModalLabel">Add New Car</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="addCarForm">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="carModel" class="form-label">Car Model</label>
                                    <input type="text" class="form-control" id="carModel" required>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="carColor" class="form-label">Car Color</label>
                                    <input type="text" class="form-control" id="carColor" required>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="carLicense" class="form-label">License Number</label>
                                    <input type="text" class="form-control" id="carLicense" required>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="dailyRate" class="form-label">Daily Rate ($)</label>
                                    <input type="number" class="form-control" id="dailyRate" required>
                                </div>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="carImage" class="form-label">Car Image</label>
                            <input class="form-control" type="file" id="carImage">
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" id="saveCar">Save Car</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Customer Modal -->
    <div class="modal fade" id="addCustomerModal" tabindex="-1" aria-labelledby="addCustomerModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="addCustomerModalLabel">Add New Customer</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="addCustomerForm">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="customerFullName" class="form-label">Full Name</label>
                                    <input type="text" class="form-control" id="customerFullName" required>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="customerPhone" class="form-label">Phone Number</label>
                                    <input type="text" class="form-control" id="customerPhone" required>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="idType" class="form-label">ID Type</label>
                                    <select class="form-control" id="idType" required>
                                        <option value="">Select ID Type</option>
                                        <option value="Passport">Passport</option>
                                        <option value="Driver License">Driver License</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="idNumber" class="form-label">ID Number</label>
                                    <input type="text" class="form-control" id="idNumber" required>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="nationality" class="form-label">Nationality</label>
                                    <input type="text" class="form-control" id="nationality" required>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="customerAddress" class="form-label">Address</label>
                                    <input type="text" class="form-control" id="customerAddress" required>
                                </div>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="customerNotes" class="form-label">Notes</label>
                            <textarea class="form-control" id="customerNotes" rows="3"></textarea>
                        </div>
                        <div class="mb-3">
                            <label for="customerImage" class="form-label">ID Image</label>
                            <input class="form-control" type="file" id="customerImage">
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" id="saveCustomer">Save Customer</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Rental Modal -->
    <div class="modal fade" id="addRentalModal" tabindex="-1" aria-labelledby="addRentalModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="addRentalModalLabel">New Rental</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="addRentalForm">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="rentalCustomer" class="form-label">Customer</label>
                                    <input type="text" class="form-control" id="rentalCustomer" placeholder="Search customer...">
                                    <div id="customerAutocomplete" class="autocomplete-items"></div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="rentalCar" class="form-label">Car</label>
                                    <input type="text" class="form-control" id="rentalCar" placeholder="Search car...">
                                    <div id="carAutocomplete" class="autocomplete-items"></div>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="rentOutDate" class="form-label">Rent Out Date</label>
                                    <input type="date" class="form-control" id="rentOutDate" required>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="returnDate" class="form-label">Return Date</label>
                                    <input type="date" class="form-control" id="returnDate" required>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="penaltyCheck" class="form-label">Add 5% Penalty?</label>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="penaltyCheck">
                                        <label class="form-check-label" for="penaltyCheck">
                                            Yes, add 5% penalty
                                        </label>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="penaltyAmount" class="form-label">Penalty Amount ($)</label>
                                    <input type="number" class="form-control" id="penaltyAmount" value="0">
                                </div>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="totalAmount" class="form-label">Total Amount ($)</label>
                            <input type="number" class="form-control" id="totalAmount" readonly>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" id="saveRental">Save Rental</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Sample data for demonstration
        let cars = JSON.parse(localStorage.getItem('cars')) || [
            { id: 1, model: "Toyota Camry", color: "Blue", license: "ABC123", dailyRate: 50, status: "available", image: "" },
            { id: 2, model: "Honda Civic", color: "Red", license: "DEF456", dailyRate: 45, status: "available", image: "" },
            { id: 3, model: "Ford Mustang", color: "Black", license: "GHI789", dailyRate: 80, status: "rented", image: "" },
            { id: 4, model: "BMW X5", color: "White", license: "JKL012", dailyRate: 120, status: "available", image: "" }
        ];
        
        let customers = JSON.parse(localStorage.getItem('customers')) || [
            { id: 1, name: "John Smith", phone: "123-456-7890", idNumber: "P12345678", idType: "Passport", nationality: "American", address: "123 Main St", notes: "", image: "", debt: 0 },
            { id: 2, name: "Sarah Johnson", phone: "234-567-8901", idNumber: "D87654321", idType: "Driver License", nationality: "Canadian", address: "456 Oak Ave", notes: "", image: "", debt: 150 },
            { id: 3, name: "Michael Brown", phone: "345-678-9012", idNumber: "P11223344", idType: "Passport", nationality: "British", address: "789 Pine Rd", notes: "", image: "", debt: 0 }
        ];
        
        let rentals = JSON.parse(localStorage.getItem('rentals')) || [
            { id: 1, customerId: 1, carId: 3, rentDate: "2023-06-15", returnDate: "2023-06-20", totalAmount: 400, penalty: 0, status: "active" },
            { id: 2, customerId: 2, carId: 2, rentDate: "2023-06-10", returnDate: "2023-06-18", totalAmount: 360, penalty: 50, status: "completed" },
            { id: 3, customerId: 3, carId: 1, rentDate: "2023-06-12", returnDate: "2023-06-25", totalAmount: 650, penalty: 0, status: "active" }
        ];
        
        let returns = JSON.parse(localStorage.getItem('returns')) || [
            { id: 1, rentalId: 2, returnDate: "2023-06-18", finalAmount: 410, penalty: 50 }
        ];
        
        let payments = JSON.parse(localStorage.getItem('payments')) || [
            { id: 1, customerId: 2, amount: 100, date: "2023-06-15", remainingDebt: 50 }
        ];
        
        let settings = JSON.parse(localStorage.getItem('settings')) || {
            systemName: "CarRental Pro",
            systemLogo: "",
            systemMessages: "",
            developerName: "farzad programmer"
        };
        
        let backupHistory = JSON.parse(localStorage.getItem('backupHistory')) || [];

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
            loadDashboardData();
            loadCarsTable();
            loadCustomersTable();
            loadRentalsTable();
            loadReturnsTable();
            loadPaymentsTable();
            loadSettings();
            
            // Navigation event listeners - FIXED
            document.querySelectorAll('.sidebar .nav-link').forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    const sectionId = this.getAttribute('data-section');
                    showSection(sectionId);
                    
                    // Update active state
                    document.querySelectorAll('.sidebar .nav-link').forEach(item => {
                        item.classList.remove('active');
                    });
                    this.classList.add('active');
                    
                    // Close mobile menu if open
                    closeMobileMenu();
                });
            });
            
            // Mobile menu functionality
            document.getElementById('mobileMenuBtn').addEventListener('click', toggleMobileMenu);
            document.getElementById('overlay').addEventListener('click', closeMobileMenu);
            
            // Search functionality
            document.getElementById('carSearch').addEventListener('input', function() {
                filterCars(this.value);
            });
            
            document.getElementById('customerSearch').addEventListener('input', function() {
                filterCustomers(this.value);
            });
            
            document.getElementById('rentalCustomerSearch').addEventListener('input', function() {
                filterRentalsByCustomer(this.value);
            });
            
            document.getElementById('rentalCarSearch').addEventListener('input', function() {
                filterRentalsByCar(this.value);
            });
            
            document.getElementById('paymentCustomerSearch').addEventListener('input', function() {
                filterPayments(this.value);
            });
            
            // Modal save buttons
            document.getElementById('saveCar').addEventListener('click', saveCar);
            document.getElementById('saveCustomer').addEventListener('click', saveCustomer);
            document.getElementById('saveRental').addEventListener('click', saveRental);
            document.getElementById('saveSettings').addEventListener('click', saveSettings);
            
            // Backup functionality
            document.getElementById('createBackup').addEventListener('click', createBackup);
            document.getElementById('restoreBackup').addEventListener('click', restoreBackup);
            document.getElementById('viewBackupHistory').addEventListener('click', viewBackupHistory);
            
            // Report generation
            document.getElementById('generateReport').addEventListener('click', generateReport);
            
            // Rental form calculations
            document.getElementById('penaltyCheck').addEventListener('change', calculateRentalTotal);
            document.getElementById('returnDate').addEventListener('change', calculateRentalTotal);
            
            // Autocomplete functionality
            document.getElementById('rentalCustomer').addEventListener('input', function() {
                showCustomerAutocomplete(this.value);
            });
            
            document.getElementById('rentalCar').addEventListener('input', function() {
                showCarAutocomplete(this.value);
            });
            
            // Filter returns by date
            document.getElementById('filterReturns').addEventListener('click', function() {
                const dateFilter = document.getElementById('returnDateFilter').value;
                filterReturnsByDate(dateFilter);
            });
        });

        function toggleMobileMenu() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('overlay');
            sidebar.classList.toggle('mobile-open');
            overlay.classList.toggle('mobile-open');
        }

        function closeMobileMenu() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('overlay');
            sidebar.classList.remove('mobile-open');
            overlay.classList.remove('mobile-open');
        }

        function initializeApp() {
            // Set system name and developer name
            document.getElementById('systemName').textContent = settings.systemName;
            document.getElementById('systemNameInput').value = settings.systemName;
            document.getElementById('developerNameInput').value = settings.developerName;
            document.getElementById('developerName').textContent = settings.developerName;
            
            // Load logo if exists
            if (settings.systemLogo) {
                document.getElementById('systemLogo').src = settings.systemLogo;
            }
        }

        function showSection(sectionId) {
            // Hide all sections
            document.querySelectorAll('.section').forEach(section => {
                section.classList.remove('active');
            });
            
            // Show the selected section
            const targetSection = document.getElementById(sectionId);
            if (targetSection) {
                targetSection.classList.add('active');
            } else {
                console.error('Section not found:', sectionId);
            }
        }

        function loadDashboardData() {
            // Calculate stats
            const totalPayments = payments.reduce((sum, payment) => sum + payment.amount, 0);
            const rentedCars = cars.filter(car => car.status === 'rented').length;
            const carsInStock = cars.filter(car => car.status === 'available').length;
            const totalCustomers = customers.length;
            const totalDebt = customers.reduce((sum, customer) => sum + customer.debt, 0);
            
            // Update dashboard cards
            document.getElementById('totalPayments').textContent = '$' + totalPayments;
            document.getElementById('rentedCars').textContent = rentedCars;
            document.getElementById('carsInStock').textContent = carsInStock;
            document.getElementById('totalCustomers').textContent = totalCustomers;
            
            // Load recent rentals
            const recentRentalsTable = document.getElementById('recentRentalsTable');
            recentRentalsTable.innerHTML = '';
            
            rentals.slice(0, 5).forEach(rental => {
                const customer = customers.find(c => c.id === rental.customerId);
                const car = cars.find(c => c.id === rental.carId);
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${customer.name}</td>
                    <td>${car.model}</td>
                    <td>${rental.rentDate}</td>
                    <td>${rental.returnDate}</td>
                    <td><span class="${rental.status === 'active' ? 'status-rented' : 'status-available'}">${rental.status === 'active' ? 'Rented' : 'Returned'}</span></td>
                    <td class="action-buttons">
                        <button class="btn btn-sm btn-outline-primary"><i class="fas fa-edit"></i></button>
                        <button class="btn btn-sm btn-outline-danger" onclick="deleteRental(${rental.id})"><i class="fas fa-trash"></i></button>
                    </td>
                `;
                recentRentalsTable.appendChild(row);
            });
            
            // Load available cars
            const availableCarsList = document.getElementById('availableCarsList');
            availableCarsList.innerHTML = '';
            
            cars.filter(car => car.status === 'available').slice(0, 5).forEach(car => {
                const item = document.createElement('a');
                item.href = '#';
                item.className = 'list-group-item list-group-item-action d-flex justify-content-between align-items-center';
                item.innerHTML = `
                    <div>
                        <h6 class="mb-1">${car.model}</h6>
                        <small class="text-muted">License: ${car.license}</small>
                    </div>
                    <span class="badge bg-primary rounded-pill">$${car.dailyRate}/day</span>
                `;
                availableCarsList.appendChild(item);
            });
        }

        function loadCarsTable() {
            const carsTable = document.getElementById('carsTable');
            carsTable.innerHTML = '';
            
            cars.forEach(car => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td><img src="${car.image || 'https://via.placeholder.com/60'}" class="car-image" alt="${car.model}"></td>
                    <td>${car.model}</td>
                    <td>${car.color}</td>
                    <td>${car.license}</td>
                    <td>$${car.dailyRate}</td>
                    <td><span class="${car.status === 'available' ? 'status-available' : 'status-rented'}">${car.status === 'available' ? 'Available' : 'Rented'}</span></td>
                    <td class="action-buttons">
                        <button class="btn btn-sm btn-outline-primary" onclick="editCar(${car.id})"><i class="fas fa-edit"></i></button>
                        <button class="btn btn-sm btn-outline-danger" onclick="deleteCar(${car.id})"><i class="fas fa-trash"></i></button>
                    </td>
                `;
                carsTable.appendChild(row);
            });
        }

        function loadCustomersTable() {
            const customersTable = document.getElementById('customersTable');
            customersTable.innerHTML = '';
            
            customers.forEach(customer => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td><img src="${customer.image || 'https://via.placeholder.com/60'}" class="customer-image" alt="${customer.name}"></td>
                    <td>${customer.name}</td>
                    <td>${customer.phone}</td>
                    <td>${customer.idType}</td>
                    <td>${customer.idNumber}</td>
                    <td>$${customer.debt}</td>
                    <td class="action-buttons">
                        <button class="btn btn-sm btn-outline-primary" onclick="editCustomer(${customer.id})"><i class="fas fa-edit"></i></button>
                        <button class="btn btn-sm btn-outline-danger" onclick="deleteCustomer(${customer.id})"><i class="fas fa-trash"></i></button>
                    </td>
                `;
                customersTable.appendChild(row);
            });
        }

        function loadRentalsTable() {
            const rentalsTable = document.getElementById('rentalsTable');
            rentalsTable.innerHTML = '';
            
            rentals.forEach(rental => {
                const customer = customers.find(c => c.id === rental.customerId);
                const car = cars.find(c => c.id === rental.carId);
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${customer.name}</td>
                    <td>${car.model}</td>
                    <td>${rental.rentDate}</td>
                    <td>${rental.returnDate}</td>
                    <td>$${rental.totalAmount}</td>
                    <td>$${rental.penalty}</td>
                    <td><span class="${rental.status === 'active' ? 'status-rented' : 'status-available'}">${rental.status === 'active' ? 'Active' : 'Completed'}</span></td>
                    <td class="action-buttons">
                        <button class="btn btn-sm btn-outline-primary" onclick="editRental(${rental.id})"><i class="fas fa-edit"></i></button>
                        <button class="btn btn-sm btn-outline-danger" onclick="deleteRental(${rental.id})"><i class="fas fa-trash"></i></button>
                        <button class="btn btn-sm btn-outline-info" onclick="printInvoice(${rental.id})"><i class="fas fa-print"></i></button>
                    </td>
                `;
                rentalsTable.appendChild(row);
            });
        }

        function loadReturnsTable() {
            const returnsTable = document.getElementById('returnsTable');
            returnsTable.innerHTML = '';
            
            returns.forEach(returnItem => {
                const rental = rentals.find(r => r.id === returnItem.rentalId);
                const customer = customers.find(c => c.id === rental.customerId);
                const car = cars.find(c => c.id === rental.carId);
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${customer.name}</td>
                    <td>${car.model}</td>
                    <td>${returnItem.returnDate}</td>
                    <td>$${returnItem.finalAmount}</td>
                    <td>$${returnItem.penalty}</td>
                    <td class="action-buttons">
                        <button class="btn btn-sm btn-outline-danger" onclick="deleteReturn(${returnItem.id})"><i class="fas fa-trash"></i></button>
                    </td>
                `;
                returnsTable.appendChild(row);
            });
        }

        function loadPaymentsTable() {
            const paymentsTable = document.getElementById('paymentsTable');
            paymentsTable.innerHTML = '';
            
            payments.forEach(payment => {
                const customer = customers.find(c => c.id === payment.customerId);
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${customer.name}</td>
                    <td>$${payment.amount}</td>
                    <td>${payment.date}</td>
                    <td>$${payment.remainingDebt}</td>
                    <td class="action-buttons">
                        <button class="btn btn-sm btn-outline-danger" onclick="deletePayment(${payment.id})"><i class="fas fa-trash"></i></button>
                    </td>
                `;
                paymentsTable.appendChild(row);
            });
        }

        function loadSettings() {
            document.getElementById('systemNameInput').value = settings.systemName;
            document.getElementById('systemMessages').value = settings.systemMessages;
            document.getElementById('developerNameInput').value = settings.developerName;
        }

        function filterCars(searchTerm) {
            const filteredCars = cars.filter(car => 
                car.model.toLowerCase().includes(searchTerm.toLowerCase()) || 
                car.license.toLowerCase().includes(searchTerm.toLowerCase())
            );
            
            const carsTable = document.getElementById('carsTable');
            carsTable.innerHTML = '';
            
            filteredCars.forEach(car => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td><img src="${car.image || 'https://via.placeholder.com/60'}" class="car-image" alt="${car.model}"></td>
                    <td>${car.model}</td>
                    <td>${car.color}</td>
                    <td>${car.license}</td>
                    <td>$${car.dailyRate}</td>
                    <td><span class="${car.status === 'available' ? 'status-available' : 'status-rented'}">${car.status === 'available' ? 'Available' : 'Rented'}</span></td>
                    <td class="action-buttons">
                        <button class="btn btn-sm btn-outline-primary" onclick="editCar(${car.id})"><i class="fas fa-edit"></i></button>
                        <button class="btn btn-sm btn-outline-danger" onclick="deleteCar(${car.id})"><i class="fas fa-trash"></i></button>
                    </td>
                `;
                carsTable.appendChild(row);
            });
        }

        function filterCustomers(searchTerm) {
            const filteredCustomers = customers.filter(customer => 
                customer.name.toLowerCase().includes(searchTerm.toLowerCase())
            );
            
            const customersTable = document.getElementById('customersTable');
            customersTable.innerHTML = '';
            
            filteredCustomers.forEach(customer => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td><img src="${customer.image || 'https://via.placeholder.com/60'}" class="customer-image" alt="${customer.name}"></td>
                    <td>${customer.name}</td>
                    <td>${customer.phone}</td>
                    <td>${customer.idType}</td>
                    <td>${customer.idNumber}</td>
                    <td>$${customer.debt}</td>
                    <td class="action-buttons">
                        <button class="btn btn-sm btn-outline-primary" onclick="editCustomer(${customer.id})"><i class="fas fa-edit"></i></button>
                        <button class="btn btn-sm btn-outline-danger" onclick="deleteCustomer(${customer.id})"><i class="fas fa-trash"></i></button>
                    </td>
                `;
                customersTable.appendChild(row);
            });
        }

        function filterRentalsByCustomer(searchTerm) {
            const filteredRentals = rentals.filter(rental => {
                const customer = customers.find(c => c.id === rental.customerId);
                return customer.name.toLowerCase().includes(searchTerm.toLowerCase());
            });
            
            loadFilteredRentalsTable(filteredRentals);
        }

        function filterRentalsByCar(searchTerm) {
            const filteredRentals = rentals.filter(rental => {
                const car = cars.find(c => c.id === rental.carId);
                return car.model.toLowerCase().includes(searchTerm.toLowerCase());
            });
            
            loadFilteredRentalsTable(filteredRentals);
        }

        function loadFilteredRentalsTable(filteredRentals) {
            const rentalsTable = document.getElementById('rentalsTable');
            rentalsTable.innerHTML = '';
            
            filteredRentals.forEach(rental => {
                const customer = customers.find(c => c.id === rental.customerId);
                const car = cars.find(c => c.id === rental.carId);
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${customer.name}</td>
                    <td>${car.model}</td>
                    <td>${rental.rentDate}</td>
                    <td>${rental.returnDate}</td>
                    <td>$${rental.totalAmount}</td>
                    <td>$${rental.penalty}</td>
                    <td><span class="${rental.status === 'active' ? 'status-rented' : 'status-available'}">${rental.status === 'active' ? 'Active' : 'Completed'}</span></td>
                    <td class="action-buttons">
                        <button class="btn btn-sm btn-outline-primary" onclick="editRental(${rental.id})"><i class="fas fa-edit"></i></button>
                        <button class="btn btn-sm btn-outline-danger" onclick="deleteRental(${rental.id})"><i class="fas fa-trash"></i></button>
                        <button class="btn btn-sm btn-outline-info" onclick="printInvoice(${rental.id})"><i class="fas fa-print"></i></button>
                    </td>
                `;
                rentalsTable.appendChild(row);
            });
        }

        function filterPayments(searchTerm) {
            const filteredPayments = payments.filter(payment => {
                const customer = customers.find(c => c.id === payment.customerId);
                return customer.name.toLowerCase().includes(searchTerm.toLowerCase());
            });
            
            const paymentsTable = document.getElementById('paymentsTable');
            paymentsTable.innerHTML = '';
            
            filteredPayments.forEach(payment => {
                const customer = customers.find(c => c.id === payment.customerId);
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${customer.name}</td>
                    <td>$${payment.amount}</td>
                    <td>${payment.date}</td>
                    <td>$${payment.remainingDebt}</td>
                    <td class="action-buttons">
                        <button class="btn btn-sm btn-outline-danger" onclick="deletePayment(${payment.id})"><i class="fas fa-trash"></i></button>
                    </td>
                `;
                paymentsTable.appendChild(row);
            });
        }

        function filterReturnsByDate(date) {
            if (!date) {
                loadReturnsTable();
                return;
            }
            
            const filteredReturns = returns.filter(returnItem => returnItem.returnDate === date);
            
            const returnsTable = document.getElementById('returnsTable');
            returnsTable.innerHTML = '';
            
            filteredReturns.forEach(returnItem => {
                const rental = rentals.find(r => r.id === returnItem.rentalId);
                const customer = customers.find(c => c.id === rental.customerId);
                const car = cars.find(c => c.id === rental.carId);
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${customer.name}</td>
                    <td>${car.model}</td>
                    <td>${returnItem.returnDate}</td>
                    <td>$${returnItem.finalAmount}</td>
                    <td>$${returnItem.penalty}</td>
                    <td class="action-buttons">
                        <button class="btn btn-sm btn-outline-danger" onclick="deleteReturn(${returnItem.id})"><i class="fas fa-trash"></i></button>
                    </td>
                `;
                returnsTable.appendChild(row);
            });
        }

        function showCustomerAutocomplete(searchTerm) {
            const autocompleteContainer = document.getElementById('customerAutocomplete');
            autocompleteContainer.innerHTML = '';
            
            if (searchTerm.length < 2) return;
            
            const filteredCustomers = customers.filter(customer => 
                customer.name.toLowerCase().includes(searchTerm.toLowerCase())
            );
            
            filteredCustomers.forEach(customer => {
                const item = document.createElement('div');
                item.textContent = customer.name;
                item.addEventListener('click', function() {
                    document.getElementById('rentalCustomer').value = customer.name;
                    autocompleteContainer.innerHTML = '';
                });
                autocompleteContainer.appendChild(item);
            });
        }

        function showCarAutocomplete(searchTerm) {
            const autocompleteContainer = document.getElementById('carAutocomplete');
            autocompleteContainer.innerHTML = '';
            
            if (searchTerm.length < 2) return;
            
            const filteredCars = cars.filter(car => 
                car.model.toLowerCase().includes(searchTerm.toLowerCase()) && car.status === 'available'
            );
            
            filteredCars.forEach(car => {
                const item = document.createElement('div');
                item.textContent = car.model;
                item.addEventListener('click', function() {
                    document.getElementById('rentalCar').value = car.model;
                    autocompleteContainer.innerHTML = '';
                    calculateRentalTotal();
                });
                autocompleteContainer.appendChild(item);
            });
        }

        function calculateRentalTotal() {
            const carName = document.getElementById('rentalCar').value;
            const returnDate = new Date(document.getElementById('returnDate').value);
            const rentOutDate = new Date(document.getElementById('rentOutDate').value);
            const penaltyCheck = document.getElementById('penaltyCheck').checked;
            const penaltyAmount = parseFloat(document.getElementById('penaltyAmount').value) || 0;
            
            if (!carName || !returnDate || !rentOutDate) return;
            
            const car = cars.find(c => c.model === carName);
            if (!car) return;
            
            // Calculate days
            const timeDiff = returnDate.getTime() - rentOutDate.getTime();
            const daysDiff = Math.ceil(timeDiff / (1000 * 3600 * 24));
            
            if (daysDiff < 1) {
                alert('Return date must be after rent out date');
                return;
            }
            
            let totalAmount = daysDiff * car.dailyRate;
            
            // Add penalty if checked
            if (penaltyCheck) {
                totalAmount *= 1.05;
            }
            
            // Add penalty amount
            totalAmount += penaltyAmount;
            
            document.getElementById('totalAmount').value = totalAmount.toFixed(2);
        }

        function saveCar() {
            const carModel = document.getElementById('carModel').value;
            const carColor = document.getElementById('carColor').value;
            const carLicense = document.getElementById('carLicense').value;
            const dailyRate = document.getElementById('dailyRate').value;
            const carImage = document.getElementById('carImage').files[0];
            
            if (!carModel || !carColor || !carLicense || !dailyRate) {
                alert('Please fill all required fields');
                return;
            }
            
            const newCar = {
                id: cars.length > 0 ? Math.max(...cars.map(c => c.id)) + 1 : 1,
                model: carModel,
                color: carColor,
                license: carLicense,
                dailyRate: parseFloat(dailyRate),
                status: 'available',
                image: carImage ? URL.createObjectURL(carImage) : ''
            };
            
            cars.push(newCar);
            localStorage.setItem('cars', JSON.stringify(cars));
            
            // Close modal and reset form
            const modal = bootstrap.Modal.getInstance(document.getElementById('addCarModal'));
            modal.hide();
            document.getElementById('addCarForm').reset();
            
            // Reload tables
            loadCarsTable();
            loadDashboardData();
            
            alert('Car added successfully!');
        }

        function saveCustomer() {
            const fullName = document.getElementById('customerFullName').value;
            const phone = document.getElementById('customerPhone').value;
            const idType = document.getElementById('idType').value;
            const idNumber = document.getElementById('idNumber').value;
            const nationality = document.getElementById('nationality').value;
            const address = document.getElementById('customerAddress').value;
            const notes = document.getElementById('customerNotes').value;
            const customerImage = document.getElementById('customerImage').files[0];
            
            if (!fullName || !phone || !idType || !idNumber || !nationality || !address) {
                alert('Please fill all required fields');
                return;
            }
            
            const newCustomer = {
                id: customers.length > 0 ? Math.max(...customers.map(c => c.id)) + 1 : 1,
                name: fullName,
                phone: phone,
                idType: idType,
                idNumber: idNumber,
                nationality: nationality,
                address: address,
                notes: notes,
                image: customerImage ? URL.createObjectURL(customerImage) : '',
                debt: 0
            };
            
            customers.push(newCustomer);
            localStorage.setItem('customers', JSON.stringify(customers));
            
            // Close modal and reset form
            const modal = bootstrap.Modal.getInstance(document.getElementById('addCustomerModal'));
            modal.hide();
            document.getElementById('addCustomerForm').reset();
            
            // Reload tables
            loadCustomersTable();
            loadDashboardData();
            
            alert('Customer added successfully!');
        }

        function saveRental() {
            const customerName = document.getElementById('rentalCustomer').value;
            const carName = document.getElementById('rentalCar').value;
            const rentOutDate = document.getElementById('rentOutDate').value;
            const returnDate = document.getElementById('returnDate').value;
            const penaltyCheck = document.getElementById('penaltyCheck').checked;
            const penaltyAmount = parseFloat(document.getElementById('penaltyAmount').value) || 0;
            const totalAmount = parseFloat(document.getElementById('totalAmount').value);
            
            if (!customerName || !carName || !rentOutDate || !returnDate || !totalAmount) {
                alert('Please fill all required fields');
                return;
            }
            
            const customer = customers.find(c => c.name === customerName);
            const car = cars.find(c => c.model === carName);
            
            if (!customer || !car) {
                alert('Customer or car not found');
                return;
            }
            
            if (car.status !== 'available') {
                alert('Selected car is not available for rental');
                return;
            }
            
            const newRental = {
                id: rentals.length > 0 ? Math.max(...rentals.map(r => r.id)) + 1 : 1,
                customerId: customer.id,
                carId: car.id,
                rentDate: rentOutDate,
                returnDate: returnDate,
                totalAmount: totalAmount,
                penalty: penaltyAmount,
                status: 'active'
            };
            
            // Update car status
            car.status = 'rented';
            
            rentals.push(newRental);
            localStorage.setItem('rentals', JSON.stringify(rentals));
            localStorage.setItem('cars', JSON.stringify(cars));
            
            // Close modal and reset form
            const modal = bootstrap.Modal.getInstance(document.getElementById('addRentalModal'));
            modal.hide();
            document.getElementById('addRentalForm').reset();
            
            // Reload tables
            loadRentalsTable();
            loadCarsTable();
            loadDashboardData();
            
            alert('Rental added successfully!');
        }

        function saveSettings() {
            const systemName = document.getElementById('systemNameInput').value;
            const systemMessages = document.getElementById('systemMessages').value;
            const systemLogo = document.getElementById('systemLogoUpload').files[0];
            
            settings.systemName = systemName;
            settings.systemMessages = systemMessages;
            
            if (systemLogo) {
                settings.systemLogo = URL.createObjectURL(systemLogo);
                document.getElementById('systemLogo').src = settings.systemLogo;
            }
            
            document.getElementById('systemName').textContent = systemName;
            
            localStorage.setItem('settings', JSON.stringify(settings));
            
            alert('Settings saved successfully!');
        }

        function createBackup() {
            const backupData = {
                cars: cars,
                customers: customers,
                rentals: rentals,
                returns: returns,
                payments: payments,
                settings: settings,
                timestamp: new Date().toISOString()
            };
            
            const backupBlob = new Blob([JSON.stringify(backupData)], { type: 'application/json' });
            const backupUrl = URL.createObjectURL(backupBlob);
            
            const a = document.createElement('a');
            a.href = backupUrl;
            a.download = `car-rental-backup-${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            
            // Add to backup history
            backupHistory.push({
                timestamp: new Date().toISOString(),
                filename: a.download
            });
            localStorage.setItem('backupHistory', JSON.stringify(backupHistory));
            
            alert('Backup created successfully!');
        }

        function restoreBackup() {
            const fileInput = document.getElementById('restoreBackupFile');
            const file = fileInput.files[0];
            
            if (!file) {
                alert('Please select a backup file');
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const backupData = JSON.parse(e.target.result);
                    
                    // Restore data
                    if (backupData.cars) cars = backupData.cars;
                    if (backupData.customers) customers = backupData.customers;
                    if (backupData.rentals) rentals = backupData.rentals;
                    if (backupData.returns) returns = backupData.returns;
                    if (backupData.payments) payments = backupData.payments;
                    if (backupData.settings) settings = backupData.settings;
                    
                    // Save to localStorage
                    localStorage.setItem('cars', JSON.stringify(cars));
                    localStorage.setItem('customers', JSON.stringify(customers));
                    localStorage.setItem('rentals', JSON.stringify(rentals));
                    localStorage.setItem('returns', JSON.stringify(returns));
                    localStorage.setItem('payments', JSON.stringify(payments));
                    localStorage.setItem('settings', JSON.stringify(settings));
                    
                    // Reload all data
                    initializeApp();
                    loadDashboardData();
                    loadCarsTable();
                    loadCustomersTable();
                    loadRentalsTable();
                    loadReturnsTable();
                    loadPaymentsTable();
                    
                    alert('Backup restored successfully!');
                } catch (error) {
                    alert('Error restoring backup: ' + error.message);
                }
            };
            reader.readAsText(file);
        }

        function viewBackupHistory() {
            const backupHistoryContainer = document.getElementById('backupHistory');
            backupHistoryContainer.innerHTML = '<h5>Backup History</h5>';
            
            if (backupHistory.length === 0) {
                backupHistoryContainer.innerHTML += '<p>No backup history found.</p>';
                return;
            }
            
            const list = document.createElement('ul');
            backupHistory.forEach(backup => {
                const item = document.createElement('li');
                item.textContent = `${backup.filename} - ${new Date(backup.timestamp).toLocaleString()}`;
                list.appendChild(item);
            });
            
            backupHistoryContainer.appendChild(list);
        }

        function generateReport() {
            const startDate = document.getElementById('reportStartDate').value;
            const endDate = document.getElementById('reportEndDate').value;
            const searchTerm = document.getElementById('reportSearch').value;
            
            let filteredRentals = rentals;
            
            // Filter by date range
            if (startDate && endDate) {
                filteredRentals = filteredRentals.filter(rental => {
                    return rental.rentDate >= startDate && rental.rentDate <= endDate;
                });
            }
            
            // Filter by search term
            if (searchTerm) {
                filteredRentals = filteredRentals.filter(rental => {
                    const customer = customers.find(c => c.id === rental.customerId);
                    const car = cars.find(c => c.id === rental.carId);
                    return customer.name.toLowerCase().includes(searchTerm.toLowerCase()) || 
                           car.model.toLowerCase().includes(searchTerm.toLowerCase());
                });
            }
            
            const reportResults = document.getElementById('reportResults');
            reportResults.innerHTML = '<h5>Report Results</h5>';
            
            if (filteredRentals.length === 0) {
                reportResults.innerHTML += '<p>No results found for the specified criteria.</p>';
                return;
            }
            
            const table = document.createElement('table');
            table.className = 'table table-striped';
            
            // Create table header
            const thead = document.createElement('thead');
            thead.innerHTML = `
                <tr>
                    <th>Customer</th>
                    <th>Car</th>
                    <th>Rent Date</th>
                    <th>Return Date</th>
                    <th>Total Amount</th>
                    <th>Status</th>
                </tr>
            `;
            table.appendChild(thead);
            
            // Create table body
            const tbody = document.createElement('tbody');
            filteredRentals.forEach(rental => {
                const customer = customers.find(c => c.id === rental.customerId);
                const car = cars.find(c => c.id === rental.carId);
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${customer.name}</td>
                    <td>${car.model}</td>
                    <td>${rental.rentDate}</td>
                    <td>${rental.returnDate}</td>
                    <td>$${rental.totalAmount}</td>
                    <td>${rental.status}</td>
                `;
                tbody.appendChild(row);
            });
            table.appendChild(tbody);
            
            reportResults.appendChild(table);
        }

        // Placeholder functions for edit and delete operations
        function editCar(id) {
            alert('Edit car with ID: ' + id);
            // Implementation would open a modal with car details pre-filled
        }

        function deleteCar(id) {
            if (confirm('Are you sure you want to delete this car?')) {
                cars = cars.filter(car => car.id !== id);
                localStorage.setItem('cars', JSON.stringify(cars));
                loadCarsTable();
                loadDashboardData();
                alert('Car deleted successfully!');
            }
        }

        function editCustomer(id) {
            alert('Edit customer with ID: ' + id);
            // Implementation would open a modal with customer details pre-filled
        }

        function deleteCustomer(id) {
            if (confirm('Are you sure you want to delete this customer?')) {
                customers = customers.filter(customer => customer.id !== id);
                localStorage.setItem('customers', JSON.stringify(customers));
                loadCustomersTable();
                loadDashboardData();
                alert('Customer deleted successfully!');
            }
        }

        function editRental(id) {
            alert('Edit rental with ID: ' + id);
            // Implementation would open a modal with rental details pre-filled
        }

        function deleteRental(id) {
            if (confirm('Are you sure you want to delete this rental?')) {
                rentals = rentals.filter(rental => rental.id !== id);
                localStorage.setItem('rentals', JSON.stringify(rentals));
                loadRentalsTable();
                loadDashboardData();
                alert('Rental deleted successfully!');
            }
        }

        function deleteReturn(id) {
            if (confirm('Are you sure you want to delete this return record?')) {
                returns = returns.filter(returnItem => returnItem.id !== id);
                localStorage.setItem('returns', JSON.stringify(returns));
                loadReturnsTable();
                alert('Return record deleted successfully!');
            }
        }

        function deletePayment(id) {
            if (confirm('Are you sure you want to delete this payment record?')) {
                payments = payments.filter(payment => payment.id !== id);
                localStorage.setItem('payments', JSON.stringify(payments));
                loadPaymentsTable();
                alert('Payment record deleted successfully!');
            }
        }

        function printInvoice(id) {
            alert('Print invoice for rental ID: ' + id);
            // Implementation would generate a printable invoice
        }
    </script>
</body>
</html>