<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LSIYARA Car Rental System</title>
    <style>
        :root {
            --primary: #2c3e50;
            --secondary: #3498db;
            --success: #27ae60;
            --danger: #e74c3c;
            --warning: #f39c12;
            --light: #ecf0f1;
            --dark: #34495e;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f5f7fa;
            color: #333;
            line-height: 1.6;
        }
        
        .container {
            width: 95%;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            padding: 15px 0;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            position: relative;
        }
        
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .logo {
            font-size: 24px;
            font-weight: bold;
        }
        
        .system-name {
            font-size: 18px;
            text-align: center;
            flex-grow: 1;
        }
        
        .developer-credit {
            font-size: 12px;
            position: absolute;
            bottom: 5px;
            right: 15px;
        }
        
        nav {
            background-color: var(--dark);
            padding: 10px 0;
        }
        
        .nav-tabs {
            display: flex;
            list-style: none;
            overflow-x: auto;
        }
        
        .nav-tabs li {
            margin-right: 5px;
        }
        
        .nav-tabs a {
            display: block;
            padding: 10px 15px;
            color: white;
            text-decoration: none;
            border-radius: 5px 5px 0 0;
            transition: background-color 0.3s;
        }
        
        .nav-tabs a.active, .nav-tabs a:hover {
            background-color: var(--secondary);
        }
        
        .tab-content {
            display: none;
            background-color: white;
            padding: 20px;
            border-radius: 0 0 5px 5px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .section-title {
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--light);
            color: var(--primary);
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
        }
        
        input, select, textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
        }
        
        .form-row {
            display: flex;
            flex-wrap: wrap;
            margin: 0 -10px;
        }
        
        .form-col {
            flex: 1;
            padding: 0 10px;
            min-width: 200px;
        }
        
        .btn {
            padding: 10px 15px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.3s;
        }
        
        .btn-primary {
            background-color: var(--secondary);
            color: white;
        }
        
        .btn-success {
            background-color: var(--success);
            color: white;
        }
        
        .btn-danger {
            background-color: var(--danger);
            color: white;
        }
        
        .btn-warning {
            background-color: var(--warning);
            color: white;
        }
        
        .btn:hover {
            opacity: 0.9;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        
        th, td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        
        th {
            background-color: var(--light);
            font-weight: 600;
        }
        
        tr:hover {
            background-color: #f9f9f9;
        }
        
        .action-buttons {
            display: flex;
            gap: 5px;
        }
        
        .search-box {
            margin-bottom: 20px;
            display: flex;
            gap: 10px;
        }
        
        .search-box input {
            flex-grow: 1;
        }
        
        .suggestions {
            position: absolute;
            background: white;
            border: 1px solid #ddd;
            width: calc(100% - 20px);
            max-height: 200px;
            overflow-y: auto;
            z-index: 100;
            display: none;
        }
        
        .suggestion-item {
            padding: 10px;
            cursor: pointer;
        }
        
        .suggestion-item:hover {
            background-color: #f0f0f0;
        }
        
        .invoice {
            border: 1px solid #ddd;
            padding: 20px;
            margin-top: 20px;
            background-color: white;
        }
        
        .invoice-header {
            text-align: center;
            margin-bottom: 20px;
        }
        
        .invoice-details {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
        }
        
        .invoice-items {
            width: 100%;
            margin-bottom: 20px;
        }
        
        .invoice-total {
            text-align: right;
            font-weight: bold;
            font-size: 18px;
        }
        
        .backup-section {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }
        
        .alert {
            padding: 10px 15px;
            margin-bottom: 15px;
            border-radius: 4px;
        }
        
        .alert-success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .alert-danger {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        @media print {
            body * {
                visibility: hidden;
            }
            .invoice, .invoice * {
                visibility: visible;
            }
            .invoice {
                position: absolute;
                left: 0;
                top: 0;
                width: 100%;
            }
        }
        
        @media (max-width: 768px) {
            .form-row {
                flex-direction: column;
            }
            
            .form-col {
                width: 100%;
            }
            
            .nav-tabs {
                flex-wrap: wrap;
            }
            
            .action-buttons {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <div class="header-content">
                <div class="logo">LSIYARA</div>
                <div class="system-name">Car Rental Management System</div>
            </div>
            <div class="developer-credit">Developed by Farzad Programmer</div>
        </div>
    </header>
    
    <nav>
        <div class="container">
            <ul class="nav-tabs">
                <li><a href="#" class="nav-link active" data-tab="vehicles">Vehicles</a></li>
                <li><a href="#" class="nav-link" data-tab="customers">Customers</a></li>
                <li><a href="#" class="nav-link" data-tab="rentals">Rentals</a></li>
                <li><a href="#" class="nav-link" data-tab="reports">Reports</a></li>
                <li><a href="#" class="nav-link" data-tab="settings">Settings</a></li>
            </ul>
        </div>
    </nav>
    
    <div class="container">
        <!-- Vehicles Tab -->
        <div id="vehicles" class="tab-content active">
            <h2 class="section-title">Vehicle Management</h2>
            
            <div class="search-box">
                <input type="text" id="vehicleSearch" placeholder="Search by vehicle name, plate, VIN...">
                <button class="btn btn-primary" id="vehicleSearchBtn">Search</button>
                <button class="btn btn-warning" id="vehicleResetBtn">Reset</button>
            </div>
            
            <div class="form-group">
                <button class="btn btn-success" id="addVehicleBtn">Add New Vehicle</button>
            </div>
            
            <div id="vehicleForm" style="display: none;">
                <h3>Add/Edit Vehicle</h3>
                <form id="vehicleFormData">
                    <div class="form-row">
                        <div class="form-col">
                            <label for="vehicleName">Vehicle Name</label>
                            <input type="text" id="vehicleName" required>
                        </div>
                        <div class="form-col">
                            <label for="vehicleOdometer">Odometer (km)</label>
                            <input type="number" id="vehicleOdometer" required>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-col">
                            <label for="vehicleColor">Color</label>
                            <input type="text" id="vehicleColor" required>
                        </div>
                        <div class="form-col">
                            <label for="vehicleModel">Model</label>
                            <input type="text" id="vehicleModel" required>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-col">
                            <label for="vehiclePlate">Plate Number</label>
                            <input type="text" id="vehiclePlate" required>
                        </div>
                        <div class="form-col">
                            <label for="vehicleVin">VIN #</label>
                            <input type="text" id="vehicleVin" required>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="vehicleImage">Vehicle Image</label>
                        <input type="file" id="vehicleImage" accept="image/*">
                    </div>
                    
                    <div class="form-group">
                        <button type="submit" class="btn btn-primary">Save Vehicle</button>
                        <button type="button" class="btn btn-danger" id="cancelVehicleBtn">Cancel</button>
                    </div>
                </form>
            </div>
            
            <table id="vehiclesTable">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Name</th>
                        <th>Model</th>
                        <th>Color</th>
                        <th>Plate</th>
                        <th>VIN</th>
                        <th>Odometer</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Vehicle data will be populated here -->
                </tbody>
            </table>
        </div>
        
        <!-- Customers Tab -->
        <div id="customers" class="tab-content">
            <h2 class="section-title">Customer Management</h2>
            
            <div class="search-box">
                <input type="text" id="customerSearch" placeholder="Search by name, phone, ID...">
                <button class="btn btn-primary" id="customerSearchBtn">Search</button>
                <button class="btn btn-warning" id="customerResetBtn">Reset</button>
            </div>
            
            <div class="form-group">
                <button class="btn btn-success" id="addCustomerBtn">Add New Customer</button>
            </div>
            
            <div id="customerForm" style="display: none;">
                <h3>Add/Edit Customer</h3>
                <form id="customerFormData">
                    <div class="form-row">
                        <div class="form-col">
                            <label for="customerName">Full Name</label>
                            <input type="text" id="customerName" required>
                        </div>
                        <div class="form-col">
                            <label for="customerPhone">Phone Number</label>
                            <input type="text" id="customerPhone" required>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-col">
                            <label for="customerId">ID/Passport Number</label>
                            <input type="text" id="customerId" required>
                        </div>
                        <div class="form-col">
                            <label for="customerAge">Age</label>
                            <input type="number" id="customerAge" required>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-col">
                            <label for="customerAddress">Address</label>
                            <input type="text" id="customerAddress" required>
                        </div>
                        <div class="form-col">
                            <label for="customerNeighborhood">Neighborhood</label>
                            <input type="text" id="customerNeighborhood" required>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="customerImage">Customer Photo</label>
                        <input type="file" id="customerImage" accept="image/*">
                    </div>
                    
                    <div class="form-group">
                        <button type="submit" class="btn btn-primary">Save Customer</button>
                        <button type="button" class="btn btn-danger" id="cancelCustomerBtn">Cancel</button>
                    </div>
                </form>
            </div>
            
            <table id="customersTable">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Name</th>
                        <th>Phone</th>
                        <th>ID Number</th>
                        <th>Age</th>
                        <th>Address</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Customer data will be populated here -->
                </tbody>
            </table>
        </div>
        
        <!-- Rentals Tab -->
        <div id="rentals" class="tab-content">
            <h2 class="section-title">Rental Management</h2>
            
            <div class="search-box">
                <input type="text" id="rentalSearch" placeholder="Search by customer or vehicle name...">
                <button class="btn btn-primary" id="rentalSearchBtn">Search</button>
                <button class="btn btn-warning" id="rentalResetBtn">Reset</button>
            </div>
            
            <div class="form-group">
                <button class="btn btn-success" id="addRentalBtn">Create New Rental</button>
            </div>
            
            <div id="rentalForm" style="display: none;">
                <h3>Create Rental</h3>
                <form id="rentalFormData">
                    <div class="form-row">
                        <div class="form-col">
                            <label for="rentalCustomer">Customer</label>
                            <input type="text" id="rentalCustomer" placeholder="Search customer...">
                            <div id="customerSuggestions" class="suggestions"></div>
                        </div>
                        <div class="form-col">
                            <label for="rentalVehicle">Vehicle</label>
                            <input type="text" id="rentalVehicle" placeholder="Search vehicle...">
                            <div id="vehicleSuggestions" class="suggestions"></div>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-col">
                            <label for="rentalStartDate">Start Date</label>
                            <input type="date" id="rentalStartDate" required>
                        </div>
                        <div class="form-col">
                            <label for="rentalEndDate">End Date</label>
                            <input type="date" id="rentalEndDate" required>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-col">
                            <label for="dailyRate">Daily Rate ($)</label>
                            <input type="number" id="dailyRate" required>
                        </div>
                        <div class="form-col">
                            <label for="totalAmount">Total Amount ($)</label>
                            <input type="number" id="totalAmount" readonly>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <button type="submit" class="btn btn-primary">Create Rental</button>
                        <button type="button" class="btn btn-danger" id="cancelRentalBtn">Cancel</button>
                    </div>
                </form>
            </div>
            
            <table id="rentalsTable">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Customer</th>
                        <th>Vehicle</th>
                        <th>Start Date</th>
                        <th>End Date</th>
                        <th>Daily Rate</th>
                        <th>Total</th>
                        <th>Status</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Rental data will be populated here -->
                </tbody>
            </table>
        </div>
        
        <!-- Reports Tab -->
        <div id="reports" class="tab-content">
            <h2 class="section-title">Reports</h2>
            
            <div class="form-row">
                <div class="form-col">
                    <label for="reportStartDate">Start Date</label>
                    <input type="date" id="reportStartDate">
                </div>
                <div class="form-col">
                    <label for="reportEndDate">End Date</label>
                    <input type="date" id="reportEndDate">
                </div>
                <div class="form-col">
                    <label for="reportSearch">Search</label>
                    <input type="text" id="reportSearch" placeholder="Search by name, vehicle...">
                </div>
            </div>
            
            <div class="form-group">
                <button class="btn btn-primary" id="generateReportBtn">Generate Report</button>
                <button class="btn btn-warning" id="resetReportBtn">Reset</button>
            </div>
            
            <table id="reportsTable">
                <thead>
                    <tr>
                        <th>Rental ID</th>
                        <th>Customer</th>
                        <th>Vehicle</th>
                        <th>Start Date</th>
                        <th>End Date</th>
                        <th>Daily Rate</th>
                        <th>Total</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Report data will be populated here -->
                </tbody>
            </table>
        </div>
        
        <!-- Settings Tab -->
        <div id="settings" class="tab-content">
            <h2 class="section-title">System Settings</h2>
            
            <div class="form-group">
                <label for="systemName">System Name</label>
                <input type="text" id="systemName" value="LSIYARA Car Rental System">
            </div>
            
            <div class="form-group">
                <label for="companyName">Company Name</label>
                <input type="text" id="companyName" value="LSIYARA">
            </div>
            
            <div class="form-group">
                <label for="companyAddress">Company Address</label>
                <input type="text" id="companyAddress" value="35A signal al yarmook sharjah U.A.E">
            </div>
            
            <div class="form-group">
                <label for="companyPhone">Company Phone</label>
                <input type="text" id="companyPhone" value="+971503656881">
            </div>
            
            <div class="form-group">
                <label for="taxRate">Tax Rate (%)</label>
                <input type="number" id="taxRate" value="5" min="0" max="100">
            </div>
            
            <div class="form-group">
                <button class="btn btn-primary" id="saveSettingsBtn">Save Settings</button>
            </div>
            
            <h3 class="section-title">Backup & Restore</h3>
            
            <div class="backup-section">
                <button class="btn btn-primary" id="backupBtn">Create Backup</button>
                <button class="btn btn-warning" id="restoreBtn">Restore Backup</button>
                <input type="file" id="backupFile" accept=".json" style="display: none;">
            </div>
            
            <div class="form-group">
                <div id="backupMessage" class="alert" style="display: none;"></div>
            </div>
        </div>
    </div>

    <script>
        // Sample data storage
        let vehicles = JSON.parse(localStorage.getItem('vehicles')) || [];
        let customers = JSON.parse(localStorage.getItem('customers')) || [];
        let rentals = JSON.parse(localStorage.getItem('rentals')) || [];
        let settings = JSON.parse(localStorage.getItem('settings')) || {
            systemName: "LSIYARA Car Rental System",
            companyName: "LSIYARA",
            companyAddress: "35A signal al yarmook sharjah U.A.E",
            companyPhone: "+971503656881",
            taxRate: 5
        };

        // DOM elements
        const navLinks = document.querySelectorAll('.nav-link');
        const tabContents = document.querySelectorAll('.tab-content');
        
        // Initialize the system
        document.addEventListener('DOMContentLoaded', function() {
            // Load settings
            loadSettings();
            
            // Load initial data
            renderVehicles();
            renderCustomers();
            renderRentals();
            renderReports();
            
            // Set up event listeners
            setupEventListeners();
        });

        // Navigation
        navLinks.forEach(link => {
            link.addEventListener('click', function(e) {
                e.preventDefault();
                const tabId = this.getAttribute('data-tab');
                
                // Update active tab
                navLinks.forEach(l => l.classList.remove('active'));
                this.classList.add('active');
                
                // Show corresponding content
                tabContents.forEach(content => content.classList.remove('active'));
                document.getElementById(tabId).classList.add('active');
            });
        });

        // Vehicle Management
        function renderVehicles(filteredVehicles = null) {
            const vehiclesTable = document.getElementById('vehiclesTable').querySelector('tbody');
            vehiclesTable.innerHTML = '';
            
            const vehiclesToRender = filteredVehicles || vehicles;
            
            if (vehiclesToRender.length === 0) {
                vehiclesTable.innerHTML = '<tr><td colspan="8" style="text-align: center;">No vehicles found</td></tr>';
                return;
            }
            
            vehiclesToRender.forEach(vehicle => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${vehicle.id}</td>
                    <td>${vehicle.name}</td>
                    <td>${vehicle.model}</td>
                    <td>${vehicle.color}</td>
                    <td>${vehicle.plate}</td>
                    <td>${vehicle.vin}</td>
                    <td>${vehicle.odometer} km</td>
                    <td class="action-buttons">
                        <button class="btn btn-primary" onclick="editVehicle(${vehicle.id})">Edit</button>
                        <button class="btn btn-danger" onclick="deleteVehicle(${vehicle.id})">Delete</button>
                    </td>
                `;
                vehiclesTable.appendChild(row);
            });
        }

        function addVehicle() {
            const form = document.getElementById('vehicleFormData');
            const formData = new FormData(form);
            
            const vehicle = {
                id: vehicles.length > 0 ? Math.max(...vehicles.map(v => v.id)) + 1 : 1,
                name: document.getElementById('vehicleName').value,
                odometer: parseInt(document.getElementById('vehicleOdometer').value),
                color: document.getElementById('vehicleColor').value,
                model: document.getElementById('vehicleModel').value,
                plate: document.getElementById('vehiclePlate').value,
                vin: document.getElementById('vehicleVin').value,
                image: null // In a real app, you would handle file upload
            };
            
            vehicles.push(vehicle);
            localStorage.setItem('vehicles', JSON.stringify(vehicles));
            
            // Reset form and hide it
            form.reset();
            document.getElementById('vehicleForm').style.display = 'none';
            
            // Show success message
            showAlert('Vehicle added successfully!', 'success');
            
            // Refresh table
            renderVehicles();
        }

        function editVehicle(id) {
            const vehicle = vehicles.find(v => v.id === id);
            if (!vehicle) return;
            
            document.getElementById('vehicleName').value = vehicle.name;
            document.getElementById('vehicleOdometer').value = vehicle.odometer;
            document.getElementById('vehicleColor').value = vehicle.color;
            document.getElementById('vehicleModel').value = vehicle.model;
            document.getElementById('vehiclePlate').value = vehicle.plate;
            document.getElementById('vehicleVin').value = vehicle.vin;
            
            // Show form
            document.getElementById('vehicleForm').style.display = 'block';
            
            // Change form to update mode
            const form = document.getElementById('vehicleFormData');
            form.onsubmit = function(e) {
                e.preventDefault();
                updateVehicle(id);
            };
        }

        function updateVehicle(id) {
            const vehicleIndex = vehicles.findIndex(v => v.id === id);
            if (vehicleIndex === -1) return;
            
            vehicles[vehicleIndex] = {
                ...vehicles[vehicleIndex],
                name: document.getElementById('vehicleName').value,
                odometer: parseInt(document.getElementById('vehicleOdometer').value),
                color: document.getElementById('vehicleColor').value,
                model: document.getElementById('vehicleModel').value,
                plate: document.getElementById('vehiclePlate').value,
                vin: document.getElementById('vehicleVin').value
            };
            
            localStorage.setItem('vehicles', JSON.stringify(vehicles));
            
            // Reset form and hide it
            document.getElementById('vehicleFormData').reset();
            document.getElementById('vehicleForm').style.display = 'none';
            
            // Show success message
            showAlert('Vehicle updated successfully!', 'success');
            
            // Refresh table
            renderVehicles();
        }

        function deleteVehicle(id) {
            if (confirm('Are you sure you want to delete this vehicle?')) {
                vehicles = vehicles.filter(v => v.id !== id);
                localStorage.setItem('vehicles', JSON.stringify(vehicles));
                
                // Show success message
                showAlert('Vehicle deleted successfully!', 'success');
                
                // Refresh table
                renderVehicles();
            }
        }

        function searchVehicles() {
            const query = document.getElementById('vehicleSearch').value.toLowerCase();
            
            if (!query) {
                renderVehicles();
                return;
            }
            
            const filteredVehicles = vehicles.filter(vehicle => 
                vehicle.name.toLowerCase().includes(query) ||
                vehicle.model.toLowerCase().includes(query) ||
                vehicle.plate.toLowerCase().includes(query) ||
                vehicle.vin.toLowerCase().includes(query)
            );
            
            renderVehicles(filteredVehicles);
        }

        // Customer Management
        function renderCustomers(filteredCustomers = null) {
            const customersTable = document.getElementById('customersTable').querySelector('tbody');
            customersTable.innerHTML = '';
            
            const customersToRender = filteredCustomers || customers;
            
            if (customersToRender.length === 0) {
                customersTable.innerHTML = '<tr><td colspan="7" style="text-align: center;">No customers found</td></tr>';
                return;
            }
            
            customersToRender.forEach(customer => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${customer.id}</td>
                    <td>${customer.name}</td>
                    <td>${customer.phone}</td>
                    <td>${customer.idNumber}</td>
                    <td>${customer.age}</td>
                    <td>${customer.address}</td>
                    <td class="action-buttons">
                        <button class="btn btn-primary" onclick="editCustomer(${customer.id})">Edit</button>
                        <button class="btn btn-danger" onclick="deleteCustomer(${customer.id})">Delete</button>
                    </td>
                `;
                customersTable.appendChild(row);
            });
        }

        function addCustomer() {
            const form = document.getElementById('customerFormData');
            
            const customer = {
                id: customers.length > 0 ? Math.max(...customers.map(c => c.id)) + 1 : 1,
                name: document.getElementById('customerName').value,
                phone: document.getElementById('customerPhone').value,
                idNumber: document.getElementById('customerId').value,
                age: parseInt(document.getElementById('customerAge').value),
                address: document.getElementById('customerAddress').value,
                neighborhood: document.getElementById('customerNeighborhood').value,
                image: null // In a real app, you would handle file upload
            };
            
            customers.push(customer);
            localStorage.setItem('customers', JSON.stringify(customers));
            
            // Reset form and hide it
            form.reset();
            document.getElementById('customerForm').style.display = 'none';
            
            // Show success message
            showAlert('Customer added successfully!', 'success');
            
            // Refresh table
            renderCustomers();
        }

        function editCustomer(id) {
            const customer = customers.find(c => c.id === id);
            if (!customer) return;
            
            document.getElementById('customerName').value = customer.name;
            document.getElementById('customerPhone').value = customer.phone;
            document.getElementById('customerId').value = customer.idNumber;
            document.getElementById('customerAge').value = customer.age;
            document.getElementById('customerAddress').value = customer.address;
            document.getElementById('customerNeighborhood').value = customer.neighborhood;
            
            // Show form
            document.getElementById('customerForm').style.display = 'block';
            
            // Change form to update mode
            const form = document.getElementById('customerFormData');
            form.onsubmit = function(e) {
                e.preventDefault();
                updateCustomer(id);
            };
        }

        function updateCustomer(id) {
            const customerIndex = customers.findIndex(c => c.id === id);
            if (customerIndex === -1) return;
            
            customers[customerIndex] = {
                ...customers[customerIndex],
                name: document.getElementById('customerName').value,
                phone: document.getElementById('customerPhone').value,
                idNumber: document.getElementById('customerId').value,
                age: parseInt(document.getElementById('customerAge').value),
                address: document.getElementById('customerAddress').value,
                neighborhood: document.getElementById('customerNeighborhood').value
            };
            
            localStorage.setItem('customers', JSON.stringify(customers));
            
            // Reset form and hide it
            document.getElementById('customerFormData').reset();
            document.getElementById('customerForm').style.display = 'none';
            
            // Show success message
            showAlert('Customer updated successfully!', 'success');
            
            // Refresh table
            renderCustomers();
        }

        function deleteCustomer(id) {
            if (confirm('Are you sure you want to delete this customer?')) {
                customers = customers.filter(c => c.id !== id);
                localStorage.setItem('customers', JSON.stringify(customers));
                
                // Show success message
                showAlert('Customer deleted successfully!', 'success');
                
                // Refresh table
                renderCustomers();
            }
        }

        function searchCustomers() {
            const query = document.getElementById('customerSearch').value.toLowerCase();
            
            if (!query) {
                renderCustomers();
                return;
            }
            
            const filteredCustomers = customers.filter(customer => 
                customer.name.toLowerCase().includes(query) ||
                customer.phone.toLowerCase().includes(query) ||
                customer.idNumber.toLowerCase().includes(query)
            );
            
            renderCustomers(filteredCustomers);
        }

        // Rental Management
        function renderRentals(filteredRentals = null) {
            const rentalsTable = document.getElementById('rentalsTable').querySelector('tbody');
            rentalsTable.innerHTML = '';
            
            const rentalsToRender = filteredRentals || rentals;
            
            if (rentalsToRender.length === 0) {
                rentalsTable.innerHTML = '<tr><td colspan="9" style="text-align: center;">No rentals found</td></tr>';
                return;
            }
            
            rentalsToRender.forEach(rental => {
                const customer = customers.find(c => c.id === rental.customerId);
                const vehicle = vehicles.find(v => v.id === rental.vehicleId);
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${rental.id}</td>
                    <td>${customer ? customer.name : 'Unknown'}</td>
                    <td>${vehicle ? vehicle.name : 'Unknown'}</td>
                    <td>${rental.startDate}</td>
                    <td>${rental.endDate}</td>
                    <td>$${rental.dailyRate}</td>
                    <td>$${rental.totalAmount}</td>
                    <td>${rental.status}</td>
                    <td class="action-buttons">
                        <button class="btn btn-primary" onclick="completeRental(${rental.id})">Complete</button>
                        <button class="btn btn-danger" onclick="cancelRental(${rental.id})">Cancel</button>
                        <button class="btn btn-warning" onclick="printInvoice(${rental.id})">Invoice</button>
                    </td>
                `;
                rentalsTable.appendChild(row);
            });
        }

        function addRental() {
            const customerInput = document.getElementById('rentalCustomer');
            const vehicleInput = document.getElementById('rentalVehicle');
            
            // Find customer and vehicle by name
            const customer = customers.find(c => c.name === customerInput.value);
            const vehicle = vehicles.find(v => v.name === vehicleInput.value);
            
            if (!customer || !vehicle) {
                showAlert('Please select valid customer and vehicle', 'danger');
                return;
            }
            
            const startDate = new Date(document.getElementById('rentalStartDate').value);
            const endDate = new Date(document.getElementById('rentalEndDate').value);
            const dailyRate = parseFloat(document.getElementById('dailyRate').value);
            
            // Calculate days and total
            const days = Math.ceil((endDate - startDate) / (1000 * 60 * 60 * 24));
            const totalAmount = days * dailyRate;
            
            const rental = {
                id: rentals.length > 0 ? Math.max(...rentals.map(r => r.id)) + 1 : 1,
                customerId: customer.id,
                vehicleId: vehicle.id,
                startDate: document.getElementById('rentalStartDate').value,
                endDate: document.getElementById('rentalEndDate').value,
                dailyRate: dailyRate,
                totalAmount: totalAmount,
                status: 'Active'
            };
            
            rentals.push(rental);
            localStorage.setItem('rentals', JSON.stringify(rentals));
            
            // Reset form and hide it
            document.getElementById('rentalFormData').reset();
            document.getElementById('rentalForm').style.display = 'none';
            
            // Show success message
            showAlert('Rental created successfully!', 'success');
            
            // Refresh table
            renderRentals();
        }

        function completeRental(id) {
            const rentalIndex = rentals.findIndex(r => r.id === id);
            if (rentalIndex === -1) return;
            
            rentals[rentalIndex].status = 'Completed';
            localStorage.setItem('rentals', JSON.stringify(rentals));
            
            // Show success message
            showAlert('Rental completed successfully!', 'success');
            
            // Refresh table
            renderRentals();
        }

        function cancelRental(id) {
            if (confirm('Are you sure you want to cancel this rental?')) {
                const rentalIndex = rentals.findIndex(r => r.id === id);
                if (rentalIndex === -1) return;
                
                rentals[rentalIndex].status = 'Cancelled';
                localStorage.setItem('rentals', JSON.stringify(rentals));
                
                // Show success message
                showAlert('Rental cancelled successfully!', 'success');
                
                // Refresh table
                renderRentals();
            }
        }

        function searchRentals() {
            const query = document.getElementById('rentalSearch').value.toLowerCase();
            
            if (!query) {
                renderRentals();
                return;
            }
            
            const filteredRentals = rentals.filter(rental => {
                const customer = customers.find(c => c.id === rental.customerId);
                const vehicle = vehicles.find(v => v.id === rental.vehicleId);
                
                return (
                    (customer && customer.name.toLowerCase().includes(query)) ||
                    (vehicle && vehicle.name.toLowerCase().includes(query))
                );
            });
            
            renderRentals(filteredRentals);
        }

        // Reports
        function renderReports() {
            const reportsTable = document.getElementById('reportsTable').querySelector('tbody');
            reportsTable.innerHTML = '';
            
            if (rentals.length === 0) {
                reportsTable.innerHTML = '<tr><td colspan="8" style="text-align: center;">No rental data found</td></tr>';
                return;
            }
            
            rentals.forEach(rental => {
                const customer = customers.find(c => c.id === rental.customerId);
                const vehicle = vehicles.find(v => v.id === rental.vehicleId);
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${rental.id}</td>
                    <td>${customer ? customer.name : 'Unknown'}</td>
                    <td>${vehicle ? vehicle.name : 'Unknown'}</td>
                    <td>${rental.startDate}</td>
                    <td>${rental.endDate}</td>
                    <td>$${rental.dailyRate}</td>
                    <td>$${rental.totalAmount}</td>
                    <td>${rental.status}</td>
                `;
                reportsTable.appendChild(row);
            });
        }

        function generateReport() {
            const startDate = document.getElementById('reportStartDate').value;
            const endDate = document.getElementById('reportEndDate').value;
            const searchQuery = document.getElementById('reportSearch').value.toLowerCase();
            
            let filteredRentals = rentals;
            
            // Filter by date range
            if (startDate && endDate) {
                filteredRentals = filteredRentals.filter(rental => {
                    const rentalStart = new Date(rental.startDate);
                    const filterStart = new Date(startDate);
                    const filterEnd = new Date(endDate);
                    
                    return rentalStart >= filterStart && rentalStart <= filterEnd;
                });
            }
            
            // Filter by search query
            if (searchQuery) {
                filteredRentals = filteredRentals.filter(rental => {
                    const customer = customers.find(c => c.id === rental.customerId);
                    const vehicle = vehicles.find(v => v.id === rental.vehicleId);
                    
                    return (
                        (customer && customer.name.toLowerCase().includes(searchQuery)) ||
                        (vehicle && vehicle.name.toLowerCase().includes(searchQuery)) ||
                        rental.id.toString().includes(searchQuery)
                    );
                });
            }
            
            // Update reports table
            const reportsTable = document.getElementById('reportsTable').querySelector('tbody');
            reportsTable.innerHTML = '';
            
            if (filteredRentals.length === 0) {
                reportsTable.innerHTML = '<tr><td colspan="8" style="text-align: center;">No matching rentals found</td></tr>';
                return;
            }
            
            filteredRentals.forEach(rental => {
                const customer = customers.find(c => c.id === rental.customerId);
                const vehicle = vehicles.find(v => v.id === rental.vehicleId);
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${rental.id}</td>
                    <td>${customer ? customer.name : 'Unknown'}</td>
                    <td>${vehicle ? vehicle.name : 'Unknown'}</td>
                    <td>${rental.startDate}</td>
                    <td>${rental.endDate}</td>
                    <td>$${rental.dailyRate}</td>
                    <td>$${rental.totalAmount}</td>
                    <td>${rental.status}</td>
                `;
                reportsTable.appendChild(row);
            });
        }

        // Settings
        function loadSettings() {
            document.getElementById('systemName').value = settings.systemName;
            document.getElementById('companyName').value = settings.companyName;
            document.getElementById('companyAddress').value = settings.companyAddress;
            document.getElementById('companyPhone').value = settings.companyPhone;
            document.getElementById('taxRate').value = settings.taxRate;
            
            // Update system name in header
            document.querySelector('.system-name').textContent = settings.systemName;
        }

        function saveSettings() {
            settings = {
                systemName: document.getElementById('systemName').value,
                companyName: document.getElementById('companyName').value,
                companyAddress: document.getElementById('companyAddress').value,
                companyPhone: document.getElementById('companyPhone').value,
                taxRate: parseInt(document.getElementById('taxRate').value)
            };
            
            localStorage.setItem('settings', JSON.stringify(settings));
            
            // Update system name in header
            document.querySelector('.system-name').textContent = settings.systemName;
            
            showAlert('Settings saved successfully!', 'success');
        }

        // Backup & Restore
        function createBackup() {
            const data = {
                vehicles: vehicles,
                customers: customers,
                rentals: rentals,
                settings: settings,
                backupDate: new Date().toISOString()
            };
            
            const dataStr = JSON.stringify(data, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `lsyara-backup-${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            showAlert('Backup created successfully!', 'success');
        }

        function restoreBackup() {
            document.getElementById('backupFile').click();
        }

        function handleBackupFile(e) {
            const file = e.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(event) {
                try {
                    const data = JSON.parse(event.target.result);
                    
                    if (data.vehicles) vehicles = data.vehicles;
                    if (data.customers) customers = data.customers;
                    if (data.rentals) rentals = data.rentals;
                    if (data.settings) settings = data.settings;
                    
                    localStorage.setItem('vehicles', JSON.stringify(vehicles));
                    localStorage.setItem('customers', JSON.stringify(customers));
                    localStorage.setItem('rentals', JSON.stringify(rentals));
                    localStorage.setItem('settings', JSON.stringify(settings));
                    
                    // Refresh all data
                    loadSettings();
                    renderVehicles();
                    renderCustomers();
                    renderRentals();
                    renderReports();
                    
                    showAlert('Backup restored successfully!', 'success');
                } catch (error) {
                    showAlert('Error restoring backup: Invalid file format', 'danger');
                }
            };
            reader.readAsText(file);
            
            // Reset file input
            e.target.value = '';
        }

        // Utility Functions
        function showAlert(message, type) {
            const alertDiv = document.createElement('div');
            alertDiv.className = `alert alert-${type}`;
            alertDiv.textContent = message;
            
            document.querySelector('.container').insertBefore(alertDiv, document.querySelector('.tab-content.active'));
            
            setTimeout(() => {
                alertDiv.remove();
            }, 5000);
        }

        function setupEventListeners() {
            // Vehicle events
            document.getElementById('addVehicleBtn').addEventListener('click', function() {
                document.getElementById('vehicleForm').style.display = 'block';
                document.getElementById('vehicleFormData').reset();
                document.getElementById('vehicleFormData').onsubmit = function(e) {
                    e.preventDefault();
                    addVehicle();
                };
            });
            
            document.getElementById('cancelVehicleBtn').addEventListener('click', function() {
                document.getElementById('vehicleForm').style.display = 'none';
            });
            
            document.getElementById('vehicleSearchBtn').addEventListener('click', searchVehicles);
            document.getElementById('vehicleResetBtn').addEventListener('click', function() {
                document.getElementById('vehicleSearch').value = '';
                renderVehicles();
            });
            
            // Customer events
            document.getElementById('addCustomerBtn').addEventListener('click', function() {
                document.getElementById('customerForm').style.display = 'block';
                document.getElementById('customerFormData').reset();
                document.getElementById('customerFormData').onsubmit = function(e) {
                    e.preventDefault();
                    addCustomer();
                };
            });
            
            document.getElementById('cancelCustomerBtn').addEventListener('click', function() {
                document.getElementById('customerForm').style.display = 'none';
            });
            
            document.getElementById('customerSearchBtn').addEventListener('click', searchCustomers);
            document.getElementById('customerResetBtn').addEventListener('click', function() {
                document.getElementById('customerSearch').value = '';
                renderCustomers();
            });
            
            // Rental events
            document.getElementById('addRentalBtn').addEventListener('click', function() {
                document.getElementById('rentalForm').style.display = 'block';
                document.getElementById('rentalFormData').reset();
                document.getElementById('rentalFormData').onsubmit = function(e) {
                    e.preventDefault();
                    addRental();
                };
            });
            
            document.getElementById('cancelRentalBtn').addEventListener('click', function() {
                document.getElementById('rentalForm').style.display = 'none';
            });
            
            document.getElementById('rentalSearchBtn').addEventListener('click', searchRentals);
            document.getElementById('rentalResetBtn').addEventListener('click', function() {
                document.getElementById('rentalSearch').value = '';
                renderRentals();
            });
            
            // Report events
            document.getElementById('generateReportBtn').addEventListener('click', generateReport);
            document.getElementById('resetReportBtn').addEventListener('click', function() {
                document.getElementById('reportStartDate').value = '';
                document.getElementById('reportEndDate').value = '';
                document.getElementById('reportSearch').value = '';
                renderReports();
            });
            
            // Settings events
            document.getElementById('saveSettingsBtn').addEventListener('click', saveSettings);
            document.getElementById('backupBtn').addEventListener('click', createBackup);
            document.getElementById('restoreBtn').addEventListener('click', restoreBackup);
            document.getElementById('backupFile').addEventListener('change', handleBackupFile);
            
            // Auto-suggestions for rental form
            document.getElementById('rentalCustomer').addEventListener('input', function() {
                const query = this.value.toLowerCase();
                const suggestions = document.getElementById('customerSuggestions');
                
                if (!query) {
                    suggestions.style.display = 'none';
                    return;
                }
                
                const filteredCustomers = customers.filter(c => 
                    c.name.toLowerCase().includes(query)
                );
                
                suggestions.innerHTML = '';
                filteredCustomers.forEach(customer => {
                    const div = document.createElement('div');
                    div.className = 'suggestion-item';
                    div.textContent = customer.name;
                    div.addEventListener('click', function() {
                        document.getElementById('rentalCustomer').value = customer.name;
                        suggestions.style.display = 'none';
                    });
                    suggestions.appendChild(div);
                });
                
                suggestions.style.display = 'block';
            });
            
            document.getElementById('rentalVehicle').addEventListener('input', function() {
                const query = this.value.toLowerCase();
                const suggestions = document.getElementById('vehicleSuggestions');
                
                if (!query) {
                    suggestions.style.display = 'none';
                    return;
                }
                
                const filteredVehicles = vehicles.filter(v => 
                    v.name.toLowerCase().includes(query)
                );
                
                suggestions.innerHTML = '';
                filteredVehicles.forEach(vehicle => {
                    const div = document.createElement('div');
                    div.className = 'suggestion-item';
                    div.textContent = vehicle.name;
                    div.addEventListener('click', function() {
                        document.getElementById('rentalVehicle').value = vehicle.name;
                        suggestions.style.display = 'none';
                    });
                    suggestions.appendChild(div);
                });
                
                suggestions.style.display = 'block';
            });
            
            // Calculate rental total when dates or rate change
            const rentalCalcFields = ['rentalStartDate', 'rentalEndDate', 'dailyRate'];
            rentalCalcFields.forEach(field => {
                document.getElementById(field).addEventListener('change', calculateRentalTotal);
            });
        }

        function calculateRentalTotal() {
            const startDate = document.getElementById('rentalStartDate').value;
            const endDate = document.getElementById('rentalEndDate').value;
            const dailyRate = document.getElementById('dailyRate').value;
            
            if (startDate && endDate && dailyRate) {
                const start = new Date(startDate);
                const end = new Date(endDate);
                const days = Math.ceil((end - start) / (1000 * 60 * 60 * 24));
                
                if (days > 0) {
                    const total = days * parseFloat(dailyRate);
                    document.getElementById('totalAmount').value = total.toFixed(2);
                }
            }
        }

        function printInvoice(rentalId) {
            const rental = rentals.find(r => r.id === rentalId);
            if (!rental) return;
            
            const customer = customers.find(c => c.id === rental.customerId);
            const vehicle = vehicles.find(v => v.id === rental.vehicleId);
            
            // Create invoice HTML
            const invoiceHTML = `
                <div class="invoice">
                    <div class="invoice-header">
                        <h2>${settings.companyName}</h2>
                        <p>${settings.companyAddress}</p>
                        <p>Phone: ${settings.companyPhone}</p>
                    </div>
                    
                    <div class="invoice-details">
                        <div>
                            <h3>Customer Details</h3>
                            <p><strong>Name:</strong> ${customer ? customer.name : 'Unknown'}</p>
                            <p><strong>Phone:</strong> ${customer ? customer.phone : 'N/A'}</p>
                            <p><strong>ID:</strong> ${customer ? customer.idNumber : 'N/A'}</p>
                        </div>
                        <div>
                            <h3>Invoice Details</h3>
                            <p><strong>Invoice #:</strong> INV-${rental.id}</p>
                            <p><strong>Date:</strong> ${new Date().toLocaleDateString()}</p>
                            <p><strong>Status:</strong> ${rental.status}</p>
                        </div>
                    </div>
                    
                    <div class="invoice-items">
                        <h3>Rental Details</h3>
                        <table>
                            <thead>
                                <tr>
                                    <th>Vehicle</th>
                                    <th>Start Date</th>
                                    <th>End Date</th>
                                    <th>Daily Rate</th>
                                    <th>Total</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>${vehicle ? vehicle.name : 'Unknown'}</td>
                                    <td>${rental.startDate}</td>
                                    <td>${rental.endDate}</td>
                                    <td>$${rental.dailyRate}</td>
                                    <td>$${rental.totalAmount}</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    
                    <div class="invoice-total">
                        <p>Total Amount: $${rental.totalAmount}</p>
                        <p>Tax (${settings.taxRate}%): $${(rental.totalAmount * settings.taxRate / 100).toFixed(2)}</p>
                        <p>Grand Total: $${(rental.totalAmount * (1 + settings.taxRate / 100)).toFixed(2)}</p>
                    </div>
                    
                    <div style="margin-top: 30px; text-align: center;">
                        <p>Thank you for your business!</p>
                        <p>Developed by Farzad Programmer</p>
                    </div>
                </div>
            `;
            
            // Open print window
            const printWindow = window.open('', '_blank');
            printWindow.document.write(`
                <html>
                    <head>
                        <title>Invoice #INV-${rental.id}</title>
                        <style>
                            body { font-family: Arial, sans-serif; }
                            .invoice { border: 1px solid #ddd; padding: 20px; }
                            .invoice-header { text-align: center; margin-bottom: 20px; }
                            .invoice-details { display: flex; justify-content: space-between; margin-bottom: 20px; }
                            table { width: 100%; border-collapse: collapse; margin-top: 20px; }
                            th, td { padding: 10px; border-bottom: 1px solid #ddd; text-align: left; }
                            .invoice-total { text-align: right; font-weight: bold; margin-top: 20px; }
                        </style>
                    </head>
                    <body>
                        ${invoiceHTML}
                    </body>
                </html>
            `);
            printWindow.document.close();
            printWindow.print();
        }
    </script>
</body>
</html>