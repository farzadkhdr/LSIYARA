<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Car Rental System</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #3498db;
            --secondary-color: #2c3e50;
            --success-color: #27ae60;
            --danger-color: #e74c3c;
            --warning-color: #f39c12;
            --info-color: #17a2b8;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f8f9fa;
        }
        
        .navbar-brand {
            font-weight: bold;
        }
        
        .sidebar {
            background-color: var(--secondary-color);
            color: white;
            min-height: calc(100vh - 56px);
            padding: 0;
        }
        
        .sidebar .nav-link {
            color: rgba(255, 255, 255, 0.8);
            padding: 12px 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .sidebar .nav-link:hover, .sidebar .nav-link.active {
            background-color: rgba(255, 255, 255, 0.1);
            color: white;
        }
        
        .sidebar .nav-link i {
            margin-right: 10px;
            width: 20px;
            text-align: center;
        }
        
        .card {
            border: none;
            box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075);
            margin-bottom: 20px;
        }
        
        .card-header {
            background-color: white;
            border-bottom: 1px solid rgba(0, 0, 0, 0.125);
            font-weight: 600;
        }
        
        .dashboard-card {
            transition: transform 0.3s;
        }
        
        .dashboard-card:hover {
            transform: translateY(-5px);
        }
        
        .table-responsive {
            border-radius: 5px;
        }
        
        .tab-content {
            padding: 20px;
            background-color: white;
            border-radius: 0 0 5px 5px;
        }
        
        .nav-tabs .nav-link.active {
            border-bottom: 3px solid var(--primary-color);
            font-weight: 600;
        }
        
        .form-control:focus, .form-select:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 0.25rem rgba(52, 152, 219, 0.25);
        }
        
        .btn-primary {
            background-color: var(--primary-color);
            border-color: var(--primary-color);
        }
        
        .btn-success {
            background-color: var(--success-color);
            border-color: var(--success-color);
        }
        
        .btn-danger {
            background-color: var(--danger-color);
            border-color: var(--danger-color);
        }
        
        .btn-warning {
            background-color: var(--warning-color);
            border-color: var(--warning-color);
        }
        
        .logo-container {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 15px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .system-name {
            font-size: 1.2rem;
            font-weight: bold;
            margin-left: 10px;
        }
        
        .copyright {
            position: absolute;
            bottom: 10px;
            width: 100%;
            text-align: center;
            font-size: 0.8rem;
            color: rgba(255, 255, 255, 0.6);
        }
        
        .print-only {
            display: none;
        }
        
        @media print {
            .no-print {
                display: none !important;
            }
            .print-only {
                display: block;
            }
            body {
                background-color: white;
            }
            .card {
                box-shadow: none;
                border: 1px solid #ddd;
            }
        }
        
        .vehicle-details, .customer-details {
            display: none;
            margin-top: 20px;
        }
        
        .suggestion-list {
            position: absolute;
            background: white;
            border: 1px solid #ddd;
            max-height: 200px;
            overflow-y: auto;
            z-index: 1000;
            width: 100%;
            display: none;
        }
        
        .suggestion-item {
            padding: 8px 12px;
            cursor: pointer;
        }
        
        .suggestion-item:hover {
            background-color: #f8f9fa;
        }
        
        .status-returned {
            background-color: #d4edda;
        }
        
        .status-not-returned {
            background-color: #f8d7da;
        }
        
        .login-container {
            max-width: 400px;
            margin: 100px auto;
            padding: 20px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
        }
        
        .invoice-logo {
            text-align: center;
            margin-bottom: 20px;
        }
        
        .invoice-logo img {
            max-width: 200px;
            height: auto;
        }
        
        .custom-logo {
            max-height: 50px;
            margin-right: 10px;
        }
        
        .currency-badge {
            font-size: 0.7rem;
            margin-left: 5px;
        }
        
        .user-only {
            display: none;
        }
        
        .system-logo-large {
            max-width: 200px;
            max-height: 80px;
            margin-bottom: 15px;
        }
        
        .signature-area {
            margin-top: 50px;
            border-top: 1px solid #000;
            padding-top: 10px;
        }
        
        .maintenance-status {
            background-color: #fff3cd;
        }
        
        .notification-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background-color: red;
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
        }
        
        .vehicle-image {
            max-width: 200px;
            max-height: 150px;
            object-fit: cover;
            border-radius: 5px;
            margin-bottom: 10px;
        }
    </style>
</head>
<body>
    <!-- Login Screen -->
    <div id="loginScreen" class="login-container">
        <div class="text-center mb-4">
            <i class="fas fa-car fa-3x text-primary mb-3"></i>
            <h2>Car Rental System</h2>
            <p class="text-muted">Please login to continue</p>
        </div>
        <form id="loginForm">
            <div class="mb-3">
                <label for="username" class="form-label">Username</label>
                <input type="text" class="form-control" id="username" required>
            </div>
            <div class="mb-3">
                <label for="password" class="form-label">Password</label>
                <input type="password" class="form-control" id="password" required>
            </div>
            <button type="submit" class="btn btn-primary w-100">Login</button>
        </form>
        <div class="text-center mt-3">
            <small class="text-muted">Default admin password: 000000</small>
        </div>
        <div class="text-center mt-4">
            <small class="text-muted">Created by Farzad Programmer - Not Editable</small>
        </div>
    </div>

    <!-- Main Application -->
    <div id="mainApp" style="display: none;">
        <!-- Navigation Bar -->
        <nav class="navbar navbar-expand-lg navbar-dark bg-dark no-print">
            <div class="container-fluid">
                <a class="navbar-brand" href="#">
                    <img id="headerLogo" src="" class="custom-logo" style="display: none;">
                    <span id="headerSystemName">Car Rental System</span>
                </a>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarNav">
                    <ul class="navbar-nav ms-auto">
                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-bs-toggle="dropdown">
                                <i class="fas fa-user-circle"></i> <span id="currentUser">Admin</span>
                            </a>
                            <ul class="dropdown-menu">
                                <li><a class="dropdown-item" href="#" data-bs-toggle="modal" data-bs-target="#changePasswordModal"><i class="fas fa-key"></i> Change Password</a></li>
                                <li class="admin-only"><a class="dropdown-item" href="#" data-bs-toggle="modal" data-bs-target="#userManagementModal"><i class="fas fa-users"></i> User Management</a></li>
                                <li class="admin-only"><a class="dropdown-item" href="#" data-bs-toggle="modal" data-bs-target="#backupModal"><i class="fas fa-database"></i> Backup & Restore</a></li>
                                <li><hr class="dropdown-divider"></li>
                                <li><a class="dropdown-item" href="#" id="logoutBtn"><i class="fas fa-sign-out-alt"></i> Logout</a></li>
                            </ul>
                        </li>
                    </ul>
                </div>
            </div>
        </nav>

        <div class="container-fluid">
            <div class="row">
                <!-- Sidebar -->
                <div class="col-md-2 sidebar d-none d-md-block no-print">
                    <div class="logo-container">
                        <img id="sidebarLogo" src="" class="system-logo-large" style="display: none;">
                        <span class="system-name" id="sidebarSystemName">RentalSys</span>
                    </div>
                    <ul class="nav flex-column">
                        <li class="nav-item dashboard-item">
                            <a class="nav-link active" href="#dashboard" data-bs-toggle="tab">
                                <i class="fas fa-tachometer-alt"></i> Dashboard
                            </a>
                        </li>
                        <li class="nav-item vehicles-item">
                            <a class="nav-link" href="#vehicles" data-bs-toggle="tab">
                                <i class="fas fa-car"></i> Vehicles
                            </a>
                        </li>
                        <li class="nav-item customers-item">
                            <a class="nav-link" href="#customers" data-bs-toggle="tab">
                                <i class="fas fa-users"></i> Customers
                            </a>
                        </li>
                        <li class="nav-item rentals-item">
                            <a class="nav-link" href="#rentals" data-bs-toggle="tab">
                                <i class="fas fa-receipt"></i> Rentals
                            </a>
                        </li>
                        <li class="nav-item returns-item">
                            <a class="nav-link" href="#returns" data-bs-toggle="tab">
                                <i class="fas fa-undo"></i> Vehicle Returns
                            </a>
                        </li>
                        <li class="nav-item maintenance-item">
                            <a class="nav-link" href="#maintenance" data-bs-toggle="tab">
                                <i class="fas fa-tools"></i> Vehicle Maintenance
                            </a>
                        </li>
                        <li class="nav-item payments-item">
                            <a class="nav-link" href="#payments" data-bs-toggle="tab">
                                <i class="fas fa-money-bill-wave"></i> Payments
                            </a>
                        </li>
                        <li class="nav-item fines-item">
                            <a class="nav-link" href="#fines" data-bs-toggle="tab">
                                <i class="fas fa-gavel"></i> Fines & Taxes
                            </a>
                        </li>
                        <li class="nav-item reports-item">
                            <a class="nav-link" href="#reports" data-bs-toggle="tab">
                                <i class="fas fa-chart-bar"></i> Reports
                            </a>
                        </li>
                        <li class="nav-item frr-item">
                            <a class="nav-link" href="#frr" data-bs-toggle="tab">
                                <i class="fas fa-file-alt"></i> F.RETU.RENT
                            </a>
                        </li>
                        <li class="nav-item admin-only settings-item">
                            <a class="nav-link" href="#settings" data-bs-toggle="tab">
                                <i class="fas fa-cogs"></i> System Settings
                            </a>
                        </li>
                    </ul>
                    <div class="copyright">
                        Created by Farzad Programmer<br>Not Editable
                    </div>
                </div>

                <!-- Main Content -->
                <div class="col-md-10 ms-sm-auto col-lg-10 px-4">
                    <div class="tab-content mt-4">
                        <!-- Dashboard Tab -->
                        <div class="tab-pane fade show active" id="dashboard">
                            <h2 class="mb-4">Dashboard</h2>
                            <div class="row" id="dashboardStats">
                                <!-- Dashboard statistics will be loaded here -->
                            </div>
                            
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="card">
                                        <div class="card-header">
                                            Recent Rentals
                                        </div>
                                        <div class="card-body">
                                            <div class="table-responsive">
                                                <table class="table table-hover">
                                                    <thead>
                                                        <tr>
                                                            <th>Customer</th>
                                                            <th>Vehicle</th>
                                                            <th>Date</th>
                                                            <th>Amount</th>
                                                            <th>Status</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody id="recentRentalsTable">
                                                        <!-- Recent rentals will be loaded here -->
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="card">
                                        <div class="card-header">
                                            Vehicle Status
                                        </div>
                                        <div class="card-body">
                                            <canvas id="vehicleStatusChart" width="400" height="200"></canvas>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Vehicles Tab -->
                        <div class="tab-pane fade" id="vehicles">
                            <h2 class="mb-4">Vehicle Management</h2>
                            
                            <ul class="nav nav-tabs mb-3">
                                <li class="nav-item">
                                    <a class="nav-link active" data-bs-toggle="tab" href="#addVehicle">Add Vehicle</a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" data-bs-toggle="tab" href="#vehicleList">Vehicle List</a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" data-bs-toggle="tab" href="#vehicleHistory">Vehicle History</a>
                                </li>
                            </ul>
                            
                            <div class="tab-content">
                                <div class="tab-pane fade show active" id="addVehicle">
                                    <div class="card">
                                        <div class="card-header">
                                            Add New Vehicle
                                        </div>
                                        <div class="card-body">
                                            <form id="addVehicleForm">
                                                <div class="row">
                                                    <div class="col-md-6 mb-3">
                                                        <label for="vehicleName" class="form-label">Vehicle Name</label>
                                                        <input type="text" class="form-control" id="vehicleName" required>
                                                    </div>
                                                    <div class="col-md-6 mb-3">
                                                        <label for="vehicleOdometer" class="form-label">Odometer</label>
                                                        <input type="number" class="form-control" id="vehicleOdometer" required>
                                                    </div>
                                                </div>
                                                <div class="row">
                                                    <div class="col-md-6 mb-3">
                                                        <label for="vehicleVin" class="form-label">VIN #</label>
                                                        <input type="text" class="form-control" id="vehicleVin" required>
                                                    </div>
                                                    <div class="col-md-6 mb-3">
                                                        <label for="vehiclePlate" class="form-label">Plate Number</label>
                                                        <input type="text" class="form-control" id="vehiclePlate" required>
                                                    </div>
                                                </div>
                                                <div class="row">
                                                    <div class="col-md-6 mb-3">
                                                        <label for="vehicleColor" class="form-label">Color</label>
                                                        <input type="text" class="form-control" id="vehicleColor" placeholder="Type color..." required>
                                                        <div class="suggestion-list" id="colorSuggestions"></div>
                                                    </div>
                                                    <div class="col-md-6 mb-3">
                                                        <label for="vehicleModel" class="form-label">Model</label>
                                                        <select class="form-select" id="vehicleModel" required>
                                                            <option value="">Select Model Year</option>
                                                            <!-- Model years will be populated by JavaScript -->
                                                        </select>
                                                    </div>
                                                </div>
                                                <div class="row">
                                                    <div class="col-md-6 mb-3">
                                                        <label for="vehicleRentalPrice" class="form-label">Rental Price (per day)</label>
                                                        <div class="input-group">
                                                            <input type="number" class="form-control" id="vehicleRentalPrice" required>
                                                            <span class="input-group-text">AED</span>
                                                        </div>
                                                    </div>
                                                    <div class="col-md-6 mb-3">
                                                        <label for="vehicleImage" class="form-label">Vehicle Image</label>
                                                        <input type="file" class="form-control" id="vehicleImage" accept="image/*">
                                                    </div>
                                                </div>
                                                <button type="submit" class="btn btn-primary">Add Vehicle</button>
                                            </form>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="tab-pane fade" id="vehicleList">
                                    <div class="card">
                                        <div class="card-header d-flex justify-content-between align-items-center">
                                            <span>Vehicle List</span>
                                            <div class="input-group" style="width: 300px;">
                                                <input type="text" class="form-control" id="vehicleSearch" placeholder="Search vehicles...">
                                                <button class="btn btn-outline-secondary" type="button" id="vehicleSearchBtn">
                                                    <i class="fas fa-search"></i>
                                                </button>
                                            </div>
                                        </div>
                                        <div class="card-body">
                                            <div class="table-responsive">
                                                <table class="table table-hover">
                                                    <thead>
                                                        <tr>
                                                            <th>Image</th>
                                                            <th>Name</th>
                                                            <th>Model</th>
                                                            <th>Color</th>
                                                            <th>Plate #</th>
                                                            <th>Odometer</th>
                                                            <th>Rental Price</th>
                                                            <th>Status</th>
                                                            <th>Actions</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody id="vehicleTableBody">
                                                        <!-- Vehicle data will be populated here -->
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Vehicle Details Section -->
                                    <div class="card vehicle-details" id="vehicleDetailsCard">
                                        <div class="card-header d-flex justify-content-between align-items-center">
                                            <span>Vehicle Details</span>
                                            <button class="btn btn-sm btn-secondary" id="closeVehicleDetails">Close</button>
                                        </div>
                                        <div class="card-body" id="vehicleDetailsContent">
                                            <!-- Vehicle details will be populated here -->
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="tab-pane fade" id="vehicleHistory">
                                    <div class="card">
                                        <div class="card-header d-flex justify-content-between align-items-center">
                                            <span>Vehicle Rental History</span>
                                            <div class="input-group" style="width: 300px;">
                                                <input type="text" class="form-control" id="vehicleHistorySearch" placeholder="Search by vehicle name...">
                                                <button class="btn btn-outline-secondary" type="button" id="vehicleHistorySearchBtn">
                                                    <i class="fas fa-search"></i>
                                                </button>
                                            </div>
                                        </div>
                                        <div class="card-body">
                                            <div class="table-responsive">
                                                <table class="table table-hover">
                                                    <thead>
                                                        <tr>
                                                            <th>Vehicle</th>
                                                            <th>Customer</th>
                                                            <th>Rental Date</th>
                                                            <th>Return Date</th>
                                                            <th>Amount</th>
                                                            <th>Status</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody id="vehicleHistoryTableBody">
                                                        <!-- Vehicle history will be populated here -->
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Customers Tab -->
                        <div class="tab-pane fade" id="customers">
                            <h2 class="mb-4">Customer Management</h2>
                            
                            <ul class="nav nav-tabs mb-3">
                                <li class="nav-item">
                                    <a class="nav-link active" data-bs-toggle="tab" href="#addCustomer">Add Customer</a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" data-bs-toggle="tab" href="#customerList">Customer List</a>
                                </li>
                            </ul>
                            
                            <div class="tab-content">
                                <div class="tab-pane fade show active" id="addCustomer">
                                    <div class="card">
                                        <div class="card-header">
                                            Add New Customer
                                        </div>
                                        <div class="card-body">
                                            <form id="addCustomerForm">
                                                <div class="row">
                                                    <div class="col-md-6 mb-3">
                                                        <label for="customerFullName" class="form-label">Full Name</label>
                                                        <input type="text" class="form-control" id="customerFullName" required>
                                                    </div>
                                                    <div class="col-md-6 mb-3">
                                                        <label for="customerAge" class="form-label">Age</label>
                                                        <input type="number" class="form-control" id="customerAge" required>
                                                    </div>
                                                </div>
                                                <div class="row">
                                                    <div class="col-md-6 mb-3">
                                                        <label for="customerId" class="form-label">PS/ID</label>
                                                        <input type="text" class="form-control" id="customerId" required>
                                                    </div>
                                                    <div class="col-md-6 mb-3">
                                                        <label for="customerNationality" class="form-label">Nationality</label>
                                                        <input type="text" class="form-control" id="customerNationality" placeholder="Type country name..." required>
                                                        <div class="suggestion-list" id="nationalitySuggestions"></div>
                                                    </div>
                                                </div>
                                                <div class="row">
                                                    <div class="col-md-6 mb-3">
                                                        <label for="customerContact" class="form-label">Contact Number</label>
                                                        <input type="text" class="form-control" id="customerContact" required>
                                                    </div>
                                                    <div class="col-md-6 mb-3">
                                                        <label for="customerAddress" class="form-label">Address</label>
                                                        <input type="text" class="form-control" id="customerAddress" required>
                                                    </div>
                                                </div>
                                                <div class="mb-3">
                                                    <label for="guaranteeDoc" class="form-label">Guarantee / Document</label>
                                                    <input type="file" class="form-control" id="guaranteeDoc">
                                                </div>
                                                <button type="submit" class="btn btn-primary">Add Customer</button>
                                            </form>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="tab-pane fade" id="customerList">
                                    <div class="card">
                                        <div class="card-header d-flex justify-content-between align-items-center">
                                            <span>Customer List</span>
                                            <div class="input-group" style="width: 300px;">
                                                <input type="text" class="form-control" id="customerSearch" placeholder="Search customers...">
                                                <button class="btn btn-outline-secondary" type="button" id="customerSearchBtn">
                                                    <i class="fas fa-search"></i>
                                                </button>
                                            </div>
                                        </div>
                                        <div class="card-body">
                                            <div class="table-responsive">
                                                <table class="table table-hover">
                                                    <thead>
                                                        <tr>
                                                            <th>Full Name</th>
                                                            <th>Age</th>
                                                            <th>ID</th>
                                                            <th>Nationality</th>
                                                            <th>Contact</th>
                                                            <th>Total Debt</th>
                                                            <th>Actions</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody id="customerTableBody">
                                                        <!-- Customer data will be populated here -->
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Customer Details Section -->
                                    <div class="card customer-details" id="customerDetailsCard">
                                        <div class="card-header d-flex justify-content-between align-items-center">
                                            <span>Customer Details</span>
                                            <button class="btn btn-sm btn-secondary" id="closeCustomerDetails">Close</button>
                                        </div>
                                        <div class="card-body" id="customerDetailsContent">
                                            <!-- Customer details will be populated here -->
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Rentals Tab -->
                        <div class="tab-pane fade" id="rentals">
                            <h2 class="mb-4">Rental Management</h2>
                            
                            <div class="card">
                                <div class="card-header">
                                    Create New Rental
                                </div>
                                <div class="card-body">
                                    <form id="createRentalForm">
                                        <div class="row">
                                            <div class="col-md-6 mb-3">
                                                <label for="rentalCustomer" class="form-label">Customer</label>
                                                <input type="text" class="form-control" id="rentalCustomer" placeholder="Search customer...">
                                                <div class="suggestion-list" id="customerSuggestions"></div>
                                            </div>
                                            <div class="col-md-6 mb-3">
                                                <label for="rentalVehicle" class="form-label">Vehicle</label>
                                                <input type="text" class="form-control" id="rentalVehicle" placeholder="Search vehicle...">
                                                <div class="suggestion-list" id="vehicleSuggestions"></div>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-6 mb-3">
                                                <label for="rentalAmount" class="form-label">Rental Amount (per day)</label>
                                                <div class="input-group">
                                                    <input type="number" class="form-control" id="rentalAmount" required>
                                                    <span class="input-group-text">AED</span>
                                                </div>
                                            </div>
                                            <div class="col-md-6 mb-3">
                                                <label for="rentalDays" class="form-label">Rental Days</label>
                                                <input type="number" class="form-control" id="rentalDays" required>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-6 mb-3">
                                                <label for="rentalStartDate" class="form-label">Rental Start Date</label>
                                                <input type="date" class="form-control" id="rentalStartDate" required>
                                            </div>
                                            <div class="col-md-6 mb-3">
                                                <label for="rentalEndDate" class="form-label">Rental End Date</label>
                                                <input type="date" class="form-control" id="rentalEndDate" required>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-6 mb-3">
                                                <label for="invoiceCode" class="form-label">Invoice Code</label>
                                                <input type="text" class="form-control" id="invoiceCode">
                                            </div>
                                        </div>
                                        <button type="submit" class="btn btn-primary">Create Rental</button>
                                    </form>
                                </div>
                            </div>
                            
                            <div class="card mt-4">
                                <div class="card-header d-flex justify-content-between align-items-center">
                                    <span>Rental History</span>
                                    <div class="input-group" style="width: 300px;">
                                        <input type="text" class="form-control" id="rentalSearch" placeholder="Search by invoice code...">
                                        <button class="btn btn-outline-secondary" type="button" id="rentalSearchBtn">
                                            <i class="fas fa-search"></i>
                                        </button>
                                    </div>
                                </div>
                                <div class="card-body">
                                    <div class="table-responsive">
                                        <table class="table table-hover">
                                            <thead>
                                                <tr>
                                                    <th>Invoice Code</th>
                                                    <th>Customer</th>
                                                    <th>Vehicle</th>
                                                    <th>Start Date</th>
                                                    <th>End Date</th>
                                                    <th>Amount</th>
                                                    <th>Status</th>
                                                    <th>Actions</th>
                                                </tr>
                                            </thead>
                                            <tbody id="rentalTableBody">
                                                <!-- Rental data will be populated here -->
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Invoice for Printing -->
                            <div id="invoicePrint" class="print-only" style="display: none;">
                                <div class="invoice-logo">
                                    <img id="printLogo" src="" style="max-width: 200px; display: none;">
                                    <h3 id="printSystemName">Car Rental System</h3>
                                </div>
                                <div class="card">
                                    <div class="card-header text-center">
                                        <h3>Car Rental Invoice</h3>
                                    </div>
                                    <div class="card-body">
                                        <div class="row mb-3">
                                            <div class="col-6">
                                                <strong>Invoice Code:</strong> <span id="printInvoiceCode"></span>
                                            </div>
                                            <div class="col-6 text-end">
                                                <strong>Date:</strong> <span id="printInvoiceDate"></span>
                                            </div>
                                        </div>
                                        <div class="row mb-3">
                                            <div class="col-6">
                                                <strong>Customer:</strong> <span id="printCustomerName"></span>
                                            </div>
                                            <div class="col-6">
                                                <strong>Vehicle:</strong> <span id="printVehicleName"></span>
                                            </div>
                                        </div>
                                        <div class="row mb-3">
                                            <div class="col-6">
                                                <strong>Customer ID:</strong> <span id="printCustomerId"></span>
                                            </div>
                                            <div class="col-6">
                                                <strong>Customer Address:</strong> <span id="printCustomerAddress"></span>
                                            </div>
                                        </div>
                                        <div class="row mb-3">
                                            <div class="col-12">
                                                <strong>Rental Amount (per day):</strong> <span id="printRentalAmount"></span>
                                            </div>
                                        </div>
                                        <div class="row mb-3">
                                            <div class="col-12">
                                                <strong>Rental Days:</strong> <span id="printRentalDays"></span>
                                            </div>
                                        </div>
                                        <div class="row mb-3">
                                            <div class="col-12">
                                                <strong>Rental History:</strong>
                                                <div id="printRentalHistory"></div>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-12">
                                                <hr>
                                                <h4 class="text-end">Total: <span id="printTotalAmount"></span></h4>
                                            </div>
                                        </div>
                                        <div class="row signature-area">
                                            <div class="col-6">
                                                <strong>Customer Signature:</strong>
                                                <div style="height: 50px; border-bottom: 1px solid #000;"></div>
                                            </div>
                                            <div class="col-6 text-end">
                                                <strong>Company Signature:</strong>
                                                <div style="height: 50px; border-bottom: 1px solid #000;"></div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Vehicle Returns Tab -->
                        <div class="tab-pane fade" id="returns">
                            <h2 class="mb-4">Vehicle Returns</h2>
                            
                            <div class="card">
                                <div class="card-header">
                                    Return Vehicle
                                </div>
                                <div class="card-body">
                                    <div class="row mb-3">
                                        <div class="col-md-6">
                                            <label for="returnInvoiceSearch" class="form-label">Search by Invoice Code</label>
                                            <input type="text" class="form-control" id="returnInvoiceSearch" placeholder="Search invoice code...">
                                            <div class="suggestion-list" id="returnInvoiceSuggestions"></div>
                                        </div>
                                        <div class="col-md-6 d-flex align-items-end">
                                            <button class="btn btn-primary me-2" id="searchInvoiceBtn">Search</button>
                                        </div>
                                    </div>
                                    <div id="returnFormContainer" style="display: none;">
                                        <form id="returnVehicleForm">
                                            <div class="row mb-3">
                                                <div class="col-md-6">
                                                    <label class="form-label">Customer</label>
                                                    <input type="text" class="form-control" id="returnCustomer" readonly>
                                                </div>
                                                <div class="col-md-6">
                                                    <label class="form-label">Vehicle</label>
                                                    <input type="text" class="form-control" id="returnVehicle" readonly>
                                                </div>
                                            </div>
                                            <div class="row mb-3">
                                                <div class="col-md-6">
                                                    <label class="form-label">Rental Start Date</label>
                                                    <input type="text" class="form-control" id="returnStartDate" readonly>
                                                </div>
                                                <div class="col-md-6">
                                                    <label class="form-label">Rental End Date</label>
                                                    <input type="text" class="form-control" id="returnEndDate" readonly>
                                                </div>
                                            </div>
                                            <div class="row mb-3">
                                                <div class="col-md-6">
                                                    <label class="form-label">Rental Amount (per day)</label>
                                                    <input type="text" class="form-control" id="returnRentalAmount" readonly>
                                                </div>
                                                <div class="col-md-6">
                                                    <label class="form-label">Rental Days</label>
                                                    <input type="text" class="form-control" id="returnRentalDays" readonly>
                                                </div>
                                            </div>
                                            <div class="row mb-3">
                                                <div class="col-md-6">
                                                    <label for="returnOdometer" class="form-label">Odometer on Return</label>
                                                    <input type="number" class="form-control" id="returnOdometer" required>
                                                </div>
                                                <div class="col-md-6">
                                                    <label for="returnDate" class="form-label">Actual Return Date</label>
                                                    <input type="date" class="form-control" id="returnDate" required>
                                                </div>
                                            </div>
                                            <div class="row mb-3">
                                                <div class="col-md-6">
                                                    <label for="lateDays" class="form-label">Late Days (if any)</label>
                                                    <input type="number" class="form-control" id="lateDays" value="0" min="0">
                                                </div>
                                                <div class="col-md-6">
                                                    <label for="lateFee" class="form-label">Late Fee (per day)</label>
                                                    <div class="input-group">
                                                        <input type="number" class="form-control" id="lateFee" value="0" min="0">
                                                        <span class="input-group-text">AED</span>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="row mb-3">
                                                <div class="col-md-6">
                                                    <label for="damageFee" class="form-label">Damage Fee (if any)</label>
                                                    <div class="input-group">
                                                        <input type="number" class="form-control" id="damageFee" value="0" min="0">
                                                        <span class="input-group-text">AED</span>
                                                    </div>
                                                </div>
                                                <div class="col-md-6">
                                                    <label for="otherFees" class="form-label">Other Fees (if any)</label>
                                                    <div class="input-group">
                                                        <input type="number" class="form-control" id="otherFees" value="0" min="0">
                                                        <span class="input-group-text">AED</span>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="row mb-3">
                                                <div class="col-md-12">
                                                    <label for="returnNotes" class="form-label">Notes</label>
                                                    <textarea class="form-control" id="returnNotes" rows="3"></textarea>
                                                </div>
                                            </div>
                                            <div class="row mb-3">
                                                <div class="col-md-12">
                                                    <h5>Total Amount: <span id="returnTotalAmount">0</span> AED</h5>
                                                </div>
                                            </div>
                                            <button type="submit" class="btn btn-success">Complete Return</button>
                                        </form>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="card mt-4">
                                <div class="card-header">
                                    Return History
                                </div>
                                <div class="card-body">
                                    <div class="table-responsive">
                                        <table class="table table-hover">
                                            <thead>
                                                <tr>
                                                    <th>Invoice Code</th>
                                                    <th>Customer</th>
                                                    <th>Vehicle</th>
                                                    <th>Return Date</th>
                                                    <th>Total Amount</th>
                                                    <th>Actions</th>
                                                </tr>
                                            </thead>
                                            <tbody id="returnHistoryTableBody">
                                                <!-- Return history will be populated here -->
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Vehicle Maintenance Tab -->
                        <div class="tab-pane fade" id="maintenance">
                            <h2 class="mb-4">Vehicle Maintenance</h2>
                            
                            <div class="card">
                                <div class="card-header">
                                    Schedule Maintenance
                                </div>
                                <div class="card-body">
                                    <form id="scheduleMaintenanceForm">
                                        <div class="row">
                                            <div class="col-md-6 mb-3">
                                                <label for="maintenanceVehicle" class="form-label">Vehicle</label>
                                                <input type="text" class="form-control" id="maintenanceVehicle" placeholder="Search vehicle...">
                                                <div class="suggestion-list" id="maintenanceVehicleSuggestions"></div>
                                            </div>
                                            <div class="col-md-6 mb-3">
                                                <label for="maintenanceType" class="form-label">Maintenance Type</label>
                                                <select class="form-select" id="maintenanceType" required>
                                                    <option value="">Select Type</option>
                                                    <option value="Oil Change">Oil Change</option>
                                                    <option value="Tire Rotation">Tire Rotation</option>
                                                    <option value="Brake Service">Brake Service</option>
                                                    <option value="Engine Tune-up">Engine Tune-up</option>
                                                    <option value="Other">Other</option>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-6 mb-3">
                                                <label for="maintenanceDate" class="form-label">Maintenance Date</label>
                                                <input type="date" class="form-control" id="maintenanceDate" required>
                                            </div>
                                            <div class="col-md-6 mb-3">
                                                <label for="maintenanceCost" class="form-label">Cost</label>
                                                <div class="input-group">
                                                    <input type="number" class="form-control" id="maintenanceCost" required>
                                                    <span class="input-group-text">AED</span>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-12 mb-3">
                                                <label for="maintenanceDescription" class="form-label">Description</label>
                                                <textarea class="form-control" id="maintenanceDescription" rows="3"></textarea>
                                            </div>
                                        </div>
                                        <button type="submit" class="btn btn-primary">Schedule Maintenance</button>
                                    </form>
                                </div>
                            </div>
                            
                            <div class="card mt-4">
                                <div class="card-header d-flex justify-content-between align-items-center">
                                    <span>Maintenance History</span>
                                    <div class="input-group" style="width: 300px;">
                                        <input type="text" class="form-control" id="maintenanceSearch" placeholder="Search by vehicle...">
                                        <button class="btn btn-outline-secondary" type="button" id="maintenanceSearchBtn">
                                            <i class="fas fa-search"></i>
                                        </button>
                                    </div>
                                </div>
                                <div class="card-body">
                                    <div class="table-responsive">
                                        <table class="table table-hover">
                                            <thead>
                                                <tr>
                                                    <th>Vehicle</th>
                                                    <th>Type</th>
                                                    <th>Date</th>
                                                    <th>Cost</th>
                                                    <th>Status</th>
                                                    <th>Actions</th>
                                                </tr>
                                            </thead>
                                            <tbody id="maintenanceTableBody">
                                                <!-- Maintenance data will be populated here -->
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Payments Tab -->
                        <div class="tab-pane fade" id="payments">
                            <h2 class="mb-4">Payment Management</h2>
                            
                            <div class="card">
                                <div class="card-header">
                                    Record Payment
                                </div>
                                <div class="card-body">
                                    <form id="recordPaymentForm">
                                        <div class="row">
                                            <div class="col-md-6 mb-3">
                                                <label for="paymentCustomer" class="form-label">Customer</label>
                                                <input type="text" class="form-control" id="paymentCustomer" placeholder="Search customer...">
                                                <div class="suggestion-list" id="paymentCustomerSuggestions"></div>
                                            </div>
                                            <div class="col-md-6 mb-3">
                                                <label for="paymentInvoice" class="form-label">Invoice Code</label>
                                                <input type="text" class="form-control" id="paymentInvoice" placeholder="Search invoice...">
                                                <div class="suggestion-list" id="paymentInvoiceSuggestions"></div>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-6 mb-3">
                                                <label for="paymentAmount" class="form-label">Amount</label>
                                                <div class="input-group">
                                                    <input type="number" class="form-control" id="paymentAmount" required>
                                                    <span class="input-group-text">AED</span>
                                                </div>
                                            </div>
                                            <div class="col-md-6 mb-3">
                                                <label for="paymentDate" class="form-label">Payment Date</label>
                                                <input type="date" class="form-control" id="paymentDate" required>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-6 mb-3">
                                                <label for="paymentMethod" class="form-label">Payment Method</label>
                                                <select class="form-select" id="paymentMethod" required>
                                                    <option value="">Select Method</option>
                                                    <option value="Cash">Cash</option>
                                                    <option value="Credit Card">Credit Card</option>
                                                    <option value="Bank Transfer">Bank Transfer</option>
                                                    <option value="Other">Other</option>
                                                </select>
                                            </div>
                                            <div class="col-md-6 mb-3">
                                                <label for="paymentStatus" class="form-label">Status</label>
                                                <select class="form-select" id="paymentStatus" required>
                                                    <option value="Completed">Completed</option>
                                                    <option value="Pending">Pending</option>
                                                    <option value="Failed">Failed</option>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-12 mb-3">
                                                <label for="paymentNotes" class="form-label">Notes</label>
                                                <textarea class="form-control" id="paymentNotes" rows="3"></textarea>
                                            </div>
                                        </div>
                                        <button type="submit" class="btn btn-primary">Record Payment</button>
                                    </form>
                                </div>
                            </div>
                            
                            <div class="card mt-4">
                                <div class="card-header d-flex justify-content-between align-items-center">
                                    <span>Payment History</span>
                                    <div class="input-group" style="width: 300px;">
                                        <input type="text" class="form-control" id="paymentSearch" placeholder="Search by customer or invoice...">
                                        <button class="btn btn-outline-secondary" type="button" id="paymentSearchBtn">
                                            <i class="fas fa-search"></i>
                                        </button>
                                    </div>
                                </div>
                                <div class="card-body">
                                    <div class="table-responsive">
                                        <table class="table table-hover">
                                            <thead>
                                                <tr>
                                                    <th>Customer</th>
                                                    <th>Invoice Code</th>
                                                    <th>Amount</th>
                                                    <th>Date</th>
                                                    <th>Method</th>
                                                    <th>Status</th>
                                                    <th>Actions</th>
                                                </tr>
                                            </thead>
                                            <tbody id="paymentTableBody">
                                                <!-- Payment data will be populated here -->
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Fines & Taxes Tab -->
                        <div class="tab-pane fade" id="fines">
                            <h2 class="mb-4">Fines & Taxes Management</h2>
                            
                            <div class="card">
                                <div class="card-header">
                                    Add Fine/Tax
                                </div>
                                <div class="card-body">
                                    <form id="addFineTaxForm">
                                        <div class="row">
                                            <div class="col-md-6 mb-3">
                                                <label for="fineCustomer" class="form-label">Customer</label>
                                                <input type="text" class="form-control" id="fineCustomer" placeholder="Search customer...">
                                                <div class="suggestion-list" id="fineCustomerSuggestions"></div>
                                            </div>
                                            <div class="col-md-6 mb-3">
                                                <label for="fineVehicle" class="form-label">Vehicle</label>
                                                <input type="text" class="form-control" id="fineVehicle" placeholder="Search vehicle...">
                                                <div class="suggestion-list" id="fineVehicleSuggestions"></div>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-6 mb-3">
                                                <label for="fineType" class="form-label">Type</label>
                                                <select class="form-select" id="fineType" required>
                                                    <option value="">Select Type</option>
                                                    <option value="Traffic Fine">Traffic Fine</option>
                                                    <option value="Late Return">Late Return</option>
                                                    <option value="Damage">Damage</option>
                                                    <option value="Tax">Tax</option>
                                                    <option value="Other">Other</option>
                                                </select>
                                            </div>
                                            <div class="col-md-6 mb-3">
                                                <label for="fineAmount" class="form-label">Amount</label>
                                                <div class="input-group">
                                                    <input type="number" class="form-control" id="fineAmount" required>
                                                    <span class="input-group-text">AED</span>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-6 mb-3">
                                                <label for="fineDate" class="form-label">Date</label>
                                                <input type="date" class="form-control" id="fineDate" required>
                                            </div>
                                            <div class="col-md-6 mb-3">
                                                <label for="fineDueDate" class="form-label">Due Date</label>
                                                <input type="date" class="form-control" id="fineDueDate" required>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-12 mb-3">
                                                <label for="fineDescription" class="form-label">Description</label>
                                                <textarea class="form-control" id="fineDescription" rows="3"></textarea>
                                            </div>
                                        </div>
                                        <button type="submit" class="btn btn-primary">Add Fine/Tax</button>
                                    </form>
                                </div>
                            </div>
                            
                            <div class="card mt-4">
                                <div class="card-header d-flex justify-content-between align-items-center">
                                    <span>Fines & Taxes History</span>
                                    <div class="input-group" style="width: 300px;">
                                        <input type="text" class="form-control" id="fineSearch" placeholder="Search by customer...">
                                        <button class="btn btn-outline-secondary" type="button" id="fineSearchBtn">
                                            <i class="fas fa-search"></i>
                                        </button>
                                    </div>
                                </div>
                                <div class="card-body">
                                    <div class="table-responsive">
                                        <table class="table table-hover">
                                            <thead>
                                                <tr>
                                                    <th>Customer</th>
                                                    <th>Vehicle</th>
                                                    <th>Type</th>
                                                    <th>Amount</th>
                                                    <th>Date</th>
                                                    <th>Due Date</th>
                                                    <th>Status</th>
                                                    <th>Actions</th>
                                                </tr>
                                            </thead>
                                            <tbody id="fineTableBody">
                                                <!-- Fines data will be populated here -->
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Reports Tab -->
                        <div class="tab-pane fade" id="reports">
                            <h2 class="mb-4">Reports</h2>
                            
                            <div class="card">
                                <div class="card-header">
                                    Generate Report
                                </div>
                                <div class="card-body">
                                    <div class="row mb-3">
                                        <div class="col-md-4">
                                            <label for="reportType" class="form-label">Report Type</label>
                                            <select class="form-select" id="reportType">
                                                <option value="rental">Rental Report</option>
                                                <option value="revenue">Revenue Report</option>
                                                <option value="vehicle">Vehicle Report</option>
                                                <option value="customer">Customer Report</option>
                                                <option value="maintenance">Maintenance Report</option>
                                            </select>
                                        </div>
                                        <div class="col-md-4">
                                            <label for="reportStartDate" class="form-label">Start Date</label>
                                            <input type="date" class="form-control" id="reportStartDate">
                                        </div>
                                        <div class="col-md-4">
                                            <label for="reportEndDate" class="form-label">End Date</label>
                                            <input type="date" class="form-control" id="reportEndDate">
                                        </div>
                                    </div>
                                    <button class="btn btn-primary" id="generateReportBtn">Generate Report</button>
                                    <button class="btn btn-success" id="exportReportBtn">Export to Excel</button>
                                </div>
                            </div>
                            
                            <div class="card mt-4">
                                <div class="card-header">
                                    Report Results
                                </div>
                                <div class="card-body">
                                    <div id="reportResults">
                                        <!-- Report results will be displayed here -->
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- F.RETU.RENT Tab -->
                        <div class="tab-pane fade" id="frr">
                            <h2 class="mb-4">F.RETU.RENT (Final Return Rental)</h2>
                            
                            <div class="card">
                                <div class="card-header">
                                    Final Return Rental Form
                                </div>
                                <div class="card-body">
                                    <form id="frrForm">
                                        <div class="row mb-3">
                                            <div class="col-md-6">
                                                <label for="frrInvoiceSearch" class="form-label">Search by Invoice Code</label>
                                                <input type="text" class="form-control" id="frrInvoiceSearch" placeholder="Search invoice code...">
                                                <div class="suggestion-list" id="frrInvoiceSuggestions"></div>
                                            </div>
                                            <div class="col-md-6 d-flex align-items-end">
                                                <button class="btn btn-primary me-2" id="frrSearchInvoiceBtn">Search</button>
                                            </div>
                                        </div>
                                        <div id="frrFormContainer" style="display: none;">
                                            <div class="row mb-3">
                                                <div class="col-md-6">
                                                    <label class="form-label">Customer</label>
                                                    <input type="text" class="form-control" id="frrCustomer" readonly>
                                                </div>
                                                <div class="col-md-6">
                                                    <label class="form-label">Vehicle</label>
                                                    <input type="text" class="form-control" id="frrVehicle" readonly>
                                                </div>
                                            </div>
                                            <div class="row mb-3">
                                                <div class="col-md-6">
                                                    <label class="form-label">Rental Start Date</label>
                                                    <input type="text" class="form-control" id="frrStartDate" readonly>
                                                </div>
                                                <div class="col-md-6">
                                                    <label class="form-label">Rental End Date</label>
                                                    <input type="text" class="form-control" id="frrEndDate" readonly>
                                                </div>
                                            </div>
                                            <div class="row mb-3">
                                                <div class="col-md-6">
                                                    <label for="frrOdometer" class="form-label">Odometer on Return</label>
                                                    <input type="number" class="form-control" id="frrOdometer" required>
                                                </div>
                                                <div class="col-md-6">
                                                    <label for="frrReturnDate" class="form-label">Actual Return Date</label>
                                                    <input type="date" class="form-control" id="frrReturnDate" required>
                                                </div>
                                            </div>
                                            <div class="row mb-3">
                                                <div class="col-md-12">
                                                    <label for="frrNotes" class="form-label">Final Notes</label>
                                                    <textarea class="form-control" id="frrNotes" rows="3"></textarea>
                                                </div>
                                            </div>
                                            <button type="submit" class="btn btn-success">Complete Final Return</button>
                                        </div>
                                    </form>
                                </div>
                            </div>
                            
                            <div class="card mt-4">
                                <div class="card-header">
                                    Final Return History
                                </div>
                                <div class="card-body">
                                    <div class="table-responsive">
                                        <table class="table table-hover">
                                            <thead>
                                                <tr>
                                                    <th>Invoice Code</th>
                                                    <th>Customer</th>
                                                    <th>Vehicle</th>
                                                    <th>Return Date</th>
                                                    <th>Actions</th>
                                                </tr>
                                            </thead>
                                            <tbody id="frrHistoryTableBody">
                                                <!-- Final return history will be populated here -->
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- System Settings Tab -->
                        <div class="tab-pane fade" id="settings">
                            <h2 class="mb-4">System Settings</h2>
                            
                            <div class="card">
                                <div class="card-header">
                                    General Settings
                                </div>
                                <div class="card-body">
                                    <form id="systemSettingsForm">
                                        <div class="row mb-3">
                                            <div class="col-md-6">
                                                <label for="systemName" class="form-label">System Name</label>
                                                <input type="text" class="form-control" id="systemName" value="Car Rental System">
                                            </div>
                                            <div class="col-md-6">
                                                <label for="systemCurrency" class="form-label">Currency</label>
                                                <select class="form-select" id="systemCurrency">
                                                    <option value="AED">AED (UAE Dirham)</option>
                                                    <option value="USD">USD (US Dollar)</option>
                                                    <option value="EUR">EUR (Euro)</option>
                                                    <option value="SAR">SAR (Saudi Riyal)</option>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="row mb-3">
                                            <div class="col-md-6">
                                                <label for="systemLogo" class="form-label">System Logo</label>
                                                <input type="file" class="form-control" id="systemLogo" accept="image/*">
                                            </div>
                                            <div class="col-md-6">
                                                <label for="systemDateFormat" class="form-label">Date Format</label>
                                                <select class="form-select" id="systemDateFormat">
                                                    <option value="dd/mm/yyyy">DD/MM/YYYY</option>
                                                    <option value="mm/dd/yyyy">MM/DD/YYYY</option>
                                                    <option value="yyyy-mm-dd">YYYY-MM-DD</option>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="row mb-3">
                                            <div class="col-md-6">
                                                <label for="lateReturnFee" class="form-label">Late Return Fee (per day)</label>
                                                <div class="input-group">
                                                    <input type="number" class="form-control" id="lateReturnFee" value="50">
                                                    <span class="input-group-text">AED</span>
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <label for="taxRate" class="form-label">Tax Rate (%)</label>
                                                <div class="input-group">
                                                    <input type="number" class="form-control" id="taxRate" value="5" step="0.1">
                                                    <span class="input-group-text">%</span>
                                                </div>
                                            </div>
                                        </div>
                                        <button type="submit" class="btn btn-primary">Save Settings</button>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modals -->
    <!-- Change Password Modal -->
    <div class="modal fade" id="changePasswordModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Change Password</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="changePasswordForm">
                        <div class="mb-3">
                            <label for="currentPassword" class="form-label">Current Password</label>
                            <input type="password" class="form-control" id="currentPassword" required>
                        </div>
                        <div class="mb-3">
                            <label for="newPassword" class="form-label">New Password</label>
                            <input type="password" class="form-control" id="newPassword" required>
                        </div>
                        <div class="mb-3">
                            <label for="confirmPassword" class="form-label">Confirm New Password</label>
                            <input type="password" class="form-control" id="confirmPassword" required>
                        </div>
                        <button type="submit" class="btn btn-primary">Change Password</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- User Management Modal -->
    <div class="modal fade" id="userManagementModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">User Management</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <button class="btn btn-primary" id="addUserBtn">Add New User</button>
                    </div>
                    <div class="table-responsive">
                        <table class="table table-hover">
                            <thead>
                                <tr>
                                    <th>Username</th>
                                    <th>Role</th>
                                    <th>Permissions</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="userTableBody">
                                <!-- User data will be populated here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Add User Modal -->
    <div class="modal fade" id="addUserModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Add New User</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="addUserForm">
                        <div class="mb-3">
                            <label for="newUsername" class="form-label">Username</label>
                            <input type="text" class="form-control" id="newUsername" required>
                        </div>
                        <div class="mb-3">
                            <label for="newUserPassword" class="form-label">Password</label>
                            <input type="password" class="form-control" id="newUserPassword" required>
                        </div>
                        <div class="mb-3">
                            <label for="newUserRole" class="form-label">Role</label>
                            <select class="form-select" id="newUserRole" required>
                                <option value="admin">Admin</option>
                                <option value="user">User</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Permissions</label>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="permissionView" checked>
                                <label class="form-check-label" for="permissionView">View Data</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="permissionEdit" checked>
                                <label class="form-check-label" for="permissionEdit">Edit Data</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="permissionDelete">
                                <label class="form-check-label" for="permissionDelete">Delete Data</label>
                            </div>
                        </div>
                        <button type="submit" class="btn btn-primary">Add User</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Backup & Restore Modal -->
    <div class="modal fade" id="backupModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Backup & Restore</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <h6>Create Backup</h6>
                        <p>Create a backup of all system data.</p>
                        <button class="btn btn-primary" id="createBackupBtn">Create Backup</button>
                    </div>
                    <div class="mb-3">
                        <h6>Restore Backup</h6>
                        <p>Restore system data from a backup file.</p>
                        <input type="file" class="form-control mb-2" id="restoreFile" accept=".json">
                        <button class="btn btn-warning" id="restoreBackupBtn">Restore Backup</button>
                    </div>
                    <div class="mb-3">
                        <h6>Backup History</h6>
                        <div class="table-responsive">
                            <table class="table table-sm">
                                <thead>
                                    <tr>
                                        <th>Date</th>
                                        <th>Size</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="backupHistoryTable">
                                    <!-- Backup history will be populated here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        // Initialize data storage
        const initializeData = () => {
            if (!localStorage.getItem('carRentalData')) {
                const initialData = {
                    vehicles: [],
                    customers: [],
                    rentals: [],
                    returns: [],
                    maintenance: [],
                    payments: [],
                    fines: [],
                    users: [
                        { username: 'admin', password: '000000', role: 'admin', permissions: ['view', 'edit', 'delete'] }
                    ],
                    settings: {
                        systemName: 'Car Rental System',
                        currency: 'AED',
                        dateFormat: 'dd/mm/yyyy',
                        lateReturnFee: 50,
                        taxRate: 5
                    },
                    backups: []
                };
                localStorage.setItem('carRentalData', JSON.stringify(initialData));
            }
            return JSON.parse(localStorage.getItem('carRentalData'));
        };

        // Save data to localStorage
        const saveData = (data) => {
            localStorage.setItem('carRentalData', JSON.stringify(data));
        };

        // Get current data
        const getData = () => {
            return JSON.parse(localStorage.getItem('carRentalData'));
        };

        // Common color suggestions
        const colorSuggestions = [
            'Red', 'Blue', 'Green', 'Black', 'White', 'Silver', 'Gray', 'Yellow', 
            'Orange', 'Purple', 'Brown', 'Pink', 'Gold', 'Beige', 'Maroon', 'Navy'
        ];

        // Common country suggestions
        const countrySuggestions = [
            'Afghanistan', 'Albania', 'Algeria', 'Argentina', 'Australia', 'Austria', 'Bahrain', 'Bangladesh', 
            'Belgium', 'Brazil', 'Canada', 'China', 'Denmark', 'Egypt', 'Finland', 'France', 'Germany', 'Greece', 
            'India', 'Indonesia', 'Iran', 'Iraq', 'Italy', 'Japan', 'Jordan', 'Kuwait', 'Lebanon', 'Malaysia', 
            'Mexico', 'Netherlands', 'New Zealand', 'Norway', 'Oman', 'Pakistan', 'Philippines', 'Poland', 
            'Portugal', 'Qatar', 'Russia', 'Saudi Arabia', 'Singapore', 'South Africa', 'South Korea', 'Spain', 
            'Sweden', 'Switzerland', 'Syria', 'Thailand', 'Turkey', 'Ukraine', 'United Arab Emirates', 
            'United Kingdom', 'United States', 'Vietnam', 'Yemen'
        ];

        // Model years from 2019 to 2030
        const modelYears = [];
        for (let year = 2019; year <= 2030; year++) {
            modelYears.push(year);
        }

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize data
            const data = initializeData();
            
            // Check if user is logged in
            const currentUser = localStorage.getItem('currentUser');
            if (currentUser) {
                document.getElementById('loginScreen').style.display = 'none';
                document.getElementById('mainApp').style.display = 'block';
                document.getElementById('currentUser').textContent = currentUser;
                
                // Set user permissions
                const user = data.users.find(u => u.username === currentUser);
                if (user && user.role === 'user') {
                    document.querySelectorAll('.admin-only').forEach(el => {
                        el.style.display = 'none';
                    });
                }
            } else {
                document.getElementById('loginScreen').style.display = 'block';
                document.getElementById('mainApp').style.display = 'none';
            }
            
            // Populate model years
            const modelSelect = document.getElementById('vehicleModel');
            modelYears.forEach(year => {
                const option = document.createElement('option');
                option.value = year;
                option.textContent = year;
                modelSelect.appendChild(option);
            });
            
            // Load dashboard data
            loadDashboardData();
            
            // Load vehicle list
            loadVehicleList();
            
            // Load customer list
            loadCustomerList();
            
            // Load rental list
            loadRentalList();
            
            // Load return history
            loadReturnHistory();
            
            // Load maintenance history
            loadMaintenanceHistory();
            
            // Load payment history
            loadPaymentHistory();
            
            // Load fines history
            loadFinesHistory();
            
            // Load user list
            loadUserList();
            
            // Load backup history
            loadBackupHistory();
            
            // Apply system settings
            applySystemSettings();
            
            // Event listeners
            setupEventListeners();
        });

        // Setup event listeners
        function setupEventListeners() {
            // Login form
            document.getElementById('loginForm').addEventListener('submit', handleLogin);
            
            // Logout button
            document.getElementById('logoutBtn').addEventListener('click', handleLogout);
            
            // Add vehicle form
            document.getElementById('addVehicleForm').addEventListener('submit', addVehicle);
            
            // Vehicle search
            document.getElementById('vehicleSearch').addEventListener('input', searchVehicles);
            document.getElementById('vehicleSearchBtn').addEventListener('click', searchVehicles);
            
            // Add customer form
            document.getElementById('addCustomerForm').addEventListener('submit', addCustomer);
            
            // Customer search
            document.getElementById('customerSearch').addEventListener('input', searchCustomers);
            document.getElementById('customerSearchBtn').addEventListener('click', searchCustomers);
            
            // Create rental form
            document.getElementById('createRentalForm').addEventListener('submit', createRental);
            
            // Rental search
            document.getElementById('rentalSearch').addEventListener('input', searchRentals);
            document.getElementById('rentalSearchBtn').addEventListener('click', searchRentals);
            
            // Return vehicle form
            document.getElementById('returnVehicleForm').addEventListener('submit', returnVehicle);
            document.getElementById('searchInvoiceBtn').addEventListener('click', searchInvoiceForReturn);
            
            // Schedule maintenance form
            document.getElementById('scheduleMaintenanceForm').addEventListener('submit', scheduleMaintenance);
            
            // Maintenance search
            document.getElementById('maintenanceSearch').addEventListener('input', searchMaintenance);
            document.getElementById('maintenanceSearchBtn').addEventListener('click', searchMaintenance);
            
            // Record payment form
            document.getElementById('recordPaymentForm').addEventListener('submit', recordPayment);
            
            // Payment search
            document.getElementById('paymentSearch').addEventListener('input', searchPayments);
            document.getElementById('paymentSearchBtn').addEventListener('click', searchPayments);
            
            // Add fine/tax form
            document.getElementById('addFineTaxForm').addEventListener('submit', addFineTax);
            
            // Fine search
            document.getElementById('fineSearch').addEventListener('input', searchFines);
            document.getElementById('fineSearchBtn').addEventListener('click', searchFines);
            
            // Generate report
            document.getElementById('generateReportBtn').addEventListener('click', generateReport);
            
            // Export report
            document.getElementById('exportReportBtn').addEventListener('click', exportReport);
            
            // FRR form
            document.getElementById('frrForm').addEventListener('submit', submitFRR);
            document.getElementById('frrSearchInvoiceBtn').addEventListener('click', searchInvoiceForFRR);
            
            // System settings form
            document.getElementById('systemSettingsForm').addEventListener('submit', saveSystemSettings);
            
            // Change password form
            document.getElementById('changePasswordForm').addEventListener('submit', changePassword);
            
            // Add user form
            document.getElementById('addUserForm').addEventListener('submit', addUser);
            
            // Add user button
            document.getElementById('addUserBtn').addEventListener('click', function() {
                new bootstrap.Modal(document.getElementById('addUserModal')).show();
            });
            
            // Create backup button
            document.getElementById('createBackupBtn').addEventListener('click', createBackup);
            
            // Restore backup button
            document.getElementById('restoreBackupBtn').addEventListener('click', restoreBackup);
            
            // Color suggestions
            document.getElementById('vehicleColor').addEventListener('input', function() {
                showSuggestions(this, colorSuggestions, 'colorSuggestions');
            });
            
            // Nationality suggestions
            document.getElementById('customerNationality').addEventListener('input', function() {
                showSuggestions(this, countrySuggestions, 'nationalitySuggestions');
            });
            
            // Customer suggestions for rental
            document.getElementById('rentalCustomer').addEventListener('input', function() {
                const data = getData();
                const customerNames = data.customers.map(c => c.fullName);
                showSuggestions(this, customerNames, 'customerSuggestions');
            });
            
            // Vehicle suggestions for rental
            document.getElementById('rentalVehicle').addEventListener('input', function() {
                const data = getData();
                const vehicleNames = data.vehicles.map(v => v.name);
                showSuggestions(this, vehicleNames, 'vehicleSuggestions');
            });
            
            // Close vehicle details
            document.getElementById('closeVehicleDetails').addEventListener('click', function() {
                document.getElementById('vehicleDetailsCard').style.display = 'none';
            });
            
            // Close customer details
            document.getElementById('closeCustomerDetails').addEventListener('click', function() {
                document.getElementById('customerDetailsCard').style.display = 'none';
            });
            
            // Calculate return total amount
            document.getElementById('lateDays').addEventListener('input', calculateReturnTotal);
            document.getElementById('lateFee').addEventListener('input', calculateReturnTotal);
            document.getElementById('damageFee').addEventListener('input', calculateReturnTotal);
            document.getElementById('otherFees').addEventListener('input', calculateReturnTotal);
        }

        // Show suggestions for input fields
        function showSuggestions(inputElement, suggestions, containerId) {
            const input = inputElement.value.toLowerCase();
            const container = document.getElementById(containerId);
            
            if (input.length === 0) {
                container.style.display = 'none';
                return;
            }
            
            const filtered = suggestions.filter(s => s.toLowerCase().includes(input));
            
            container.innerHTML = '';
            filtered.forEach(item => {
                const div = document.createElement('div');
                div.className = 'suggestion-item';
                div.textContent = item;
                div.addEventListener('click', function() {
                    inputElement.value = item;
                    container.style.display = 'none';
                });
                container.appendChild(div);
            });
            
            container.style.display = 'block';
        }

        // Handle login
        function handleLogin(e) {
            e.preventDefault();
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            
            const data = getData();
            const user = data.users.find(u => u.username === username && u.password === password);
            
            if (user) {
                localStorage.setItem('currentUser', username);
                document.getElementById('loginScreen').style.display = 'none';
                document.getElementById('mainApp').style.display = 'block';
                document.getElementById('currentUser').textContent = username;
                
                // Set user permissions
                if (user.role === 'user') {
                    document.querySelectorAll('.admin-only').forEach(el => {
                        el.style.display = 'none';
                    });
                }
                
                // Reload data
                loadDashboardData();
                loadVehicleList();
                loadCustomerList();
                loadRentalList();
            } else {
                alert('Invalid username or password');
            }
        }

        // Handle logout
        function handleLogout() {
            localStorage.removeItem('currentUser');
            document.getElementById('loginScreen').style.display = 'block';
            document.getElementById('mainApp').style.display = 'none';
        }

        // Add vehicle
        function addVehicle(e) {
            e.preventDefault();
            
            const data = getData();
            const vehicle = {
                id: Date.now().toString(),
                name: document.getElementById('vehicleName').value,
                odometer: parseInt(document.getElementById('vehicleOdometer').value),
                vin: document.getElementById('vehicleVin').value,
                plate: document.getElementById('vehiclePlate').value,
                color: document.getElementById('vehicleColor').value,
                model: document.getElementById('vehicleModel').value,
                rentalPrice: parseFloat(document.getElementById('vehicleRentalPrice').value),
                status: 'Available',
                image: null // In a real app, you would handle file upload
            };
            
            // Handle image upload (simplified for demo)
            const imageInput = document.getElementById('vehicleImage');
            if (imageInput.files.length > 0) {
                // In a real app, you would upload the file and store the URL
                // For this demo, we'll just store a placeholder
                vehicle.image = 'placeholder.jpg';
            }
            
            data.vehicles.push(vehicle);
            saveData(data);
            
            // Reset form
            document.getElementById('addVehicleForm').reset();
            
            // Reload vehicle list
            loadVehicleList();
            
            // Show success message
            alert('Vehicle added successfully!');
        }

        // Load vehicle list
        function loadVehicleList() {
            const data = getData();
            const tbody = document.getElementById('vehicleTableBody');
            tbody.innerHTML = '';
            
            data.vehicles.forEach(vehicle => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>
                        ${vehicle.image ? 
                            `<img src="${vehicle.image}" class="vehicle-image" alt="${vehicle.name}">` : 
                            '<i class="fas fa-car fa-2x text-muted"></i>'
                        }
                    </td>
                    <td>${vehicle.name}</td>
                    <td>${vehicle.model}</td>
                    <td>${vehicle.color}</td>
                    <td>${vehicle.plate}</td>
                    <td>${vehicle.odometer.toLocaleString()}</td>
                    <td>${vehicle.rentalPrice} AED</td>
                    <td>
                        <span class="badge ${vehicle.status === 'Available' ? 'bg-success' : 'bg-danger'}">
                            ${vehicle.status}
                        </span>
                    </td>
                    <td>
                        <button class="btn btn-sm btn-info view-vehicle" data-id="${vehicle.id}">
                            <i class="fas fa-eye"></i>
                        </button>
                        <button class="btn btn-sm btn-warning edit-vehicle" data-id="${vehicle.id}">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn btn-sm btn-danger delete-vehicle" data-id="${vehicle.id}">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
                tbody.appendChild(tr);
            });
            
            // Add event listeners for vehicle actions
            document.querySelectorAll('.view-vehicle').forEach(btn => {
                btn.addEventListener('click', function() {
                    const vehicleId = this.getAttribute('data-id');
                    viewVehicleDetails(vehicleId);
                });
            });
            
            document.querySelectorAll('.edit-vehicle').forEach(btn => {
                btn.addEventListener('click', function() {
                    const vehicleId = this.getAttribute('data-id');
                    editVehicle(vehicleId);
                });
            });
            
            document.querySelectorAll('.delete-vehicle').forEach(btn => {
                btn.addEventListener('click', function() {
                    const vehicleId = this.getAttribute('data-id');
                    deleteVehicle(vehicleId);
                });
            });
        }

        // View vehicle details
        function viewVehicleDetails(vehicleId) {
            const data = getData();
            const vehicle = data.vehicles.find(v => v.id === vehicleId);
            
            if (vehicle) {
                const content = document.getElementById('vehicleDetailsContent');
                content.innerHTML = `
                    <div class="row">
                        <div class="col-md-4">
                            ${vehicle.image ? 
                                `<img src="${vehicle.image}" class="img-fluid" alt="${vehicle.name}">` : 
                                '<i class="fas fa-car fa-5x text-muted"></i>'
                            }
                        </div>
                        <div class="col-md-8">
                            <h4>${vehicle.name}</h4>
                            <table class="table table-bordered">
                                <tr>
                                    <th>Model Year:</th>
                                    <td>${vehicle.model}</td>
                                </tr>
                                <tr>
                                    <th>Color:</th>
                                    <td>${vehicle.color}</td>
                                </tr>
                                <tr>
                                    <th>Plate Number:</th>
                                    <td>${vehicle.plate}</td>
                                </tr>
                                <tr>
                                    <th>VIN #:</th>
                                    <td>${vehicle.vin}</td>
                                </tr>
                                <tr>
                                    <th>Odometer:</th>
                                    <td>${vehicle.odometer.toLocaleString()} km</td>
                                </tr>
                                <tr>
                                    <th>Rental Price:</th>
                                    <td>${vehicle.rentalPrice} AED per day</td>
                                </tr>
                                <tr>
                                    <th>Status:</th>
                                    <td>
                                        <span class="badge ${vehicle.status === 'Available' ? 'bg-success' : 'bg-danger'}">
                                            ${vehicle.status}
                                        </span>
                                    </td>
                                </tr>
                            </table>
                        </div>
                    </div>
                `;
                
                document.getElementById('vehicleDetailsCard').style.display = 'block';
            }
        }

        // Edit vehicle
        function editVehicle(vehicleId) {
            // In a real app, you would populate a form with vehicle data for editing
            alert('Edit vehicle functionality would be implemented here');
        }

        // Delete vehicle
        function deleteVehicle(vehicleId) {
            if (confirm('Are you sure you want to delete this vehicle?')) {
                const data = getData();
                data.vehicles = data.vehicles.filter(v => v.id !== vehicleId);
                saveData(data);
                loadVehicleList();
                alert('Vehicle deleted successfully!');
            }
        }

        // Search vehicles
        function searchVehicles() {
            const query = document.getElementById('vehicleSearch').value.toLowerCase();
            const data = getData();
            const filtered = data.vehicles.filter(v => 
                v.name.toLowerCase().includes(query) || 
                v.plate.toLowerCase().includes(query) ||
                v.color.toLowerCase().includes(query)
            );
            
            const tbody = document.getElementById('vehicleTableBody');
            tbody.innerHTML = '';
            
            filtered.forEach(vehicle => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>
                        ${vehicle.image ? 
                            `<img src="${vehicle.image}" class="vehicle-image" alt="${vehicle.name}">` : 
                            '<i class="fas fa-car fa-2x text-muted"></i>'
                        }
                    </td>
                    <td>${vehicle.name}</td>
                    <td>${vehicle.model}</td>
                    <td>${vehicle.color}</td>
                    <td>${vehicle.plate}</td>
                    <td>${vehicle.odometer.toLocaleString()}</td>
                    <td>${vehicle.rentalPrice} AED</td>
                    <td>
                        <span class="badge ${vehicle.status === 'Available' ? 'bg-success' : 'bg-danger'}">
                            ${vehicle.status}
                        </span>
                    </td>
                    <td>
                        <button class="btn btn-sm btn-info view-vehicle" data-id="${vehicle.id}">
                            <i class="fas fa-eye"></i>
                        </button>
                        <button class="btn btn-sm btn-warning edit-vehicle" data-id="${vehicle.id}">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn btn-sm btn-danger delete-vehicle" data-id="${vehicle.id}">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
                tbody.appendChild(tr);
            });
            
            // Re-add event listeners
            document.querySelectorAll('.view-vehicle').forEach(btn => {
                btn.addEventListener('click', function() {
                    const vehicleId = this.getAttribute('data-id');
                    viewVehicleDetails(vehicleId);
                });
            });
            
            document.querySelectorAll('.edit-vehicle').forEach(btn => {
                btn.addEventListener('click', function() {
                    const vehicleId = this.getAttribute('data-id');
                    editVehicle(vehicleId);
                });
            });
            
            document.querySelectorAll('.delete-vehicle').forEach(btn => {
                btn.addEventListener('click', function() {
                    const vehicleId = this.getAttribute('data-id');
                    deleteVehicle(vehicleId);
                });
            });
        }

        // Add customer
        function addCustomer(e) {
            e.preventDefault();
            
            const data = getData();
            const customer = {
                id: Date.now().toString(),
                fullName: document.getElementById('customerFullName').value,
                age: parseInt(document.getElementById('customerAge').value),
                idNumber: document.getElementById('customerId').value,
                nationality: document.getElementById('customerNationality').value,
                contact: document.getElementById('customerContact').value,
                address: document.getElementById('customerAddress').value,
                guaranteeDoc: null // In a real app, you would handle file upload
            };
            
            // Handle document upload (simplified for demo)
            const docInput = document.getElementById('guaranteeDoc');
            if (docInput.files.length > 0) {
                // In a real app, you would upload the file and store the URL
                // For this demo, we'll just store a placeholder
                customer.guaranteeDoc = 'placeholder.pdf';
            }
            
            data.customers.push(customer);
            saveData(data);
            
            // Reset form
            document.getElementById('addCustomerForm').reset();
            
            // Reload customer list
            loadCustomerList();
            
            // Show success message
            alert('Customer added successfully!');
        }

        // Load customer list
        function loadCustomerList() {
            const data = getData();
            const tbody = document.getElementById('customerTableBody');
            tbody.innerHTML = '';
            
            data.customers.forEach(customer => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${customer.fullName}</td>
                    <td>${customer.age}</td>
                    <td>${customer.idNumber}</td>
                    <td>${customer.nationality}</td>
                    <td>${customer.contact}</td>
                    <td>0 AED</td> <!-- Total debt would be calculated in a real app -->
                    <td>
                        <button class="btn btn-sm btn-info view-customer" data-id="${customer.id}">
                            <i class="fas fa-eye"></i>
                        </button>
                        <button class="btn btn-sm btn-warning edit-customer" data-id="${customer.id}">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn btn-sm btn-danger delete-customer" data-id="${customer.id}">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
                tbody.appendChild(tr);
            });
            
            // Add event listeners for customer actions
            document.querySelectorAll('.view-customer').forEach(btn => {
                btn.addEventListener('click', function() {
                    const customerId = this.getAttribute('data-id');
                    viewCustomerDetails(customerId);
                });
            });
            
            document.querySelectorAll('.edit-customer').forEach(btn => {
                btn.addEventListener('click', function() {
                    const customerId = this.getAttribute('data-id');
                    editCustomer(customerId);
                });
            });
            
            document.querySelectorAll('.delete-customer').forEach(btn => {
                btn.addEventListener('click', function() {
                    const customerId = this.getAttribute('data-id');
                    deleteCustomer(customerId);
                });
            });
        }

        // View customer details
        function viewCustomerDetails(customerId) {
            const data = getData();
            const customer = data.customers.find(c => c.id === customerId);
            
            if (customer) {
                const content = document.getElementById('customerDetailsContent');
                content.innerHTML = `
                    <div class="row">
                        <div class="col-md-6">
                            <h4>${customer.fullName}</h4>
                            <table class="table table-bordered">
                                <tr>
                                    <th>Age:</th>
                                    <td>${customer.age}</td>
                                </tr>
                                <tr>
                                    <th>ID Number:</th>
                                    <td>${customer.idNumber}</td>
                                </tr>
                                <tr>
                                    <th>Nationality:</th>
                                    <td>${customer.nationality}</td>
                                </tr>
                                <tr>
                                    <th>Contact:</th>
                                    <td>${customer.contact}</td>
                                </tr>
                                <tr>
                                    <th>Address:</th>
                                    <td>${customer.address}</td>
                                </tr>
                            </table>
                        </div>
                        <div class="col-md-6">
                            <h5>Rental History</h5>
                            <div class="table-responsive">
                                <table class="table table-sm">
                                    <thead>
                                        <tr>
                                            <th>Vehicle</th>
                                            <th>Start Date</th>
                                            <th>End Date</th>
                                            <th>Amount</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <!-- Customer rental history would be populated here -->
                                        <tr>
                                            <td colspan="4" class="text-center">No rental history</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                `;
                
                document.getElementById('customerDetailsCard').style.display = 'block';
            }
        }

        // Edit customer
        function editCustomer(customerId) {
            // In a real app, you would populate a form with customer data for editing
            alert('Edit customer functionality would be implemented here');
        }

        // Delete customer
        function deleteCustomer(customerId) {
            if (confirm('Are you sure you want to delete this customer?')) {
                const data = getData();
                data.customers = data.customers.filter(c => c.id !== customerId);
                saveData(data);
                loadCustomerList();
                alert('Customer deleted successfully!');
            }
        }

        // Search customers
        function searchCustomers() {
            const query = document.getElementById('customerSearch').value.toLowerCase();
            const data = getData();
            const filtered = data.customers.filter(c => 
                c.fullName.toLowerCase().includes(query) || 
                c.idNumber.toLowerCase().includes(query) ||
                c.nationality.toLowerCase().includes(query)
            );
            
            const tbody = document.getElementById('customerTableBody');
            tbody.innerHTML = '';
            
            filtered.forEach(customer => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${customer.fullName}</td>
                    <td>${customer.age}</td>
                    <td>${customer.idNumber}</td>
                    <td>${customer.nationality}</td>
                    <td>${customer.contact}</td>
                    <td>0 AED</td>
                    <td>
                        <button class="btn btn-sm btn-info view-customer" data-id="${customer.id}">
                            <i class="fas fa-eye"></i>
                        </button>
                        <button class="btn btn-sm btn-warning edit-customer" data-id="${customer.id}">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn btn-sm btn-danger delete-customer" data-id="${customer.id}">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
                tbody.appendChild(tr);
            });
            
            // Re-add event listeners
            document.querySelectorAll('.view-customer').forEach(btn => {
                btn.addEventListener('click', function() {
                    const customerId = this.getAttribute('data-id');
                    viewCustomerDetails(customerId);
                });
            });
            
            document.querySelectorAll('.edit-customer').forEach(btn => {
                btn.addEventListener('click', function() {
                    const customerId = this.getAttribute('data-id');
                    editCustomer(customerId);
                });
            });
            
            document.querySelectorAll('.delete-customer').forEach(btn => {
                btn.addEventListener('click', function() {
                    const customerId = this.getAttribute('data-id');
                    deleteCustomer(customerId);
                });
            });
        }

        // Create rental
        function createRental(e) {
            e.preventDefault();
            
            const data = getData();
            const customerName = document.getElementById('rentalCustomer').value;
            const vehicleName = document.getElementById('rentalVehicle').value;
            
            const customer = data.customers.find(c => c.fullName === customerName);
            const vehicle = data.vehicles.find(v => v.name === vehicleName);
            
            if (!customer) {
                alert('Customer not found!');
                return;
            }
            
            if (!vehicle) {
                alert('Vehicle not found!');
                return;
            }
            
            if (vehicle.status !== 'Available') {
                alert('Vehicle is not available for rental!');
                return;
            }
            
            const rental = {
                id: Date.now().toString(),
                invoiceCode: document.getElementById('invoiceCode').value || `INV-${Date.now()}`,
                customerId: customer.id,
                customerName: customer.fullName,
                vehicleId: vehicle.id,
                vehicleName: vehicle.name,
                rentalAmount: parseFloat(document.getElementById('rentalAmount').value),
                rentalDays: parseInt(document.getElementById('rentalDays').value),
                startDate: document.getElementById('rentalStartDate').value,
                endDate: document.getElementById('rentalEndDate').value,
                totalAmount: parseFloat(document.getElementById('rentalAmount').value) * parseInt(document.getElementById('rentalDays').value),
                status: 'Active',
                createdDate: new Date().toISOString().split('T')[0]
            };
            
            data.rentals.push(rental);
            
            // Update vehicle status
            vehicle.status = 'Rented';
            
            saveData(data);
            
            // Reset form
            document.getElementById('createRentalForm').reset();
            
            // Reload rental list
            loadRentalList();
            
            // Show success message
            alert('Rental created successfully!');
            
            // Print invoice
            printInvoice(rental);
        }

        // Load rental list
        function loadRentalList() {
            const data = getData();
            const tbody = document.getElementById('rentalTableBody');
            tbody.innerHTML = '';
            
            data.rentals.forEach(rental => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${rental.invoiceCode}</td>
                    <td>${rental.customerName}</td>
                    <td>${rental.vehicleName}</td>
                    <td>${formatDate(rental.startDate)}</td>
                    <td>${formatDate(rental.endDate)}</td>
                    <td>${rental.totalAmount} AED</td>
                    <td>
                        <span class="badge ${rental.status === 'Active' ? 'bg-success' : 'bg-secondary'}">
                            ${rental.status}
                        </span>
                    </td>
                    <td>
                        <button class="btn btn-sm btn-info view-rental" data-id="${rental.id}">
                            <i class="fas fa-eye"></i>
                        </button>
                        <button class="btn btn-sm btn-warning edit-rental" data-id="${rental.id}">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn btn-sm btn-danger delete-rental" data-id="${rental.id}">
                            <i class="fas fa-trash"></i>
                        </button>
                        <button class="btn btn-sm btn-success print-invoice" data-id="${rental.id}">
                            <i class="fas fa-print"></i>
                        </button>
                    </td>
                `;
                tbody.appendChild(tr);
            });
            
            // Add event listeners for rental actions
            document.querySelectorAll('.view-rental').forEach(btn => {
                btn.addEventListener('click', function() {
                    const rentalId = this.getAttribute('data-id');
                    viewRentalDetails(rentalId);
                });
            });
            
            document.querySelectorAll('.edit-rental').forEach(btn => {
                btn.addEventListener('click', function() {
                    const rentalId = this.getAttribute('data-id');
                    editRental(rentalId);
                });
            });
            
            document.querySelectorAll('.delete-rental').forEach(btn => {
                btn.addEventListener('click', function() {
                    const rentalId = this.getAttribute('data-id');
                    deleteRental(rentalId);
                });
            });
            
            document.querySelectorAll('.print-invoice').forEach(btn => {
                btn.addEventListener('click', function() {
                    const rentalId = this.getAttribute('data-id');
                    printRentalInvoice(rentalId);
                });
            });
        }

        // View rental details
        function viewRentalDetails(rentalId) {
            // Implementation for viewing rental details
            alert('View rental details functionality would be implemented here');
        }

        // Edit rental
        function editRental(rentalId) {
            // Implementation for editing rental
            alert('Edit rental functionality would be implemented here');
        }

        // Delete rental
        function deleteRental(rentalId) {
            if (confirm('Are you sure you want to delete this rental?')) {
                const data = getData();
                const rental = data.rentals.find(r => r.id === rentalId);
                
                if (rental) {
                    // Update vehicle status back to Available
                    const vehicle = data.vehicles.find(v => v.id === rental.vehicleId);
                    if (vehicle) {
                        vehicle.status = 'Available';
                    }
                    
                    data.rentals = data.rentals.filter(r => r.id !== rentalId);
                    saveData(data);
                    loadRentalList();
                    alert('Rental deleted successfully!');
                }
            }
        }

        // Print rental invoice
        function printRentalInvoice(rentalId) {
            const data = getData();
            const rental = data.rentals.find(r => r.id === rentalId);
            
            if (rental) {
                printInvoice(rental);
            }
        }

        // Print invoice
        function printInvoice(rental) {
            // Populate invoice data
            document.getElementById('printInvoiceCode').textContent = rental.invoiceCode;
            document.getElementById('printInvoiceDate').textContent = formatDate(rental.createdDate);
            document.getElementById('printCustomerName').textContent = rental.customerName;
            document.getElementById('printVehicleName').textContent = rental.vehicleName;
            
            const customer = getData().customers.find(c => c.id === rental.customerId);
            if (customer) {
                document.getElementById('printCustomerId').textContent = customer.idNumber;
                document.getElementById('printCustomerAddress').textContent = customer.address;
            }
            
            document.getElementById('printRentalAmount').textContent = `${rental.rentalAmount} AED`;
            document.getElementById('printRentalDays').textContent = rental.rentalDays;
            document.getElementById('printTotalAmount').textContent = `${rental.totalAmount} AED`;
            
            // Apply system name and logo if available
            const settings = getData().settings;
            document.getElementById('printSystemName').textContent = settings.systemName;
            
            // Show the invoice and print
            document.getElementById('invoicePrint').style.display = 'block';
            window.print();
            document.getElementById('invoicePrint').style.display = 'none';
        }

        // Search rentals
        function searchRentals() {
            const query = document.getElementById('rentalSearch').value.toLowerCase();
            const data = getData();
            const filtered = data.rentals.filter(r => 
                r.invoiceCode.toLowerCase().includes(query) || 
                r.customerName.toLowerCase().includes(query) ||
                r.vehicleName.toLowerCase().includes(query)
            );
            
            const tbody = document.getElementById('rentalTableBody');
            tbody.innerHTML = '';
            
            filtered.forEach(rental => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${rental.invoiceCode}</td>
                    <td>${rental.customerName}</td>
                    <td>${rental.vehicleName}</td>
                    <td>${formatDate(rental.startDate)}</td>
                    <td>${formatDate(rental.endDate)}</td>
                    <td>${rental.totalAmount} AED</td>
                    <td>
                        <span class="badge ${rental.status === 'Active' ? 'bg-success' : 'bg-secondary'}">
                            ${rental.status}
                        </span>
                    </td>
                    <td>
                        <button class="btn btn-sm btn-info view-rental" data-id="${rental.id}">
                            <i class="fas fa-eye"></i>
                        </button>
                        <button class="btn btn-sm btn-warning edit-rental" data-id="${rental.id}">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn btn-sm btn-danger delete-rental" data-id="${rental.id}">
                            <i class="fas fa-trash"></i>
                        </button>
                        <button class="btn btn-sm btn-success print-invoice" data-id="${rental.id}">
                            <i class="fas fa-print"></i>
                        </button>
                    </td>
                `;
                tbody.appendChild(tr);
            });
            
            // Re-add event listeners
            document.querySelectorAll('.view-rental').forEach(btn => {
                btn.addEventListener('click', function() {
                    const rentalId = this.getAttribute('data-id');
                    viewRentalDetails(rentalId);
                });
            });
            
            document.querySelectorAll('.edit-rental').forEach(btn => {
                btn.addEventListener('click', function() {
                    const rentalId = this.getAttribute('data-id');
                    editRental(rentalId);
                });
            });
            
            document.querySelectorAll('.delete-rental').forEach(btn => {
                btn.addEventListener('click', function() {
                    const rentalId = this.getAttribute('data-id');
                    deleteRental(rentalId);
                });
            });
            
            document.querySelectorAll('.print-invoice').forEach(btn => {
                btn.addEventListener('click', function() {
                    const rentalId = this.getAttribute('data-id');
                    printRentalInvoice(rentalId);
                });
            });
        }

        // Search invoice for return
        function searchInvoiceForReturn() {
            const invoiceCode = document.getElementById('returnInvoiceSearch').value;
            const data = getData();
            const rental = data.rentals.find(r => r.invoiceCode === invoiceCode && r.status === 'Active');
            
            if (rental) {
                document.getElementById('returnCustomer').value = rental.customerName;
                document.getElementById('returnVehicle').value = rental.vehicleName;
                document.getElementById('returnStartDate').value = formatDate(rental.startDate);
                document.getElementById('returnEndDate').value = formatDate(rental.endDate);
                document.getElementById('returnRentalAmount').value = rental.rentalAmount;
                document.getElementById('returnRentalDays').value = rental.rentalDays;
                
                document.getElementById('returnFormContainer').style.display = 'block';
            } else {
                alert('Invoice not found or vehicle already returned!');
            }
        }

        // Calculate return total amount
        function calculateReturnTotal() {
            const lateDays = parseInt(document.getElementById('lateDays').value) || 0;
            const lateFee = parseFloat(document.getElementById('lateFee').value) || 0;
            const damageFee = parseFloat(document.getElementById('damageFee').value) || 0;
            const otherFees = parseFloat(document.getElementById('otherFees').value) || 0;
            
            const total = (lateDays * lateFee) + damageFee + otherFees;
            document.getElementById('returnTotalAmount').textContent = total;
        }

        // Return vehicle
        function returnVehicle(e) {
            e.preventDefault();
            
            const invoiceCode = document.getElementById('returnInvoiceSearch').value;
            const data = getData();
            const rental = data.rentals.find(r => r.invoiceCode === invoiceCode);
            
            if (rental) {
                const returnRecord = {
                    id: Date.now().toString(),
                    rentalId: rental.id,
                    invoiceCode: rental.invoiceCode,
                    customerName: rental.customerName,
                    vehicleName: rental.vehicleName,
                    odometer: parseInt(document.getElementById('returnOdometer').value),
                    returnDate: document.getElementById('returnDate').value,
                    lateDays: parseInt(document.getElementById('lateDays').value) || 0,
                    lateFee: parseFloat(document.getElementById('lateFee').value) || 0,
                    damageFee: parseFloat(document.getElementById('damageFee').value) || 0,
                    otherFees: parseFloat(document.getElementById('otherFees').value) || 0,
                    totalAmount: parseFloat(document.getElementById('returnTotalAmount').textContent),
                    notes: document.getElementById('returnNotes').value,
                    returnDate: new Date().toISOString().split('T')[0]
                };
                
                data.returns.push(returnRecord);
                
                // Update rental status
                rental.status = 'Completed';
                
                // Update vehicle status and odometer
                const vehicle = data.vehicles.find(v => v.id === rental.vehicleId);
                if (vehicle) {
                    vehicle.status = 'Available';
                    vehicle.odometer = returnRecord.odometer;
                }
                
                saveData(data);
                
                // Reset form
                document.getElementById('returnVehicleForm').reset();
                document.getElementById('returnFormContainer').style.display = 'none';
                document.getElementById('returnInvoiceSearch').value = '';
                
                // Reload return history
                loadReturnHistory();
                
                // Show success message
                alert('Vehicle returned successfully!');
            }
        }

        // Load return history
        function loadReturnHistory() {
            const data = getData();
            const tbody = document.getElementById('returnHistoryTableBody');
            tbody.innerHTML = '';
            
            data.returns.forEach(returnRecord => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${returnRecord.invoiceCode}</td>
                    <td>${returnRecord.customerName}</td>
                    <td>${returnRecord.vehicleName}</td>
                    <td>${formatDate(returnRecord.returnDate)}</td>
                    <td>${returnRecord.totalAmount} AED</td>
                    <td>
                        <button class="btn btn-sm btn-info view-return" data-id="${returnRecord.id}">
                            <i class="fas fa-eye"></i>
                        </button>
                    </td>
                `;
                tbody.appendChild(tr);
            });
        }

        // Schedule maintenance
        function scheduleMaintenance(e) {
            e.preventDefault();
            
            const data = getData();
            const vehicleName = document.getElementById('maintenanceVehicle').value;
            const vehicle = data.vehicles.find(v => v.name === vehicleName);
            
            if (!vehicle) {
                alert('Vehicle not found!');
                return;
            }
            
            const maintenance = {
                id: Date.now().toString(),
                vehicleId: vehicle.id,
                vehicleName: vehicle.name,
                type: document.getElementById('maintenanceType').value,
                date: document.getElementById('maintenanceDate').value,
                cost: parseFloat(document.getElementById('maintenanceCost').value),
                description: document.getElementById('maintenanceDescription').value,
                status: 'Scheduled'
            };
            
            data.maintenance.push(maintenance);
            saveData(data);
            
            // Reset form
            document.getElementById('scheduleMaintenanceForm').reset();
            
            // Reload maintenance history
            loadMaintenanceHistory();
            
            // Show success message
            alert('Maintenance scheduled successfully!');
        }

        // Load maintenance history
        function loadMaintenanceHistory() {
            const data = getData();
            const tbody = document.getElementById('maintenanceTableBody');
            tbody.innerHTML = '';
            
            data.maintenance.forEach(maintenance => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${maintenance.vehicleName}</td>
                    <td>${maintenance.type}</td>
                    <td>${formatDate(maintenance.date)}</td>
                    <td>${maintenance.cost} AED</td>
                    <td>
                        <span class="badge ${maintenance.status === 'Completed' ? 'bg-success' : 'bg-warning'}">
                            ${maintenance.status}
                        </span>
                    </td>
                    <td>
                        <button class="btn btn-sm btn-info view-maintenance" data-id="${maintenance.id}">
                            <i class="fas fa-eye"></i>
                        </button>
                        <button class="btn btn-sm btn-warning edit-maintenance" data-id="${maintenance.id}">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn btn-sm btn-danger delete-maintenance" data-id="${maintenance.id}">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
                tbody.appendChild(tr);
            });
        }

        // Search maintenance
        function searchMaintenance() {
            const query = document.getElementById('maintenanceSearch').value.toLowerCase();
            const data = getData();
            const filtered = data.maintenance.filter(m => 
                m.vehicleName.toLowerCase().includes(query) || 
                m.type.toLowerCase().includes(query)
            );
            
            const tbody = document.getElementById('maintenanceTableBody');
            tbody.innerHTML = '';
            
            filtered.forEach(maintenance => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${maintenance.vehicleName}</td>
                    <td>${maintenance.type}</td>
                    <td>${formatDate(maintenance.date)}</td>
                    <td>${maintenance.cost} AED</td>
                    <td>
                        <span class="badge ${maintenance.status === 'Completed' ? 'bg-success' : 'bg-warning'}">
                            ${maintenance.status}
                        </span>
                    </td>
                    <td>
                        <button class="btn btn-sm btn-info view-maintenance" data-id="${maintenance.id}">
                            <i class="fas fa-eye"></i>
                        </button>
                        <button class="btn btn-sm btn-warning edit-maintenance" data-id="${maintenance.id}">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn btn-sm btn-danger delete-maintenance" data-id="${maintenance.id}">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
                tbody.appendChild(tr);
            });
        }

        // Record payment
        function recordPayment(e) {
            e.preventDefault();
            
            const data = getData();
            const customerName = document.getElementById('paymentCustomer').value;
            const invoiceCode = document.getElementById('paymentInvoice').value;
            
            const customer = data.customers.find(c => c.fullName === customerName);
            const rental = data.rentals.find(r => r.invoiceCode === invoiceCode);
            
            if (!customer) {
                alert('Customer not found!');
                return;
            }
            
            if (!rental) {
                alert('Invoice not found!');
                return;
            }
            
            const payment = {
                id: Date.now().toString(),
                customerId: customer.id,
                customerName: customer.fullName,
                invoiceCode: invoiceCode,
                amount: parseFloat(document.getElementById('paymentAmount').value),
                date: document.getElementById('paymentDate').value,
                method: document.getElementById('paymentMethod').value,
                status: document.getElementById('paymentStatus').value,
                notes: document.getElementById('paymentNotes').value
            };
            
            data.payments.push(payment);
            saveData(data);
            
            // Reset form
            document.getElementById('recordPaymentForm').reset();
            
            // Reload payment history
            loadPaymentHistory();
            
            // Show success message
            alert('Payment recorded successfully!');
        }

        // Load payment history
        function loadPaymentHistory() {
            const data = getData();
            const tbody = document.getElementById('paymentTableBody');
            tbody.innerHTML = '';
            
            data.payments.forEach(payment => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${payment.customerName}</td>
                    <td>${payment.invoiceCode}</td>
                    <td>${payment.amount} AED</td>
                    <td>${formatDate(payment.date)}</td>
                    <td>${payment.method}</td>
                    <td>
                        <span class="badge ${payment.status === 'Completed' ? 'bg-success' : payment.status === 'Pending' ? 'bg-warning' : 'bg-danger'}">
                            ${payment.status}
                        </span>
                    </td>
                    <td>
                        <button class="btn btn-sm btn-info view-payment" data-id="${payment.id}">
                            <i class="fas fa-eye"></i>
                        </button>
                    </td>
                `;
                tbody.appendChild(tr);
            });
        }

        // Search payments
        function searchPayments() {
            const query = document.getElementById('paymentSearch').value.toLowerCase();
            const data = getData();
            const filtered = data.payments.filter(p => 
                p.customerName.toLowerCase().includes(query) || 
                p.invoiceCode.toLowerCase().includes(query)
            );
            
            const tbody = document.getElementById('paymentTableBody');
            tbody.innerHTML = '';
            
            filtered.forEach(payment => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${payment.customerName}</td>
                    <td>${payment.invoiceCode}</td>
                    <td>${payment.amount} AED</td>
                    <td>${formatDate(payment.date)}</td>
                    <td>${payment.method}</td>
                    <td>
                        <span class="badge ${payment.status === 'Completed' ? 'bg-success' : payment.status === 'Pending' ? 'bg-warning' : 'bg-danger'}">
                            ${payment.status}
                        </span>
                    </td>
                    <td>
                        <button class="btn btn-sm btn-info view-payment" data-id="${payment.id}">
                            <i class="fas fa-eye"></i>
                        </button>
                    </td>
                `;
                tbody.appendChild(tr);
            });
        }

        // Add fine/tax
        function addFineTax(e) {
            e.preventDefault();
            
            const data = getData();
            const customerName = document.getElementById('fineCustomer').value;
            const vehicleName = document.getElementById('fineVehicle').value;
            
            const customer = data.customers.find(c => c.fullName === customerName);
            const vehicle = data.vehicles.find(v => v.name === vehicleName);
            
            if (!customer) {
                alert('Customer not found!');
                return;
            }
            
            if (!vehicle) {
                alert('Vehicle not found!');
                return;
            }
            
            const fine = {
                id: Date.now().toString(),
                customerId: customer.id,
                customerName: customer.fullName,
                vehicleId: vehicle.id,
                vehicleName: vehicle.name,
                type: document.getElementById('fineType').value,
                amount: parseFloat(document.getElementById('fineAmount').value),
                date: document.getElementById('fineDate').value,
                dueDate: document.getElementById('fineDueDate').value,
                description: document.getElementById('fineDescription').value,
                status: 'Unpaid'
            };
            
            data.fines.push(fine);
            saveData(data);
            
            // Reset form
            document.getElementById('addFineTaxForm').reset();
            
            // Reload fines history
            loadFinesHistory();
            
            // Show success message
            alert('Fine/Tax added successfully!');
        }

        // Load fines history
        function loadFinesHistory() {
            const data = getData();
            const tbody = document.getElementById('fineTableBody');
            tbody.innerHTML = '';
            
            data.fines.forEach(fine => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${fine.customerName}</td>
                    <td>${fine.vehicleName}</td>
                    <td>${fine.type}</td>
                    <td>${fine.amount} AED</td>
                    <td>${formatDate(fine.date)}</td>
                    <td>${formatDate(fine.dueDate)}</td>
                    <td>
                        <span class="badge ${fine.status === 'Paid' ? 'bg-success' : 'bg-danger'}">
                            ${fine.status}
                        </span>
                    </td>
                    <td>
                        <button class="btn btn-sm btn-info view-fine" data-id="${fine.id}">
                            <i class="fas fa-eye"></i>
                        </button>
                        <button class="btn btn-sm btn-warning edit-fine" data-id="${fine.id}">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn btn-sm btn-danger delete-fine" data-id="${fine.id}">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
                tbody.appendChild(tr);
            });
        }

        // Search fines
        function searchFines() {
            const query = document.getElementById('fineSearch').value.toLowerCase();
            const data = getData();
            const filtered = data.fines.filter(f => 
                f.customerName.toLowerCase().includes(query) || 
                f.vehicleName.toLowerCase().includes(query) ||
                f.type.toLowerCase().includes(query)
            );
            
            const tbody = document.getElementById('fineTableBody');
            tbody.innerHTML = '';
            
            filtered.forEach(fine => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${fine.customerName}</td>
                    <td>${fine.vehicleName}</td>
                    <td>${fine.type}</td>
                    <td>${fine.amount} AED</td>
                    <td>${formatDate(fine.date)}</td>
                    <td>${formatDate(fine.dueDate)}</td>
                    <td>
                        <span class="badge ${fine.status === 'Paid' ? 'bg-success' : 'bg-danger'}">
                            ${fine.status}
                        </span>
                    </td>
                    <td>
                        <button class="btn btn-sm btn-info view-fine" data-id="${fine.id}">
                            <i class="fas fa-eye"></i>
                        </button>
                        <button class="btn btn-sm btn-warning edit-fine" data-id="${fine.id}">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn btn-sm btn-danger delete-fine" data-id="${fine.id}">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
                tbody.appendChild(tr);
            });
        }

        // Generate report
        function generateReport() {
            const reportType = document.getElementById('reportType').value;
            const startDate = document.getElementById('reportStartDate').value;
            const endDate = document.getElementById('reportEndDate').value;
            
            const data = getData();
            let results = '';
            
            switch (reportType) {
                case 'rental':
                    const rentals = data.rentals.filter(r => {
                        if (startDate && endDate) {
                            return r.startDate >= startDate && r.endDate <= endDate;
                        }
                        return true;
                    });
                    
                    results = `
                        <h4>Rental Report</h4>
                        <p>Period: ${startDate || 'All'} to ${endDate || 'All'}</p>
                        <div class="table-responsive">
                            <table class="table table-bordered">
                                <thead>
                                    <tr>
                                        <th>Invoice Code</th>
                                        <th>Customer</th>
                                        <th>Vehicle</th>
                                        <th>Start Date</th>
                                        <th>End Date</th>
                                        <th>Amount</th>
                                        <th>Status</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${rentals.map(r => `
                                        <tr>
                                            <td>${r.invoiceCode}</td>
                                            <td>${r.customerName}</td>
                                            <td>${r.vehicleName}</td>
                                            <td>${formatDate(r.startDate)}</td>
                                            <td>${formatDate(r.endDate)}</td>
                                            <td>${r.totalAmount} AED</td>
                                            <td>${r.status}</td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                                <tfoot>
                                    <tr>
                                        <td colspan="5" class="text-end"><strong>Total:</strong></td>
                                        <td><strong>${rentals.reduce((sum, r) => sum + r.totalAmount, 0)} AED</strong></td>
                                        <td></td>
                                    </tr>
                                </tfoot>
                            </table>
                        </div>
                    `;
                    break;
                    
                case 'revenue':
                    const payments = data.payments.filter(p => {
                        if (startDate && endDate) {
                            return p.date >= startDate && p.date <= endDate;
                        }
                        return true;
                    });
                    
                    const completedRentals = data.rentals.filter(r => r.status === 'Completed');
                    const totalRevenue = completedRentals.reduce((sum, r) => sum + r.totalAmount, 0);
                    const totalPayments = payments.reduce((sum, p) => sum + p.amount, 0);
                    
                    results = `
                        <h4>Revenue Report</h4>
                        <p>Period: ${startDate || 'All'} to ${endDate || 'All'}</p>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="card bg-primary text-white">
                                    <div class="card-body">
                                        <h5>Total Rental Revenue</h5>
                                        <h3>${totalRevenue} AED</h3>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="card bg-success text-white">
                                    <div class="card-body">
                                        <h5>Total Payments Received</h5>
                                        <h3>${totalPayments} AED</h3>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="table-responsive mt-4">
                            <table class="table table-bordered">
                                <thead>
                                    <tr>
                                        <th>Date</th>
                                        <th>Customer</th>
                                        <th>Invoice Code</th>
                                        <th>Amount</th>
                                        <th>Method</th>
                                        <th>Status</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${payments.map(p => `
                                        <tr>
                                            <td>${formatDate(p.date)}</td>
                                            <td>${p.customerName}</td>
                                            <td>${p.invoiceCode}</td>
                                            <td>${p.amount} AED</td>
                                            <td>${p.method}</td>
                                            <td>${p.status}</td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        </div>
                    `;
                    break;
                    
                // Other report types would be implemented similarly
                default:
                    results = '<p>Select a report type to generate.</p>';
            }
            
            document.getElementById('reportResults').innerHTML = results;
        }

        // Export report
        function exportReport() {
            alert('Export to Excel functionality would be implemented here');
        }

        // Search invoice for FRR
        function searchInvoiceForFRR() {
            const invoiceCode = document.getElementById('frrInvoiceSearch').value;
            const data = getData();
            const rental = data.rentals.find(r => r.invoiceCode === invoiceCode);
            
            if (rental) {
                document.getElementById('frrCustomer').value = rental.customerName;
                document.getElementById('frrVehicle').value = rental.vehicleName;
                document.getElementById('frrStartDate').value = formatDate(rental.startDate);
                document.getElementById('frrEndDate').value = formatDate(rental.endDate);
                
                document.getElementById('frrFormContainer').style.display = 'block';
            } else {
                alert('Invoice not found!');
            }
        }

        // Submit FRR
        function submitFRR(e) {
            e.preventDefault();
            
            const invoiceCode = document.getElementById('frrInvoiceSearch').value;
            const data = getData();
            const rental = data.rentals.find(r => r.invoiceCode === invoiceCode);
            
            if (rental) {
                const frrRecord = {
                    id: Date.now().toString(),
                    rentalId: rental.id,
                    invoiceCode: rental.invoiceCode,
                    customerName: rental.customerName,
                    vehicleName: rental.vehicleName,
                    odometer: parseInt(document.getElementById('frrOdometer').value),
                    returnDate: document.getElementById('frrReturnDate').value,
                    notes: document.getElementById('frrNotes').value,
                    completedDate: new Date().toISOString().split('T')[0]
                };
                
                // In a real app, you would have a separate collection for FRR records
                // For this demo, we'll just show a success message
                
                // Reset form
                document.getElementById('frrForm').reset();
                document.getElementById('frrFormContainer').style.display = 'none';
                document.getElementById('frrInvoiceSearch').value = '';
                
                // Show success message
                alert('Final Return Rental completed successfully!');
            }
        }

        // Save system settings
        function saveSystemSettings(e) {
            e.preventDefault();
            
            const data = getData();
            data.settings.systemName = document.getElementById('systemName').value;
            data.settings.currency = document.getElementById('systemCurrency').value;
            data.settings.dateFormat = document.getElementById('systemDateFormat').value;
            data.settings.lateReturnFee = parseFloat(document.getElementById('lateReturnFee').value);
            data.settings.taxRate = parseFloat(document.getElementById('taxRate').value);
            
            saveData(data);
            
            // Apply settings
            applySystemSettings();
            
            // Show success message
            alert('System settings saved successfully!');
        }

        // Apply system settings
        function applySystemSettings() {
            const data = getData();
            const settings = data.settings;
            
            // Update system name in header and sidebar
            document.getElementById('headerSystemName').textContent = settings.systemName;
            document.getElementById('sidebarSystemName').textContent = settings.systemName;
            
            // Update currency badges
            document.querySelectorAll('.currency-badge').forEach(badge => {
                badge.textContent = settings.currency;
            });
            
            // Handle logo (in a real app, you would display the uploaded logo)
            const logoInput = document.getElementById('systemLogo');
            if (logoInput.files.length > 0) {
                // In a real app, you would upload the file and store the URL
                // For this demo, we'll just show a placeholder
                const logoUrl = 'placeholder-logo.png';
                document.getElementById('headerLogo').src = logoUrl;
                document.getElementById('headerLogo').style.display = 'inline';
                document.getElementById('sidebarLogo').src = logoUrl;
                document.getElementById('sidebarLogo').style.display = 'block';
                document.getElementById('printLogo').src = logoUrl;
                document.getElementById('printLogo').style.display = 'inline';
            }
        }

        // Change password
        function changePassword(e) {
            e.preventDefault();
            
            const currentPassword = document.getElementById('currentPassword').value;
            const newPassword = document.getElementById('newPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            
            if (newPassword !== confirmPassword) {
                alert('New passwords do not match!');
                return;
            }
            
            const data = getData();
            const currentUser = localStorage.getItem('currentUser');
            const user = data.users.find(u => u.username === currentUser);
            
            if (user && user.password === currentPassword) {
                user.password = newPassword;
                saveData(data);
                
                // Reset form
                document.getElementById('changePasswordForm').reset();
                
                // Close modal
                bootstrap.Modal.getInstance(document.getElementById('changePasswordModal')).hide();
                
                // Show success message
                alert('Password changed successfully!');
            } else {
                alert('Current password is incorrect!');
            }
        }

        // Add user
        function addUser(e) {
            e.preventDefault();
            
            const data = getData();
            const username = document.getElementById('newUsername').value;
            const password = document.getElementById('newUserPassword').value;
            const role = document.getElementById('newUserRole').value;
            
            // Check if username already exists
            if (data.users.find(u => u.username === username)) {
                alert('Username already exists!');
                return;
            }
            
            const permissions = [];
            if (document.getElementById('permissionView').checked) permissions.push('view');
            if (document.getElementById('permissionEdit').checked) permissions.push('edit');
            if (document.getElementById('permissionDelete').checked) permissions.push('delete');
            
            const user = {
                username: username,
                password: password,
                role: role,
                permissions: permissions
            };
            
            data.users.push(user);
            saveData(data);
            
            // Reset form
            document.getElementById('addUserForm').reset();
            
            // Close modal
            bootstrap.Modal.getInstance(document.getElementById('addUserModal')).hide();
            
            // Reload user list
            loadUserList();
            
            // Show success message
            alert('User added successfully!');
        }

        // Load user list
        function loadUserList() {
            const data = getData();
            const tbody = document.getElementById('userTableBody');
            tbody.innerHTML = '';
            
            data.users.forEach(user => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${user.username}</td>
                    <td>${user.role}</td>
                    <td>${user.permissions.join(', ')}</td>
                    <td>
                        <button class="btn btn-sm btn-warning edit-user" data-username="${user.username}">
                            <i class="fas fa-edit"></i>
                        </button>
                        ${user.username !== 'admin' ? `
                            <button class="btn btn-sm btn-danger delete-user" data-username="${user.username}">
                                <i class="fas fa-trash"></i>
                            </button>
                        ` : ''}
                    </td>
                `;
                tbody.appendChild(tr);
            });
            
            // Add event listeners for user actions
            document.querySelectorAll('.edit-user').forEach(btn => {
                btn.addEventListener('click', function() {
                    const username = this.getAttribute('data-username');
                    editUser(username);
                });
            });
            
            document.querySelectorAll('.delete-user').forEach(btn => {
                btn.addEventListener('click', function() {
                    const username = this.getAttribute('data-username');
                    deleteUser(username);
                });
            });
        }

        // Edit user
        function editUser(username) {
            // Implementation for editing user
            alert('Edit user functionality would be implemented here');
        }

        // Delete user
        function deleteUser(username) {
            if (confirm('Are you sure you want to delete this user?')) {
                const data = getData();
                data.users = data.users.filter(u => u.username !== username);
                saveData(data);
                loadUserList();
                alert('User deleted successfully!');
            }
        }

        // Create backup
        function createBackup() {
            const data = getData();
            const backup = {
                id: Date.now().toString(),
                date: new Date().toISOString(),
                data: JSON.stringify(data)
            };
            
            data.backups.push(backup);
            saveData(data);
            
            // Reload backup history
            loadBackupHistory();
            
            // Show success message
            alert('Backup created successfully!');
        }

        // Restore backup
        function restoreBackup() {
            const fileInput = document.getElementById('restoreFile');
            
            if (fileInput.files.length === 0) {
                alert('Please select a backup file!');
                return;
            }
            
            const file = fileInput.files[0];
            const reader = new FileReader();
            
            reader.onload = function(e) {
                try {
                    const backupData = JSON.parse(e.target.result);
                    
                    if (confirm('Are you sure you want to restore this backup? All current data will be replaced.')) {
                        localStorage.setItem('carRentalData', JSON.stringify(backupData));
                        
                        // Reload the page to apply the restored data
                        location.reload();
                    }
                } catch (error) {
                    alert('Invalid backup file!');
                }
            };
            
            reader.readAsText(file);
        }

        // Load backup history
        function loadBackupHistory() {
            const data = getData();
            const tbody = document.getElementById('backupHistoryTable');
            tbody.innerHTML = '';
            
            data.backups.forEach(backup => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${formatDate(backup.date)}</td>
                    <td>${Math.round(backup.data.length / 1024)} KB</td>
                    <td>
                        <button class="btn btn-sm btn-info download-backup" data-id="${backup.id}">
                            <i class="fas fa-download"></i>
                        </button>
                        <button class="btn btn-sm btn-danger delete-backup" data-id="${backup.id}">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
                tbody.appendChild(tr);
            });
            
            // Add event listeners for backup actions
            document.querySelectorAll('.download-backup').forEach(btn => {
                btn.addEventListener('click', function() {
                    const backupId = this.getAttribute('data-id');
                    downloadBackup(backupId);
                });
            });
            
            document.querySelectorAll('.delete-backup').forEach(btn => {
                btn.addEventListener('click', function() {
                    const backupId = this.getAttribute('data-id');
                    deleteBackup(backupId);
                });
            });
        }

        // Download backup
        function downloadBackup(backupId) {
            const data = getData();
            const backup = data.backups.find(b => b.id === backupId);
            
            if (backup) {
                const blob = new Blob([backup.data], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `car-rental-backup-${backup.date.split('T')[0]}.json`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            }
        }

        // Delete backup
        function deleteBackup(backupId) {
            if (confirm('Are you sure you want to delete this backup?')) {
                const data = getData();
                data.backups = data.backups.filter(b => b.id !== backupId);
                saveData(data);
                loadBackupHistory();
                alert('Backup deleted successfully!');
            }
        }

        // Load dashboard data
        function loadDashboardData() {
            const data = getData();
            
            // Update dashboard statistics
            const stats = {
                totalVehicles: data.vehicles.length,
                availableVehicles: data.vehicles.filter(v => v.status === 'Available').length,
                totalCustomers: data.customers.length,
                activeRentals: data.rentals.filter(r => r.status === 'Active').length,
                totalRevenue: data.rentals.reduce((sum, r) => sum + r.totalAmount, 0),
                pendingPayments: data.payments.filter(p => p.status === 'Pending').length
            };
            
            document.getElementById('dashboardStats').innerHTML = `
                <div class="col-md-4 mb-4">
                    <div class="card dashboard-card bg-primary text-white">
                        <div class="card-body">
                            <div class="d-flex justify-content-between">
                                <div>
                                    <h4>${stats.totalVehicles}</h4>
                                    <p>Total Vehicles</p>
                                </div>
                                <div class="align-self-center">
                                    <i class="fas fa-car fa-2x"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-4 mb-4">
                    <div class="card dashboard-card bg-success text-white">
                        <div class="card-body">
                            <div class="d-flex justify-content-between">
                                <div>
                                    <h4>${stats.availableVehicles}</h4>
                                    <p>Available Vehicles</p>
                                </div>
                                <div class="align-self-center">
                                    <i class="fas fa-car-side fa-2x"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-4 mb-4">
                    <div class="card dashboard-card bg-info text-white">
                        <div class="card-body">
                            <div class="d-flex justify-content-between">
                                <div>
                                    <h4>${stats.totalCustomers}</h4>
                                    <p>Total Customers</p>
                                </div>
                                <div class="align-self-center">
                                    <i class="fas fa-users fa-2x"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-4 mb-4">
                    <div class="card dashboard-card bg-warning text-white">
                        <div class="card-body">
                            <div class="d-flex justify-content-between">
                                <div>
                                    <h4>${stats.activeRentals}</h4>
                                    <p>Active Rentals</p>
                                </div>
                                <div class="align-self-center">
                                    <i class="fas fa-receipt fa-2x"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-4 mb-4">
                    <div class="card dashboard-card bg-danger text-white">
                        <div class="card-body">
                            <div class="d-flex justify-content-between">
                                <div>
                                    <h4>${stats.totalRevenue} AED</h4>
                                    <p>Total Revenue</p>
                                </div>
                                <div class="align-self-center">
                                    <i class="fas fa-money-bill-wave fa-2x"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-4 mb-4">
                    <div class="card dashboard-card bg-secondary text-white">
                        <div class="card-body">
                            <div class="d-flex justify-content-between">
                                <div>
                                    <h4>${stats.pendingPayments}</h4>
                                    <p>Pending Payments</p>
                                </div>
                                <div class="align-self-center">
                                    <i class="fas fa-clock fa-2x"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            // Update recent rentals
            const recentRentals = data.rentals.slice(-5).reverse();
            const recentRentalsTable = document.getElementById('recentRentalsTable');
            recentRentalsTable.innerHTML = '';
            
            recentRentals.forEach(rental => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${rental.customerName}</td>
                    <td>${rental.vehicleName}</td>
                    <td>${formatDate(rental.startDate)}</td>
                    <td>${rental.totalAmount} AED</td>
                    <td>
                        <span class="badge ${rental.status === 'Active' ? 'bg-success' : 'bg-secondary'}">
                            ${rental.status}
                        </span>
                    </td>
                `;
                recentRentalsTable.appendChild(tr);
            });
            
            // Update vehicle status chart
            updateVehicleStatusChart(data);
        }

        // Update vehicle status chart
        function updateVehicleStatusChart(data) {
            const available = data.vehicles.filter(v => v.status === 'Available').length;
            const rented = data.vehicles.filter(v => v.status === 'Rented').length;
            const maintenance = data.vehicles.filter(v => v.status === 'Maintenance').length;
            
            const ctx = document.getElementById('vehicleStatusChart').getContext('2d');
            
            // Destroy existing chart if it exists
            if (window.vehicleStatusChart) {
                window.vehicleStatusChart.destroy();
            }
            
            window.vehicleStatusChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['Available', 'Rented', 'Maintenance'],
                    datasets: [{
                        data: [available, rented, maintenance],
                        backgroundColor: [
                            'rgba(40, 167, 69, 0.8)',
                            'rgba(0, 123, 255, 0.8)',
                            'rgba(255, 193, 7, 0.8)'
                        ],
                        borderColor: [
                            'rgba(40, 167, 69, 1)',
                            'rgba(0, 123, 255, 1)',
                            'rgba(255, 193, 7, 1)'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'bottom',
                        },
                        title: {
                            display: true,
                            text: 'Vehicle Status Distribution'
                        }
                    }
                }
            });
        }

        // Format date based on system settings
        function formatDate(dateString) {
            const data = getData();
            const dateFormat = data.settings.dateFormat;
            const date = new Date(dateString);
            
            if (isNaN(date.getTime())) {
                return dateString;
            }
            
            const day = String(date.getDate()).padStart(2, '0');
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const year = date.getFullYear();
            
            switch (dateFormat) {
                case 'dd/mm/yyyy':
                    return `${day}/${month}/${year}`;
                case 'mm/dd/yyyy':
                    return `${month}/${day}/${year}`;
                case 'yyyy-mm-dd':
                    return `${year}-${month}-${day}`;
                default:
                    return `${day}/${month}/${year}`;
            }
        }

        // Close suggestion lists when clicking outside
        document.addEventListener('click', function(e) {
            if (!e.target.matches('.form-control')) {
                document.querySelectorAll('.suggestion-list').forEach(list => {
                    list.style.display = 'none';
                });
            }
        });
    </script>
</body>
</html>