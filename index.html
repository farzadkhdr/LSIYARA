<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Car Rental System</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #3498db;
            --secondary-color: #2c3e50;
            --success-color: #27ae60;
            --danger-color: #e74c3c;
            --warning-color: #f39c12;
            --info-color: #17a2b8;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f8f9fa;
        }
        
        .navbar-brand {
            font-weight: bold;
        }
        
        .sidebar {
            background-color: var(--secondary-color);
            color: white;
            min-height: calc(100vh - 56px);
            padding: 0;
        }
        
        .sidebar .nav-link {
            color: rgba(255, 255, 255, 0.8);
            padding: 12px 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .sidebar .nav-link:hover, .sidebar .nav-link.active {
            background-color: rgba(255, 255, 255, 0.1);
            color: white;
        }
        
        .sidebar .nav-link i {
            margin-right: 10px;
            width: 20px;
            text-align: center;
        }
        
        .card {
            border: none;
            box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075);
            margin-bottom: 20px;
        }
        
        .card-header {
            background-color: white;
            border-bottom: 1px solid rgba(0, 0, 0, 0.125);
            font-weight: 600;
        }
        
        .dashboard-card {
            transition: transform 0.3s;
        }
        
        .dashboard-card:hover {
            transform: translateY(-5px);
        }
        
        .table-responsive {
            border-radius: 5px;
        }
        
        .tab-content {
            padding: 20px;
            background-color: white;
            border-radius: 0 0 5px 5px;
        }
        
        .nav-tabs .nav-link.active {
            border-bottom: 3px solid var(--primary-color);
            font-weight: 600;
        }
        
        .form-control:focus, .form-select:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 0.25rem rgba(52, 152, 219, 0.25);
        }
        
        .btn-primary {
            background-color: var(--primary-color);
            border-color: var(--primary-color);
        }
        
        .btn-success {
            background-color: var(--success-color);
            border-color: var(--success-color);
        }
        
        .btn-danger {
            background-color: var(--danger-color);
            border-color: var(--danger-color);
        }
        
        .btn-warning {
            background-color: var(--warning-color);
            border-color: var(--warning-color);
        }
        
        .logo-container {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 15px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .system-name {
            font-size: 1.2rem;
            font-weight: bold;
            margin-left: 10px;
        }
        
        .copyright {
            position: absolute;
            bottom: 10px;
            width: 100%;
            text-align: center;
            font-size: 0.8rem;
            color: rgba(255, 255, 255, 0.6);
        }
        
        .print-only {
            display: none;
        }
        
        @media print {
            .no-print {
                display: none !important;
            }
            .print-only {
                display: block;
            }
            body {
                background-color: white;
            }
            .card {
                box-shadow: none;
                border: 1px solid #ddd;
            }
        }
        
        .vehicle-details, .customer-details {
            display: none;
            margin-top: 20px;
        }
        
        .suggestion-list {
            position: absolute;
            background: white;
            border: 1px solid #ddd;
            max-height: 200px;
            overflow-y: auto;
            z-index: 1000;
            width: 100%;
            display: none;
        }
        
        .suggestion-item {
            padding: 8px 12px;
            cursor: pointer;
        }
        
        .suggestion-item:hover {
            background-color: #f8f9fa;
        }
        
        .status-returned {
            background-color: #d4edda;
        }
        
        .status-not-returned {
            background-color: #f8d7da;
        }
        
        .login-container {
            max-width: 400px;
            margin: 100px auto;
            padding: 20px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
        }
        
        .invoice-logo {
            text-align: center;
            margin-bottom: 20px;
        }
        
        .invoice-logo img {
            max-width: 200px;
            height: auto;
        }
        
        .custom-logo {
            max-height: 50px;
            margin-right: 10px;
        }
        
        .currency-badge {
            font-size: 0.7rem;
            margin-left: 5px;
        }
        
        .user-only {
            display: none;
        }
        
        .system-logo-large {
            max-width: 200px;
            max-height: 80px;
            margin-bottom: 15px;
        }
        
        .signature-area {
            margin-top: 50px;
            border-top: 1px solid #000;
            padding-top: 10px;
        }
        
        .maintenance-status {
            background-color: #fff3cd;
        }
        
        .notification-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background-color: red;
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
        }
        
        .vehicle-image {
            max-width: 200px;
            max-height: 150px;
            object-fit: cover;
            border-radius: 5px;
            margin-bottom: 10px;
        }
        
        .permission-checkbox {
            margin-right: 10px;
        }
        
        .permission-item {
            margin-bottom: 10px;
            padding: 10px;
            border: 1px solid #e9ecef;
            border-radius: 5px;
        }
    </style>
</head>
<body>
    <!-- Login Screen -->
    <div id="loginScreen" class="login-container">
        <div class="text-center mb-4">
            <i class="fas fa-car fa-3x text-primary mb-3"></i>
            <h2>Car Rental System</h2>
            <p class="text-muted">Please login to continue</p>
        </div>
        <form id="loginForm">
            <div class="mb-3">
                <label for="username" class="form-label">Username</label>
                <input type="text" class="form-control" id="username" required>
            </div>
            <div class="mb-3">
                <label for="password" class="form-label">Password</label>
                <input type="password" class="form-control" id="password" required>
            </div>
            <button type="submit" class="btn btn-primary w-100">Login</button>
        </form>
        <div class="text-center mt-3">
            <small class="text-muted">Default admin password: 000000</small>
        </div>
        <div class="text-center mt-4">
            <small class="text-muted">Created by Farzad Programmer - Not Editable</small>
        </div>
    </div>

    <!-- Main Application -->
    <div id="mainApp" style="display: none;">
        <!-- Navigation Bar -->
        <nav class="navbar navbar-expand-lg navbar-dark bg-dark no-print">
            <div class="container-fluid">
                <a class="navbar-brand" href="#">
                    <img id="headerLogo" src="" class="custom-logo" style="display: none;">
                    <span id="headerSystemName">Car Rental System</span>
                </a>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarNav">
                    <ul class="navbar-nav ms-auto">
                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-bs-toggle="dropdown">
                                <i class="fas fa-user-circle"></i> <span id="currentUser">Admin</span>
                            </a>
                            <ul class="dropdown-menu">
                                <li><a class="dropdown-item" href="#" data-bs-toggle="modal" data-bs-target="#changePasswordModal"><i class="fas fa-key"></i> Change Password</a></li>
                                <li class="admin-only"><a class="dropdown-item" href="#" data-bs-toggle="modal" data-bs-target="#userManagementModal"><i class="fas fa-users"></i> User Management</a></li>
                                <li><hr class="dropdown-divider"></li>
                                <li><a class="dropdown-item" href="#" id="logoutBtn"><i class="fas fa-sign-out-alt"></i> Logout</a></li>
                            </ul>
                        </li>
                    </ul>
                </div>
            </div>
        </nav>

        <div class="container-fluid">
            <div class="row">
                <!-- Sidebar -->
                <div class="col-md-2 sidebar d-none d-md-block no-print">
                    <div class="logo-container">
                        <img id="sidebarLogo" src="" class="system-logo-large" style="display: none;">
                        <span class="system-name" id="sidebarSystemName">RentalSys</span>
                    </div>
                    <ul class="nav flex-column">
                        <li class="nav-item dashboard-item">
                            <a class="nav-link active" href="#dashboard" data-bs-toggle="tab">
                                <i class="fas fa-tachometer-alt"></i> Dashboard
                            </a>
                        </li>
                        <li class="nav-item vehicles-item">
                            <a class="nav-link" href="#vehicles" data-bs-toggle="tab">
                                <i class="fas fa-car"></i> Vehicles
                            </a>
                        </li>
                        <li class="nav-item customers-item">
                            <a class="nav-link" href="#customers" data-bs-toggle="tab">
                                <i class="fas fa-users"></i> Customers
                            </a>
                        </li>
                        <li class="nav-item rentals-item">
                            <a class="nav-link" href="#rentals" data-bs-toggle="tab">
                                <i class="fas fa-receipt"></i> Rentals
                            </a>
                        </li>
                        <li class="nav-item returns-item">
                            <a class="nav-link" href="#returns" data-bs-toggle="tab">
                                <i class="fas fa-undo"></i> Vehicle Returns
                            </a>
                        </li>
                        <li class="nav-item maintenance-item">
                            <a class="nav-link" href="#maintenance" data-bs-toggle="tab">
                                <i class="fas fa-tools"></i> Vehicle Maintenance
                            </a>
                        </li>
                        <li class="nav-item payments-item">
                            <a class="nav-link" href="#payments" data-bs-toggle="tab">
                                <i class="fas fa-money-bill-wave"></i> Payments
                            </a>
                        </li>
                        <li class="nav-item fines-item">
                            <a class="nav-link" href="#fines" data-bs-toggle="tab">
                                <i class="fas fa-gavel"></i> Fines & Taxes
                            </a>
                        </li>
                        <li class="nav-item reports-item">
                            <a class="nav-link" href="#reports" data-bs-toggle="tab">
                                <i class="fas fa-chart-bar"></i> Reports
                            </a>
                        </li>
                        <li class="nav-item frr-item">
                            <a class="nav-link" href="#frr" data-bs-toggle="tab">
                                <i class="fas fa-file-alt"></i> F.RETU.RENT
                            </a>
                        </li>
                        <li class="nav-item admin-only settings-item">
                            <a class="nav-link" href="#settings" data-bs-toggle="tab">
                                <i class="fas fa-cogs"></i> System Settings
                            </a>
                        </li>
                    </ul>
                    <div class="copyright">
                        Created by Farzad Programmer<br>Not Editable
                    </div>
                </div>

                <!-- Main Content -->
                <div class="col-md-10 ms-sm-auto col-lg-10 px-4">
                    <div class="tab-content mt-4">
                        <!-- Dashboard Tab -->
                        <div class="tab-pane fade show active" id="dashboard">
                            <h2 class="mb-4">Dashboard</h2>
                            <div class="row" id="dashboardStats">
                                <!-- Dashboard statistics will be loaded here -->
                            </div>
                            
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="card">
                                        <div class="card-header">
                                            Recent Rentals
                                        </div>
                                        <div class="card-body">
                                            <div class="table-responsive">
                                                <table class="table table-hover">
                                                    <thead>
                                                        <tr>
                                                            <th>Customer</th>
                                                            <th>Vehicle</th>
                                                            <th>Date</th>
                                                            <th>Amount</th>
                                                            <th>Status</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody id="recentRentalsTable">
                                                        <!-- Recent rentals will be loaded here -->
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="card">
                                        <div class="card-header">
                                            Vehicle Status
                                        </div>
                                        <div class="card-body">
                                            <canvas id="vehicleStatusChart" width="400" height="200"></canvas>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Vehicles Tab -->
                        <div class="tab-pane fade" id="vehicles">
                            <h2 class="mb-4">Vehicle Management</h2>
                            
                            <ul class="nav nav-tabs mb-3">
                                <li class="nav-item">
                                    <a class="nav-link active" data-bs-toggle="tab" href="#addVehicle">Add Vehicle</a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" data-bs-toggle="tab" href="#vehicleList">Vehicle List</a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" data-bs-toggle="tab" href="#vehicleHistory">Vehicle History</a>
                                </li>
                            </ul>
                            
                            <div class="tab-content">
                                <div class="tab-pane fade show active" id="addVehicle">
                                    <div class="card">
                                        <div class="card-header">
                                            Add New Vehicle
                                        </div>
                                        <div class="card-body">
                                            <form id="addVehicleForm">
                                                <div class="row">
                                                    <div class="col-md-6 mb-3">
                                                        <label for="vehicleName" class="form-label">Vehicle Name</label>
                                                        <input type="text" class="form-control" id="vehicleName" required>
                                                    </div>
                                                    <div class="col-md-6 mb-3">
                                                        <label for="vehicleOdometer" class="form-label">Odometer</label>
                                                        <input type="number" class="form-control" id="vehicleOdometer" required>
                                                    </div>
                                                </div>
                                                <div class="row">
                                                    <div class="col-md-6 mb-3">
                                                        <label for="vehicleVin" class="form-label">VIN #</label>
                                                        <input type="text" class="form-control" id="vehicleVin" required>
                                                    </div>
                                                    <div class="col-md-6 mb-3">
                                                        <label for="vehiclePlate" class="form-label">Plate Number</label>
                                                        <input type="text" class="form-control" id="vehiclePlate" required>
                                                    </div>
                                                </div>
                                                <div class="row">
                                                    <div class="col-md-6 mb-3">
                                                        <label for="vehicleColor" class="form-label">Color</label>
                                                        <input type="text" class="form-control" id="vehicleColor" required>
                                                    </div>
                                                    <div class="col-md-6 mb-3">
                                                        <label for="vehicleModel" class="form-label">Model</label>
                                                        <input type="text" class="form-control" id="vehicleModel" required>
                                                    </div>
                                                </div>
                                                <div class="row">
                                                    <div class="col-md-6 mb-3">
                                                        <label for="vehicleRentalPrice" class="form-label">Rental Price (per day)</label>
                                                        <div class="input-group">
                                                            <input type="number" class="form-control" id="vehicleRentalPrice" required>
                                                            <span class="input-group-text">AED</span>
                                                        </div>
                                                    </div>
                                                    <div class="col-md-6 mb-3">
                                                        <label for="vehicleImage" class="form-label">Vehicle Image</label>
                                                        <input type="file" class="form-control" id="vehicleImage" accept="image/*">
                                                    </div>
                                                </div>
                                                <button type="submit" class="btn btn-primary">Add Vehicle</button>
                                            </form>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="tab-pane fade" id="vehicleList">
                                    <div class="card">
                                        <div class="card-header d-flex justify-content-between align-items-center">
                                            <span>Vehicle List</span>
                                            <div class="input-group" style="width: 300px;">
                                                <input type="text" class="form-control" id="vehicleSearch" placeholder="Search vehicles...">
                                                <button class="btn btn-outline-secondary" type="button" id="vehicleSearchBtn">
                                                    <i class="fas fa-search"></i>
                                                </button>
                                            </div>
                                        </div>
                                        <div class="card-body">
                                            <div class="table-responsive">
                                                <table class="table table-hover">
                                                    <thead>
                                                        <tr>
                                                            <th>Image</th>
                                                            <th>Name</th>
                                                            <th>Model</th>
                                                            <th>Color</th>
                                                            <th>Plate #</th>
                                                            <th>Odometer</th>
                                                            <th>Rental Price</th>
                                                            <th>Status</th>
                                                            <th>Actions</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody id="vehicleTableBody">
                                                        <!-- Vehicle data will be populated here -->
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Vehicle Details Section -->
                                    <div class="card vehicle-details" id="vehicleDetailsCard">
                                        <div class="card-header d-flex justify-content-between align-items-center">
                                            <span>Vehicle Details</span>
                                            <button class="btn btn-sm btn-secondary" id="closeVehicleDetails">Close</button>
                                        </div>
                                        <div class="card-body" id="vehicleDetailsContent">
                                            <!-- Vehicle details will be populated here -->
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="tab-pane fade" id="vehicleHistory">
                                    <div class="card">
                                        <div class="card-header d-flex justify-content-between align-items-center">
                                            <span>Vehicle Rental History</span>
                                            <div class="input-group" style="width: 300px;">
                                                <input type="text" class="form-control" id="vehicleHistorySearch" placeholder="Search by vehicle name...">
                                                <button class="btn btn-outline-secondary" type="button" id="vehicleHistorySearchBtn">
                                                    <i class="fas fa-search"></i>
                                                </button>
                                            </div>
                                        </div>
                                        <div class="card-body">
                                            <div class="table-responsive">
                                                <table class="table table-hover">
                                                    <thead>
                                                        <tr>
                                                            <th>Vehicle</th>
                                                            <th>Customer</th>
                                                            <th>Rental Date</th>
                                                            <th>Return Date</th>
                                                            <th>Amount</th>
                                                            <th>Status</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody id="vehicleHistoryTableBody">
                                                        <!-- Vehicle history will be populated here -->
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Customers Tab -->
                        <div class="tab-pane fade" id="customers">
                            <h2 class="mb-4">Customer Management</h2>
                            
                            <ul class="nav nav-tabs mb-3">
                                <li class="nav-item">
                                    <a class="nav-link active" data-bs-toggle="tab" href="#addCustomer">Add Customer</a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" data-bs-toggle="tab" href="#customerList">Customer List</a>
                                </li>
                            </ul>
                            
                            <div class="tab-content">
                                <div class="tab-pane fade show active" id="addCustomer">
                                    <div class="card">
                                        <div class="card-header">
                                            Add New Customer
                                        </div>
                                        <div class="card-body">
                                            <form id="addCustomerForm">
                                                <div class="row">
                                                    <div class="col-md-6 mb-3">
                                                        <label for="customerFullName" class="form-label">Full Name</label>
                                                        <input type="text" class="form-control" id="customerFullName" required>
                                                    </div>
                                                    <div class="col-md-6 mb-3">
                                                        <label for="customerAge" class="form-label">Age</label>
                                                        <input type="number" class="form-control" id="customerAge" required>
                                                    </div>
                                                </div>
                                                <div class="row">
                                                    <div class="col-md-6 mb-3">
                                                        <label for="customerId" class="form-label">PS/ID</label>
                                                        <input type="text" class="form-control" id="customerId" required>
                                                    </div>
                                                    <div class="col-md-6 mb-3">
                                                        <label for="customerNationality" class="form-label">Nationality</label>
                                                        <input type="text" class="form-control" id="customerNationality" placeholder="Type country name..." required>
                                                        <div class="suggestion-list" id="nationalitySuggestions"></div>
                                                    </div>
                                                </div>
                                                <div class="row">
                                                    <div class="col-md-6 mb-3">
                                                        <label for="customerContact" class="form-label">Contact Number</label>
                                                        <input type="text" class="form-control" id="customerContact" required>
                                                    </div>
                                                    <div class="col-md-6 mb-3">
                                                        <label for="customerAddress" class="form-label">Address</label>
                                                        <input type="text" class="form-control" id="customerAddress" required>
                                                    </div>
                                                </div>
                                                <div class="mb-3">
                                                    <label for="guaranteeDoc" class="form-label">Guarantee / Document</label>
                                                    <input type="file" class="form-control" id="guaranteeDoc">
                                                </div>
                                                <button type="submit" class="btn btn-primary">Add Customer</button>
                                            </form>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="tab-pane fade" id="customerList">
                                    <div class="card">
                                        <div class="card-header d-flex justify-content-between align-items-center">
                                            <span>Customer List</span>
                                            <div class="input-group" style="width: 300px;">
                                                <input type="text" class="form-control" id="customerSearch" placeholder="Search customers...">
                                                <button class="btn btn-outline-secondary" type="button" id="customerSearchBtn">
                                                    <i class="fas fa-search"></i>
                                                </button>
                                            </div>
                                        </div>
                                        <div class="card-body">
                                            <div class="table-responsive">
                                                <table class="table table-hover">
                                                    <thead>
                                                        <tr>
                                                            <th>Full Name</th>
                                                            <th>Age</th>
                                                            <th>ID</th>
                                                            <th>Nationality</th>
                                                            <th>Contact</th>
                                                            <th>Total Debt</th>
                                                            <th>Actions</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody id="customerTableBody">
                                                        <!-- Customer data will be populated here -->
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Customer Details Section -->
                                    <div class="card customer-details" id="customerDetailsCard">
                                        <div class="card-header d-flex justify-content-between align-items-center">
                                            <span>Customer Details</span>
                                            <button class="btn btn-sm btn-secondary" id="closeCustomerDetails">Close</button>
                                        </div>
                                        <div class="card-body" id="customerDetailsContent">
                                            <!-- Customer details will be populated here -->
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Rentals Tab -->
                        <div class="tab-pane fade" id="rentals">
                            <h2 class="mb-4">Rental Management</h2>
                            
                            <div class="card">
                                <div class="card-header">
                                    Create New Rental
                                </div>
                                <div class="card-body">
                                    <form id="createRentalForm">
                                        <div class="row">
                                            <div class="col-md-6 mb-3">
                                                <label for="rentalCustomer" class="form-label">Customer</label>
                                                <input type="text" class="form-control" id="rentalCustomer" placeholder="Search customer...">
                                                <div class="suggestion-list" id="customerSuggestions"></div>
                                            </div>
                                            <div class="col-md-6 mb-3">
                                                <label for="rentalVehicle" class="form-label">Vehicle</label>
                                                <input type="text" class="form-control" id="rentalVehicle" placeholder="Search vehicle...">
                                                <div class="suggestion-list" id="vehicleSuggestions"></div>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-6 mb-3">
                                                <label for="rentalAmount" class="form-label">Rental Amount (per day)</label>
                                                <div class="input-group">
                                                    <input type="number" class="form-control" id="rentalAmount" required>
                                                    <span class="input-group-text">AED</span>
                                                </div>
                                            </div>
                                            <div class="col-md-6 mb-3">
                                                <label for="rentalDays" class="form-label">Rental Days</label>
                                                <input type="number" class="form-control" id="rentalDays" required>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-6 mb-3">
                                                <label for="rentalStartDate" class="form-label">Rental Start Date</label>
                                                <input type="date" class="form-control" id="rentalStartDate" required>
                                            </div>
                                            <div class="col-md-6 mb-3">
                                                <label for="rentalEndDate" class="form-label">Rental End Date</label>
                                                <input type="date" class="form-control" id="rentalEndDate" required>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-6 mb-3">
                                                <label for="invoiceCode" class="form-label">Invoice Code</label>
                                                <input type="text" class="form-control" id="invoiceCode">
                                            </div>
                                        </div>
                                        <button type="submit" class="btn btn-primary">Create Rental</button>
                                    </form>
                                </div>
                            </div>
                            
                            <div class="card mt-4">
                                <div class="card-header d-flex justify-content-between align-items-center">
                                    <span>Rental History</span>
                                    <div class="input-group" style="width: 300px;">
                                        <input type="text" class="form-control" id="rentalSearch" placeholder="Search by invoice code...">
                                        <button class="btn btn-outline-secondary" type="button" id="rentalSearchBtn">
                                            <i class="fas fa-search"></i>
                                        </button>
                                    </div>
                                </div>
                                <div class="card-body">
                                    <div class="table-responsive">
                                        <table class="table table-hover">
                                            <thead>
                                                <tr>
                                                    <th>Invoice Code</th>
                                                    <th>Customer</th>
                                                    <th>Vehicle</th>
                                                    <th>Start Date</th>
                                                    <th>End Date</th>
                                                    <th>Amount</th>
                                                    <th>Status</th>
                                                    <th>Actions</th>
                                                </tr>
                                            </thead>
                                            <tbody id="rentalTableBody">
                                                <!-- Rental data will be populated here -->
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Invoice for Printing -->
                            <div id="invoicePrint" class="print-only" style="display: none;">
                                <div class="invoice-logo">
                                    <img id="printLogo" src="" style="max-width: 200px; display: none;">
                                    <h3 id="printSystemName">Car Rental System</h3>
                                </div>
                                <div class="card">
                                    <div class="card-header text-center">
                                        <h3>Car Rental Invoice</h3>
                                    </div>
                                    <div class="card-body">
                                        <div class="row mb-3">
                                            <div class="col-6">
                                                <strong>Invoice Code:</strong> <span id="printInvoiceCode"></span>
                                            </div>
                                            <div class="col-6 text-end">
                                                <strong>Date:</strong> <span id="printInvoiceDate"></span>
                                            </div>
                                        </div>
                                        <div class="row mb-3">
                                            <div class="col-6">
                                                <strong>Customer:</strong> <span id="printCustomerName"></span>
                                            </div>
                                            <div class="col-6">
                                                <strong>Vehicle:</strong> <span id="printVehicleName"></span>
                                            </div>
                                        </div>
                                        <div class="row mb-3">
                                            <div class="col-6">
                                                <strong>Customer ID:</strong> <span id="printCustomerId"></span>
                                            </div>
                                            <div class="col-6">
                                                <strong>Customer Address:</strong> <span id="printCustomerAddress"></span>
                                            </div>
                                        </div>
                                        <div class="row mb-3">
                                            <div class="col-12">
                                                <strong>Rental Amount (per day):</strong> <span id="printRentalAmount"></span>
                                            </div>
                                        </div>
                                        <div class="row mb-3">
                                            <div class="col-12">
                                                <strong>Rental Days:</strong> <span id="printRentalDays"></span>
                                            </div>
                                        </div>
                                        <div class="row mb-3">
                                            <div class="col-12">
                                                <strong>Rental History:</strong>
                                                <div id="printRentalHistory"></div>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-12">
                                                <hr>
                                                <h4 class="text-end">Total: <span id="printTotalAmount"></span></h4>
                                            </div>
                                        </div>
                                        <div class="row signature-area">
                                            <div class="col-6">
                                                <strong>Customer Signature:</strong>
                                                <div style="height: 50px; border-bottom: 1px solid #000;"></div>
                                            </div>
                                            <div class="col-6 text-end">
                                                <strong>Company Signature:</strong>
                                                <div style="height: 50px; border-bottom: 1px solid #000;"></div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Vehicle Returns Tab -->
                        <div class="tab-pane fade" id="returns">
                            <h2 class="mb-4">Vehicle Returns</h2>
                            
                            <div class="card">
                                <div class="card-header">
                                    Return Vehicle
                                </div>
                                <div class="card-body">
                                    <div class="row mb-3">
                                        <div class="col-md-6">
                                            <label for="returnInvoiceSearch" class="form-label">Search by Invoice Code</label>
                                            <input type="text" class="form-control" id="returnInvoiceSearch" placeholder="Search invoice code...">
                                            <div class="suggestion-list" id="returnInvoiceSuggestions"></div>
                                        </div>
                                        <div class="col-md-6 d-flex align-items-end">
                                            <button class="btn btn-primary me-2" id="searchInvoiceBtn">Search</button>
                                        </div>
                                    </div>
                                    <div id="returnFormContainer" style="display: none;">
                                        <form id="returnVehicleForm">
                                            <div class="row mb-3">
                                                <div class="col-md-6">
                                                    <label class="form-label">Customer</label>
                                                    <input type="text" class="form-control" id="returnCustomer" readonly>
                                                </div>
                                                <div class="col-md-6">
                                                    <label class="form-label">Vehicle</label>
                                                    <input type="text" class="form-control" id="returnVehicle" readonly>
                                                </div>
                                            </div>
                                            <div class="row mb-3">
                                                <div class="col-md-6">
                                                    <label class="form-label">Rental Start Date</label>
                                                    <input type="text" class="form-control" id="returnRentalStartDate" readonly>
                                                </div>
                                                <div class="col-md-6">
                                                    <label class="form-label">Expected Return Date</label>
                                                    <input type="text" class="form-control" id="returnExpectedDate" readonly>
                                                </div>
                                            </div>
                                            <div class="row mb-3">
                                                <div class="col-md-6">
                                                    <label for="returnActualDate" class="form-label">Actual Return Date</label>
                                                    <input type="date" class="form-control" id="returnActualDate" required>
                                                </div>
                                                <div class="col-md-6">
                                                    <label for="returnOdometer" class="form-label">Odometer at Return</label>
                                                    <input type="number" class="form-control" id="returnOdometer" required>
                                                </div>
                                            </div>
                                            <div class="row mb-3">
                                                <div class="col-md-6">
                                                    <label for="returnFuelLevel" class="form-label">Fuel Level</label>
                                                    <select class="form-select" id="returnFuelLevel" required>
                                                        <option value="">Select fuel level</option>
                                                        <option value="Full">Full</option>
                                                        <option value="3/4">3/4</option>
                                                        <option value="1/2">1/2</option>
                                                        <option value="1/4">1/4</option>
                                                        <option value="Empty">Empty</option>
                                                    </select>
                                                </div>
                                                <div class="col-md-6">
                                                    <label for="returnCondition" class="form-label">Vehicle Condition</label>
                                                    <select class="form-select" id="returnCondition" required>
                                                        <option value="">Select condition</option>
                                                        <option value="Excellent">Excellent</option>
                                                        <option value="Good">Good</option>
                                                        <option value="Fair">Fair</option>
                                                        <option value="Poor">Poor</option>
                                                        <option value="Damaged">Damaged</option>
                                                    </select>
                                                </div>
                                            </div>
                                            <div class="row mb-3">
                                                <div class="col-md-12">
                                                    <label for="returnNotes" class="form-label">Notes</label>
                                                    <textarea class="form-control" id="returnNotes" rows="3"></textarea>
                                                </div>
                                            </div>
                                            <button type="submit" class="btn btn-success">Complete Return</button>
                                        </form>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="card mt-4">
                                <div class="card-header d-flex justify-content-between align-items-center">
                                    <span>Return History</span>
                                    <div class="input-group" style="width: 300px;">
                                        <input type="text" class="form-control" id="returnHistorySearch" placeholder="Search by invoice code...">
                                        <button class="btn btn-outline-secondary" type="button" id="returnHistorySearchBtn">
                                            <i class="fas fa-search"></i>
                                        </button>
                                    </div>
                                </div>
                                <div class="card-body">
                                    <div class="table-responsive">
                                        <table class="table table-hover">
                                            <thead>
                                                <tr>
                                                    <th>Invoice Code</th>
                                                    <th>Customer</th>
                                                    <th>Vehicle</th>
                                                    <th>Return Date</th>
                                                    <th>Fuel Level</th>
                                                    <th>Condition</th>
                                                    <th>Actions</th>
                                                </tr>
                                            </thead>
                                            <tbody id="returnHistoryTableBody">
                                                <!-- Return history will be populated here -->
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Vehicle Maintenance Tab -->
                        <div class="tab-pane fade" id="maintenance">
                            <h2 class="mb-4">Vehicle Maintenance</h2>
                            
                            <div class="card">
                                <div class="card-header">
                                    Schedule Maintenance
                                </div>
                                <div class="card-body">
                                    <form id="scheduleMaintenanceForm">
                                        <div class="row">
                                            <div class="col-md-6 mb-3">
                                                <label for="maintenanceVehicle" class="form-label">Vehicle</label>
                                                <input type="text" class="form-control" id="maintenanceVehicle" placeholder="Search vehicle...">
                                                <div class="suggestion-list" id="maintenanceVehicleSuggestions"></div>
                                            </div>
                                            <div class="col-md-6 mb-3">
                                                <label for="maintenanceType" class="form-label">Maintenance Type</label>
                                                <select class="form-select" id="maintenanceType" required>
                                                    <option value="">Select type</option>
                                                    <option value="Oil Change">Oil Change</option>
                                                    <option value="Tire Rotation">Tire Rotation</option>
                                                    <option value="Brake Service">Brake Service</option>
                                                    <option value="Engine Tune-up">Engine Tune-up</option>
                                                    <option value="Other">Other</option>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-6 mb-3">
                                                <label for="maintenanceDate" class="form-label">Maintenance Date</label>
                                                <input type="date" class="form-control" id="maintenanceDate" required>
                                            </div>
                                            <div class="col-md-6 mb-3">
                                                <label for="maintenanceCost" class="form-label">Cost</label>
                                                <div class="input-group">
                                                    <input type="number" class="form-control" id="maintenanceCost" required>
                                                    <span class="input-group-text">AED</span>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-12 mb-3">
                                                <label for="maintenanceDescription" class="form-label">Description</label>
                                                <textarea class="form-control" id="maintenanceDescription" rows="3"></textarea>
                                            </div>
                                        </div>
                                        <button type="submit" class="btn btn-primary">Schedule Maintenance</button>
                                    </form>
                                </div>
                            </div>
                            
                            <div class="card mt-4">
                                <div class="card-header d-flex justify-content-between align-items-center">
                                    <span>Maintenance History</span>
                                    <div class="input-group" style="width: 300px;">
                                        <input type="text" class="form-control" id="maintenanceSearch" placeholder="Search by vehicle...">
                                        <button class="btn btn-outline-secondary" type="button" id="maintenanceSearchBtn">
                                            <i class="fas fa-search"></i>
                                        </button>
                                    </div>
                                </div>
                                <div class="card-body">
                                    <div class="table-responsive">
                                        <table class="table table-hover">
                                            <thead>
                                                <tr>
                                                    <th>Vehicle</th>
                                                    <th>Type</th>
                                                    <th>Date</th>
                                                    <th>Cost</th>
                                                    <th>Status</th>
                                                    <th>Actions</th>
                                                </tr>
                                            </thead>
                                            <tbody id="maintenanceTableBody">
                                                <!-- Maintenance history will be populated here -->
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Payments Tab -->
                        <div class="tab-pane fade" id="payments">
                            <h2 class="mb-4">Payment Management</h2>
                            
                            <div class="card">
                                <div class="card-header">
                                    Record Payment
                                </div>
                                <div class="card-body">
                                    <form id="recordPaymentForm">
                                        <div class="row">
                                            <div class="col-md-6 mb-3">
                                                <label for="paymentInvoice" class="form-label">Invoice Code</label>
                                                <input type="text" class="form-control" id="paymentInvoice" placeholder="Search invoice code...">
                                                <div class="suggestion-list" id="paymentInvoiceSuggestions"></div>
                                            </div>
                                            <div class="col-md-6 mb-3">
                                                <label for="paymentAmount" class="form-label">Amount</label>
                                                <div class="input-group">
                                                    <input type="number" class="form-control" id="paymentAmount" required>
                                                    <span class="input-group-text">AED</span>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-6 mb-3">
                                                <label for="paymentDate" class="form-label">Payment Date</label>
                                                <input type="date" class="form-control" id="paymentDate" required>
                                            </div>
                                            <div class="col-md-6 mb-3">
                                                <label for="paymentMethod" class="form-label">Payment Method</label>
                                                <select class="form-select" id="paymentMethod" required>
                                                    <option value="">Select method</option>
                                                    <option value="Cash">Cash</option>
                                                    <option value="Credit Card">Credit Card</option>
                                                    <option value="Bank Transfer">Bank Transfer</option>
                                                    <option value="Other">Other</option>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-12 mb-3">
                                                <label for="paymentNotes" class="form-label">Notes</label>
                                                <textarea class="form-control" id="paymentNotes" rows="3"></textarea>
                                            </div>
                                        </div>
                                        <button type="submit" class="btn btn-primary">Record Payment</button>
                                    </form>
                                </div>
                            </div>
                            
                            <div class="card mt-4">
                                <div class="card-header d-flex justify-content-between align-items-center">
                                    <span>Payment History</span>
                                    <div class="input-group" style="width: 300px;">
                                        <input type="text" class="form-control" id="paymentSearch" placeholder="Search by invoice code...">
                                        <button class="btn btn-outline-secondary" type="button" id="paymentSearchBtn">
                                            <i class="fas fa-search"></i>
                                        </button>
                                    </div>
                                </div>
                                <div class="card-body">
                                    <div class="table-responsive">
                                        <table class="table table-hover">
                                            <thead>
                                                <tr>
                                                    <th>Invoice Code</th>
                                                    <th>Customer</th>
                                                    <th>Amount</th>
                                                    <th>Date</th>
                                                    <th>Method</th>
                                                    <th>Actions</th>
                                                </tr>
                                            </thead>
                                            <tbody id="paymentTableBody">
                                                <!-- Payment history will be populated here -->
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Fines & Taxes Tab -->
                        <div class="tab-pane fade" id="fines">
                            <h2 class="mb-4">Fines & Taxes</h2>
                            
                            <div class="card">
                                <div class="card-header">
                                    Add Fine or Tax
                                </div>
                                <div class="card-body">
                                    <form id="addFineForm">
                                        <div class="row">
                                            <div class="col-md-6 mb-3">
                                                <label for="fineInvoice" class="form-label">Invoice Code</label>
                                                <input type="text" class="form-control" id="fineInvoice" placeholder="Search invoice code...">
                                                <div class="suggestion-list" id="fineInvoiceSuggestions"></div>
                                            </div>
                                            <div class="col-md-6 mb-3">
                                                <label for="fineType" class="form-label">Type</label>
                                                <select class="form-select" id="fineType" required>
                                                    <option value="">Select type</option>
                                                    <option value="Late Return">Late Return</option>
                                                    <option value="Traffic Fine">Traffic Fine</option>
                                                    <option value="Damage Fee">Damage Fee</option>
                                                    <option value="Cleaning Fee">Cleaning Fee</option>
                                                    <option value="Other">Other</option>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-6 mb-3">
                                                <label for="fineAmount" class="form-label">Amount</label>
                                                <div class="input-group">
                                                    <input type="number" class="form-control" id="fineAmount" required>
                                                    <span class="input-group-text">AED</span>
                                                </div>
                                            </div>
                                            <div class="col-md-6 mb-3">
                                                <label for="fineDate" class="form-label">Date</label>
                                                <input type="date" class="form-control" id="fineDate" required>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-12 mb-3">
                                                <label for="fineDescription" class="form-label">Description</label>
                                                <textarea class="form-control" id="fineDescription" rows="3"></textarea>
                                            </div>
                                        </div>
                                        <button type="submit" class="btn btn-primary">Add Fine</button>
                                    </form>
                                </div>
                            </div>
                            
                            <div class="card mt-4">
                                <div class="card-header d-flex justify-content-between align-items-center">
                                    <span>Fines & Taxes History</span>
                                    <div class="input-group" style="width: 300px;">
                                        <input type="text" class="form-control" id="fineSearch" placeholder="Search by invoice code...">
                                        <button class="btn btn-outline-secondary" type="button" id="fineSearchBtn">
                                            <i class="fas fa-search"></i>
                                        </button>
                                    </div>
                                </div>
                                <div class="card-body">
                                    <div class="table-responsive">
                                        <table class="table table-hover">
                                            <thead>
                                                <tr>
                                                    <th>Invoice Code</th>
                                                    <th>Customer</th>
                                                    <th>Type</th>
                                                    <th>Amount</th>
                                                    <th>Date</th>
                                                    <th>Status</th>
                                                    <th>Actions</th>
                                                </tr>
                                            </thead>
                                            <tbody id="fineTableBody">
                                                <!-- Fines history will be populated here -->
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Reports Tab -->
                        <div class="tab-pane fade" id="reports">
                            <h2 class="mb-4">Reports</h2>
                            
                            <div class="card">
                                <div class="card-header">
                                    Generate Report
                                </div>
                                <div class="card-body">
                                    <form id="reportForm">
                                        <div class="row">
                                            <div class="col-md-4 mb-3">
                                                <label for="reportType" class="form-label">Report Type</label>
                                                <select class="form-select" id="reportType" required>
                                                    <option value="">Select report type</option>
                                                    <option value="rental">Rental Report</option>
                                                    <option value="revenue">Revenue Report</option>
                                                    <option value="vehicle">Vehicle Utilization</option>
                                                    <option value="customer">Customer Activity</option>
                                                </select>
                                            </div>
                                            <div class="col-md-4 mb-3">
                                                <label for="reportStartDate" class="form-label">Start Date</label>
                                                <input type="date" class="form-control" id="reportStartDate" required>
                                            </div>
                                            <div class="col-md-4 mb-3">
                                                <label for="reportEndDate" class="form-label">End Date</label>
                                                <input type="date" class="form-control" id="reportEndDate" required>
                                            </div>
                                        </div>
                                        <button type="submit" class="btn btn-primary">Generate Report</button>
                                    </form>
                                </div>
                            </div>
                            
                            <div class="card mt-4">
                                <div class="card-header">
                                    Report Results
                                </div>
                                <div class="card-body">
                                    <div id="reportResults">
                                        <!-- Report results will be displayed here -->
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- F.RETU.RENT Tab -->
                        <div class="tab-pane fade" id="frr">
                            <h2 class="mb-4">F.RETU.RENT - Form Return Rental</h2>
                            
                            <div class="card">
                                <div class="card-header">
                                    F.RETU.RENT Form
                                </div>
                                <div class="card-body">
                                    <form id="frrForm">
                                        <div class="row mb-3">
                                            <div class="col-md-6">
                                                <label for="frrInvoiceSearch" class="form-label">Search by Invoice Code</label>
                                                <input type="text" class="form-control" id="frrInvoiceSearch" placeholder="Search invoice code...">
                                                <div class="suggestion-list" id="frrInvoiceSuggestions"></div>
                                            </div>
                                            <div class="col-md-6 d-flex align-items-end">
                                                <button class="btn btn-primary me-2" id="frrSearchBtn">Search</button>
                                            </div>
                                        </div>
                                        <div id="frrFormContainer" style="display: none;">
                                            <div class="row mb-3">
                                                <div class="col-md-6">
                                                    <label class="form-label">Customer</label>
                                                    <input type="text" class="form-control" id="frrCustomer" readonly>
                                                </div>
                                                <div class="col-md-6">
                                                    <label class="form-label">Vehicle</label>
                                                    <input type="text" class="form-control" id="frrVehicle" readonly>
                                                </div>
                                            </div>
                                            <div class="row mb-3">
                                                <div class="col-md-6">
                                                    <label class="form-label">Rental Start Date</label>
                                                    <input type="text" class="form-control" id="frrRentalStartDate" readonly>
                                                </div>
                                                <div class="col-md-6">
                                                    <label class="form-label">Expected Return Date</label>
                                                    <input type="text" class="form-control" id="frrExpectedDate" readonly>
                                                </div>
                                            </div>
                                            <div class="row mb-3">
                                                <div class="col-md-6">
                                                    <label for="frrActualDate" class="form-label">Actual Return Date</label>
                                                    <input type="date" class="form-control" id="frrActualDate" required>
                                                </div>
                                                <div class="col-md-6">
                                                    <label for="frrOdometer" class="form-label">Odometer at Return</label>
                                                    <input type="number" class="form-control" id="frrOdometer" required>
                                                </div>
                                            </div>
                                            <div class="row mb-3">
                                                <div class="col-md-6">
                                                    <label for="frrFuelLevel" class="form-label">Fuel Level</label>
                                                    <select class="form-select" id="frrFuelLevel" required>
                                                        <option value="">Select fuel level</option>
                                                        <option value="Full">Full</option>
                                                        <option value="3/4">3/4</option>
                                                        <option value="1/2">1/2</option>
                                                        <option value="1/4">1/4</option>
                                                        <option value="Empty">Empty</option>
                                                    </select>
                                                </div>
                                                <div class="col-md-6">
                                                    <label for="frrCondition" class="form-label">Vehicle Condition</label>
                                                    <select class="form-select" id="frrCondition" required>
                                                        <option value="">Select condition</option>
                                                        <option value="Excellent">Excellent</option>
                                                        <option value="Good">Good</option>
                                                        <option value="Fair">Fair</option>
                                                        <option value="Poor">Poor</option>
                                                        <option value="Damaged">Damaged</option>
                                                    </select>
                                                </div>
                                            </div>
                                            <div class="row mb-3">
                                                <div class="col-md-12">
                                                    <label for="frrNotes" class="form-label">Notes</label>
                                                    <textarea class="form-control" id="frrNotes" rows="3"></textarea>
                                                </div>
                                            </div>
                                            <button type="submit" class="btn btn-success">Complete F.RETU.RENT</button>
                                        </div>
                                    </form>
                                </div>
                            </div>
                            
                            <div class="card mt-4">
                                <div class="card-header d-flex justify-content-between align-items-center">
                                    <span>F.RETU.RENT History</span>
                                    <div class="input-group" style="width: 300px;">
                                        <input type="text" class="form-control" id="frrHistorySearch" placeholder="Search by invoice code...">
                                        <button class="btn btn-outline-secondary" type="button" id="frrHistorySearchBtn">
                                            <i class="fas fa-search"></i>
                                        </button>
                                    </div>
                                </div>
                                <div class="card-body">
                                    <div class="table-responsive">
                                        <table class="table table-hover">
                                            <thead>
                                                <tr>
                                                    <th>Invoice Code</th>
                                                    <th>Customer</th>
                                                    <th>Vehicle</th>
                                                    <th>Return Date</th>
                                                    <th>Fuel Level</th>
                                                    <th>Condition</th>
                                                    <th>Actions</th>
                                                </tr>
                                            </thead>
                                            <tbody id="frrHistoryTableBody">
                                                <!-- F.RETU.RENT history will be populated here -->
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- System Settings Tab -->
                        <div class="tab-pane fade" id="settings">
                            <h2 class="mb-4">System Settings</h2>
                            
                            <div class="card">
                                <div class="card-header">
                                    General Settings
                                </div>
                                <div class="card-body">
                                    <form id="generalSettingsForm">
                                        <div class="row mb-3">
                                            <div class="col-md-6">
                                                <label for="systemName" class="form-label">System Name</label>
                                                <input type="text" class="form-control" id="systemName" value="Car Rental System">
                                            </div>
                                            <div class="col-md-6">
                                                <label for="systemLogo" class="form-label">System Logo</label>
                                                <input type="file" class="form-control" id="systemLogo" accept="image/*">
                                            </div>
                                        </div>
                                        <div class="row mb-3">
                                            <div class="col-md-6">
                                                <label for="currency" class="form-label">Currency</label>
                                                <select class="form-select" id="currency">
                                                    <option value="AED" selected>AED - UAE Dirham</option>
                                                    <option value="USD">USD - US Dollar</option>
                                                    <option value="EUR">EUR - Euro</option>
                                                    <option value="SAR">SAR - Saudi Riyal</option>
                                                </select>
                                            </div>
                                            <div class="col-md-6">
                                                <label for="dateFormat" class="form-label">Date Format</label>
                                                <select class="form-select" id="dateFormat">
                                                    <option value="YYYY-MM-DD" selected>YYYY-MM-DD</option>
                                                    <option value="DD/MM/YYYY">DD/MM/YYYY</option>
                                                    <option value="MM/DD/YYYY">MM/DD/YYYY</option>
                                                </select>
                                            </div>
                                        </div>
                                        <button type="submit" class="btn btn-primary">Save Settings</button>
                                    </form>
                                </div>
                            </div>
                            
                            <!-- Backup Section -->
                            <div class="card mt-4">
                                <div class="card-header">
                                    Backup & Restore
                                </div>
                                <div class="card-body">
                                    <div class="row mb-3">
                                        <div class="col-md-6">
                                            <button class="btn btn-success w-100" id="backupBtn">
                                                <i class="fas fa-download"></i> Create Backup
                                            </button>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="input-group">
                                                <input type="file" class="form-control" id="restoreFile" accept=".json">
                                                <button class="btn btn-warning" type="button" id="restoreBtn">
                                                    <i class="fas fa-upload"></i> Restore
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- User Roles Section -->
                            <div class="card mt-4">
                                <div class="card-header">
                                    User Roles & Permissions
                                </div>
                                <div class="card-body">
                                    <div class="mb-3">
                                        <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#userManagementModal">
                                            <i class="fas fa-users"></i> Manage Users & Roles
                                        </button>
                                    </div>
                                    <div class="table-responsive">
                                        <table class="table table-hover">
                                            <thead>
                                                <tr>
                                                    <th>Role</th>
                                                    <th>Permissions</th>
                                                    <th>Users</th>
                                                </tr>
                                            </thead>
                                            <tbody id="rolesTableBody">
                                                <!-- Roles data will be populated here -->
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modals -->
    <!-- Change Password Modal -->
    <div class="modal fade" id="changePasswordModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Change Password</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="changePasswordForm">
                        <div class="mb-3">
                            <label for="currentPassword" class="form-label">Current Password</label>
                            <input type="password" class="form-control" id="currentPassword" required>
                        </div>
                        <div class="mb-3">
                            <label for="newPassword" class="form-label">New Password</label>
                            <input type="password" class="form-control" id="newPassword" required>
                        </div>
                        <div class="mb-3">
                            <label for="confirmPassword" class="form-label">Confirm New Password</label>
                            <input type="password" class="form-control" id="confirmPassword" required>
                        </div>
                        <button type="submit" class="btn btn-primary">Change Password</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- User Management Modal -->
    <div class="modal fade" id="userManagementModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">User Management</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <ul class="nav nav-tabs mb-3">
                        <li class="nav-item">
                            <a class="nav-link active" data-bs-toggle="tab" href="#usersTab">Users</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" data-bs-toggle="tab" href="#rolesTab">Roles</a>
                        </li>
                    </ul>
                    
                    <div class="tab-content">
                        <div class="tab-pane fade show active" id="usersTab">
                            <div class="mb-3">
                                <button class="btn btn-primary" id="addUserBtn">
                                    <i class="fas fa-plus"></i> Add User
                                </button>
                            </div>
                            <div class="table-responsive">
                                <table class="table table-hover">
                                    <thead>
                                        <tr>
                                            <th>Username</th>
                                            <th>Full Name</th>
                                            <th>Role</th>
                                            <th>Status</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="usersTableBody">
                                        <!-- Users data will be populated here -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        
                        <div class="tab-pane fade" id="rolesTab">
                            <div class="mb-3">
                                <button class="btn btn-primary" id="addRoleBtn">
                                    <i class="fas fa-plus"></i> Add Role
                                </button>
                            </div>
                            <div class="table-responsive">
                                <table class="table table-hover">
                                    <thead>
                                        <tr>
                                            <th>Role Name</th>
                                            <th>Permissions</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="rolesManagementTableBody">
                                        <!-- Roles management data will be populated here -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Add User Modal -->
    <div class="modal fade" id="addUserModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Add User</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="addUserForm">
                        <div class="mb-3">
                            <label for="newUsername" class="form-label">Username</label>
                            <input type="text" class="form-control" id="newUsername" required>
                        </div>
                        <div class="mb-3">
                            <label for="newUserFullName" class="form-label">Full Name</label>
                            <input type="text" class="form-control" id="newUserFullName" required>
                        </div>
                        <div class="mb-3">
                            <label for="newUserPassword" class="form-label">Password</label>
                            <input type="password" class="form-control" id="newUserPassword" required>
                        </div>
                        <div class="mb-3">
                            <label for="newUserRole" class="form-label">Role</label>
                            <select class="form-select" id="newUserRole" required>
                                <option value="">Select role</option>
                                <!-- Roles will be populated here -->
                            </select>
                        </div>
                        <button type="submit" class="btn btn-primary">Add User</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Role Modal -->
    <div class="modal fade" id="addRoleModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Add Role</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="addRoleForm">
                        <div class="mb-3">
                            <label for="newRoleName" class="form-label">Role Name</label>
                            <input type="text" class="form-control" id="newRoleName" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Permissions</label>
                            <div id="permissionsList">
                                <!-- Permissions will be populated here -->
                            </div>
                        </div>
                        <button type="submit" class="btn btn-primary">Add Role</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        // System Data
        let systemData = {
            users: [
                { username: "admin", password: "000000", fullName: "System Administrator", role: "admin", active: true }
            ],
            roles: [
                { name: "admin", permissions: ["all"] },
                { name: "manager", permissions: ["dashboard", "vehicles", "customers", "rentals", "returns", "maintenance", "payments", "fines", "reports", "frr"] },
                { name: "user", permissions: ["dashboard", "vehicles", "customers", "rentals", "returns", "frr"] }
            ],
            vehicles: [],
            customers: [],
            rentals: [],
            returns: [],
            maintenance: [],
            payments: [],
            fines: [],
            settings: {
                systemName: "Car Rental System",
                currency: "AED",
                dateFormat: "YYYY-MM-DD"
            },
            backups: []
        };

        // Current User
        let currentUser = null;

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            // Load data from localStorage
            loadData();
            
            // Check if user is logged in
            checkLoginStatus();
            
            // Initialize event listeners
            initializeEventListeners();
            
            // Initialize charts
            initializeCharts();
        });

        // Load data from localStorage
        function loadData() {
            const savedData = localStorage.getItem('carRentalSystem');
            if (savedData) {
                systemData = JSON.parse(savedData);
            }
        }

        // Save data to localStorage
        function saveData() {
            localStorage.setItem('carRentalSystem', JSON.stringify(systemData));
        }

        // Check login status
        function checkLoginStatus() {
            const loggedInUser = sessionStorage.getItem('loggedInUser');
            if (loggedInUser) {
                currentUser = JSON.parse(loggedInUser);
                showMainApp();
            } else {
                showLoginScreen();
            }
        }

        // Show login screen
        function showLoginScreen() {
            document.getElementById('loginScreen').style.display = 'block';
            document.getElementById('mainApp').style.display = 'none';
        }

        // Show main application
        function showMainApp() {
            document.getElementById('loginScreen').style.display = 'none';
            document.getElementById('mainApp').style.display = 'block';
            
            // Update UI based on user role
            updateUIForUserRole();
            
            // Load dashboard data
            loadDashboardData();
        }

        // Update UI based on user role
        function updateUIForUserRole() {
            const isAdmin = currentUser.role === 'admin';
            const isManager = currentUser.role === 'manager' || isAdmin;
            
            // Show/hide admin-only elements
            document.querySelectorAll('.admin-only').forEach(el => {
                el.style.display = isAdmin ? 'block' : 'none';
            });
            
            // Show/hide manager-only elements
            document.querySelectorAll('.manager-only').forEach(el => {
                el.style.display = isManager ? 'block' : 'none';
            });
            
            // Update current user display
            document.getElementById('currentUser').textContent = currentUser.fullName;
            
            // Update permissions for sidebar items
            updateSidebarPermissions();
        }

        // Update sidebar permissions based on user role
        function updateSidebarPermissions() {
            const userPermissions = getCurrentUserPermissions();
            
            document.querySelectorAll('.sidebar .nav-link').forEach(link => {
                const tabId = link.getAttribute('href').substring(1);
                if (tabId !== 'dashboard' && !userPermissions.includes(tabId) && !userPermissions.includes('all')) {
                    link.parentElement.style.display = 'none';
                }
            });
        }

        // Get current user permissions
        function getCurrentUserPermissions() {
            const userRole = systemData.roles.find(role => role.name === currentUser.role);
            return userRole ? userRole.permissions : [];
        }

        // Initialize event listeners
        function initializeEventListeners() {
            // Login form
            document.getElementById('loginForm').addEventListener('submit', handleLogin);
            
            // Logout button
            document.getElementById('logoutBtn').addEventListener('click', handleLogout);
            
            // Tab switching
            document.querySelectorAll('a[data-bs-toggle="tab"]').forEach(tab => {
                tab.addEventListener('shown.bs.tab', handleTabChange);
            });
            
            // Form submissions
            document.getElementById('addVehicleForm').addEventListener('submit', handleAddVehicle);
            document.getElementById('addCustomerForm').addEventListener('submit', handleAddCustomer);
            document.getElementById('createRentalForm').addEventListener('submit', handleCreateRental);
            document.getElementById('returnVehicleForm').addEventListener('submit', handleReturnVehicle);
            document.getElementById('scheduleMaintenanceForm').addEventListener('submit', handleScheduleMaintenance);
            document.getElementById('recordPaymentForm').addEventListener('submit', handleRecordPayment);
            document.getElementById('addFineForm').addEventListener('submit', handleAddFine);
            document.getElementById('frrForm').addEventListener('submit', handleFrrForm);
            document.getElementById('reportForm').addEventListener('submit', handleGenerateReport);
            document.getElementById('generalSettingsForm').addEventListener('submit', handleSaveSettings);
            document.getElementById('changePasswordForm').addEventListener('submit', handleChangePassword);
            document.getElementById('addUserForm').addEventListener('submit', handleAddUser);
            document.getElementById('addRoleForm').addEventListener('submit', handleAddRole);
            
            // Search functionality
            document.getElementById('vehicleSearchBtn').addEventListener('click', handleVehicleSearch);
            document.getElementById('customerSearchBtn').addEventListener('click', handleCustomerSearch);
            document.getElementById('rentalSearchBtn').addEventListener('click', handleRentalSearch);
            document.getElementById('returnHistorySearchBtn').addEventListener('click', handleReturnHistorySearch);
            document.getElementById('maintenanceSearchBtn').addEventListener('click', handleMaintenanceSearch);
            document.getElementById('paymentSearchBtn').addEventListener('click', handlePaymentSearch);
            document.getElementById('fineSearchBtn').addEventListener('click', handleFineSearch);
            document.getElementById('frrHistorySearchBtn').addEventListener('click', handleFrrHistorySearch);
            
            // Backup and restore
            document.getElementById('backupBtn').addEventListener('click', handleBackup);
            document.getElementById('restoreBtn').addEventListener('click', handleRestore);
            
            // User management
            document.getElementById('addUserBtn').addEventListener('click', showAddUserModal);
            document.getElementById('addRoleBtn').addEventListener('click', showAddRoleModal);
            
            // Close details buttons
            document.getElementById('closeVehicleDetails').addEventListener('click', closeVehicleDetails);
            document.getElementById('closeCustomerDetails').addEventListener('click', closeCustomerDetails);
            
            // Search invoice for returns
            document.getElementById('searchInvoiceBtn').addEventListener('click', searchInvoiceForReturn);
            document.getElementById('frrSearchBtn').addEventListener('click', searchInvoiceForFrr);
            
            // Auto-suggest functionality
            initializeAutoSuggest();
        }

        // Handle login
        function handleLogin(e) {
            e.preventDefault();
            
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            
            const user = systemData.users.find(u => u.username === username && u.password === password && u.active);
            
            if (user) {
                currentUser = user;
                sessionStorage.setItem('loggedInUser', JSON.stringify(user));
                showMainApp();
            } else {
                alert('Invalid username or password');
            }
        }

        // Handle logout
        function handleLogout() {
            currentUser = null;
            sessionStorage.removeItem('loggedInUser');
            showLoginScreen();
        }

        // Handle tab change
        function handleTabChange(e) {
            const tabId = e.target.getAttribute('href').substring(1);
            
            switch(tabId) {
                case 'dashboard':
                    loadDashboardData();
                    break;
                case 'vehicles':
                    loadVehicleData();
                    break;
                case 'customers':
                    loadCustomerData();
                    break;
                case 'rentals':
                    loadRentalData();
                    break;
                case 'returns':
                    loadReturnData();
                    break;
                case 'maintenance':
                    loadMaintenanceData();
                    break;
                case 'payments':
                    loadPaymentData();
                    break;
                case 'fines':
                    loadFineData();
                    break;
                case 'reports':
                    // Reports are generated on demand
                    break;
                case 'frr':
                    loadFrrData();
                    break;
                case 'settings':
                    loadSettingsData();
                    break;
            }
        }

        // Load dashboard data
        function loadDashboardData() {
            // Update statistics
            const totalVehicles = systemData.vehicles.length;
            const totalCustomers = systemData.customers.length;
            const activeRentals = systemData.rentals.filter(r => r.status === 'Active').length;
            const totalRevenue = systemData.payments.reduce((sum, payment) => sum + payment.amount, 0);
            
            document.getElementById('dashboardStats').innerHTML = `
                <div class="col-md-3">
                    <div class="card dashboard-card bg-primary text-white">
                        <div class="card-body">
                            <div class="d-flex justify-content-between">
                                <div>
                                    <h4>${totalVehicles}</h4>
                                    <p>Total Vehicles</p>
                                </div>
                                <div class="align-self-center">
                                    <i class="fas fa-car fa-2x"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="card dashboard-card bg-success text-white">
                        <div class="card-body">
                            <div class="d-flex justify-content-between">
                                <div>
                                    <h4>${totalCustomers}</h4>
                                    <p>Total Customers</p>
                                </div>
                                <div class="align-self-center">
                                    <i class="fas fa-users fa-2x"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="card dashboard-card bg-warning text-white">
                        <div class="card-body">
                            <div class="d-flex justify-content-between">
                                <div>
                                    <h4>${activeRentals}</h4>
                                    <p>Active Rentals</p>
                                </div>
                                <div class="align-self-center">
                                    <i class="fas fa-receipt fa-2x"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="card dashboard-card bg-info text-white">
                        <div class="card-body">
                            <div class="d-flex justify-content-between">
                                <div>
                                    <h4>${totalRevenue} AED</h4>
                                    <p>Total Revenue</p>
                                </div>
                                <div class="align-self-center">
                                    <i class="fas fa-money-bill-wave fa-2x"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            // Load recent rentals
            const recentRentals = systemData.rentals.slice(-5).reverse();
            document.getElementById('recentRentalsTable').innerHTML = recentRentals.map(rental => `
                <tr>
                    <td>${rental.customerName}</td>
                    <td>${rental.vehicleName}</td>
                    <td>${rental.startDate}</td>
                    <td>${rental.totalAmount} AED</td>
                    <td><span class="badge ${rental.status === 'Active' ? 'bg-success' : 'bg-secondary'}">${rental.status}</span></td>
                </tr>
            `).join('');
            
            // Update vehicle status chart
            updateVehicleStatusChart();
        }

        // Update vehicle status chart
        function updateVehicleStatusChart() {
            const ctx = document.getElementById('vehicleStatusChart').getContext('2d');
            
            const available = systemData.vehicles.filter(v => v.status === 'Available').length;
            const rented = systemData.vehicles.filter(v => v.status === 'Rented').length;
            const maintenance = systemData.vehicles.filter(v => v.status === 'Maintenance').length;
            
            new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['Available', 'Rented', 'Maintenance'],
                    datasets: [{
                        data: [available, rented, maintenance],
                        backgroundColor: ['#28a745', '#ffc107', '#dc3545']
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });
        }

        // Handle add vehicle
        function handleAddVehicle(e) {
            e.preventDefault();
            
            const vehicle = {
                id: generateId(),
                name: document.getElementById('vehicleName').value,
                odometer: parseInt(document.getElementById('vehicleOdometer').value),
                vin: document.getElementById('vehicleVin').value,
                plate: document.getElementById('vehiclePlate').value,
                color: document.getElementById('vehicleColor').value,
                model: document.getElementById('vehicleModel').value,
                rentalPrice: parseFloat(document.getElementById('vehicleRentalPrice').value),
                status: 'Available',
                image: null,
                createdAt: new Date().toISOString()
            };
            
            // Handle image upload
            const imageInput = document.getElementById('vehicleImage');
            if (imageInput.files.length > 0) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    vehicle.image = e.target.result;
                    completeAddVehicle(vehicle);
                };
                reader.readAsDataURL(imageInput.files[0]);
            } else {
                completeAddVehicle(vehicle);
            }
        }

        // Complete adding vehicle
        function completeAddVehicle(vehicle) {
            systemData.vehicles.push(vehicle);
            saveData();
            
            alert('Vehicle added successfully!');
            document.getElementById('addVehicleForm').reset();
            
            // Switch to vehicle list tab
            document.querySelector('a[href="#vehicleList"]').click();
            loadVehicleData();
        }

        // Load vehicle data
        function loadVehicleData() {
            const vehicleTableBody = document.getElementById('vehicleTableBody');
            vehicleTableBody.innerHTML = systemData.vehicles.map(vehicle => `
                <tr>
                    <td>
                        ${vehicle.image ? `<img src="${vehicle.image}" class="vehicle-image" alt="${vehicle.name}">` : '<i class="fas fa-car text-muted"></i>'}
                    </td>
                    <td>${vehicle.name}</td>
                    <td>${vehicle.model}</td>
                    <td>${vehicle.color}</td>
                    <td>${vehicle.plate}</td>
                    <td>${vehicle.odometer}</td>
                    <td>${vehicle.rentalPrice} AED</td>
                    <td><span class="badge ${getStatusBadgeClass(vehicle.status)}">${vehicle.status}</span></td>
                    <td>
                        <button class="btn btn-sm btn-info view-vehicle" data-id="${vehicle.id}">View</button>
                        <button class="btn btn-sm btn-warning edit-vehicle" data-id="${vehicle.id}">Edit</button>
                        <button class="btn btn-sm btn-danger delete-vehicle" data-id="${vehicle.id}">Delete</button>
                    </td>
                </tr>
            `).join('');
            
            // Add event listeners to vehicle buttons
            document.querySelectorAll('.view-vehicle').forEach(btn => {
                btn.addEventListener('click', function() {
                    const vehicleId = this.getAttribute('data-id');
                    viewVehicleDetails(vehicleId);
                });
            });
            
            document.querySelectorAll('.edit-vehicle').forEach(btn => {
                btn.addEventListener('click', function() {
                    const vehicleId = this.getAttribute('data-id');
                    editVehicle(vehicleId);
                });
            });
            
            document.querySelectorAll('.delete-vehicle').forEach(btn => {
                btn.addEventListener('click', function() {
                    const vehicleId = this.getAttribute('data-id');
                    deleteVehicle(vehicleId);
                });
            });
            
            // Load vehicle history
            const vehicleHistoryTableBody = document.getElementById('vehicleHistoryTableBody');
            const vehicleRentals = systemData.rentals.filter(rental => 
                systemData.vehicles.some(vehicle => vehicle.id === rental.vehicleId)
            );
            
            vehicleHistoryTableBody.innerHTML = vehicleRentals.map(rental => {
                const vehicle = systemData.vehicles.find(v => v.id === rental.vehicleId);
                return `
                    <tr>
                        <td>${vehicle ? vehicle.name : 'Unknown'}</td>
                        <td>${rental.customerName}</td>
                        <td>${rental.startDate}</td>
                        <td>${rental.endDate}</td>
                        <td>${rental.totalAmount} AED</td>
                        <td><span class="badge ${rental.status === 'Active' ? 'bg-success' : 'bg-secondary'}">${rental.status}</span></td>
                    </tr>
                `;
            }).join('');
        }

        // View vehicle details
        function viewVehicleDetails(vehicleId) {
            const vehicle = systemData.vehicles.find(v => v.id === vehicleId);
            if (!vehicle) return;
            
            const vehicleDetailsContent = document.getElementById('vehicleDetailsContent');
            vehicleDetailsContent.innerHTML = `
                <div class="row">
                    <div class="col-md-4">
                        ${vehicle.image ? `<img src="${vehicle.image}" class="img-fluid" alt="${vehicle.name}">` : '<i class="fas fa-car fa-5x text-muted"></i>'}
                    </div>
                    <div class="col-md-8">
                        <h4>${vehicle.name}</h4>
                        <table class="table table-bordered">
                            <tr>
                                <th>Model</th>
                                <td>${vehicle.model}</td>
                            </tr>
                            <tr>
                                <th>Color</th>
                                <td>${vehicle.color}</td>
                            </tr>
                            <tr>
                                <th>Plate Number</th>
                                <td>${vehicle.plate}</td>
                            </tr>
                            <tr>
                                <th>VIN #</th>
                                <td>${vehicle.vin}</td>
                            </tr>
                            <tr>
                                <th>Odometer</th>
                                <td>${vehicle.odometer}</td>
                            </tr>
                            <tr>
                                <th>Rental Price</th>
                                <td>${vehicle.rentalPrice} AED per day</td>
                            </tr>
                            <tr>
                                <th>Status</th>
                                <td><span class="badge ${getStatusBadgeClass(vehicle.status)}">${vehicle.status}</span></td>
                            </tr>
                        </table>
                    </div>
                </div>
                <div class="row mt-3">
                    <div class="col-12">
                        <h5>Rental History</h5>
                        <div class="table-responsive">
                            <table class="table table-sm">
                                <thead>
                                    <tr>
                                        <th>Customer</th>
                                        <th>Start Date</th>
                                        <th>End Date</th>
                                        <th>Amount</th>
                                        <th>Status</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${systemData.rentals.filter(r => r.vehicleId === vehicleId).map(rental => `
                                        <tr>
                                            <td>${rental.customerName}</td>
                                            <td>${rental.startDate}</td>
                                            <td>${rental.endDate}</td>
                                            <td>${rental.totalAmount} AED</td>
                                            <td><span class="badge ${rental.status === 'Active' ? 'bg-success' : 'bg-secondary'}">${rental.status}</span></td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            `;
            
            document.getElementById('vehicleDetailsCard').style.display = 'block';
        }

        // Close vehicle details
        function closeVehicleDetails() {
            document.getElementById('vehicleDetailsCard').style.display = 'none';
        }

        // Edit vehicle
        function editVehicle(vehicleId) {
            // Implementation for editing vehicle
            alert('Edit vehicle functionality would be implemented here');
        }

        // Delete vehicle
        function deleteVehicle(vehicleId) {
            if (confirm('Are you sure you want to delete this vehicle?')) {
                systemData.vehicles = systemData.vehicles.filter(v => v.id !== vehicleId);
                saveData();
                loadVehicleData();
                alert('Vehicle deleted successfully!');
            }
        }

        // Handle add customer
        function handleAddCustomer(e) {
            e.preventDefault();
            
            const customer = {
                id: generateId(),
                fullName: document.getElementById('customerFullName').value,
                age: parseInt(document.getElementById('customerAge').value),
                idNumber: document.getElementById('customerId').value,
                nationality: document.getElementById('customerNationality').value,
                contact: document.getElementById('customerContact').value,
                address: document.getElementById('customerAddress').value,
                guaranteeDoc: null,
                totalDebt: 0,
                createdAt: new Date().toISOString()
            };
            
            // Handle document upload
            const docInput = document.getElementById('guaranteeDoc');
            if (docInput.files.length > 0) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    customer.guaranteeDoc = e.target.result;
                    completeAddCustomer(customer);
                };
                reader.readAsDataURL(docInput.files[0]);
            } else {
                completeAddCustomer(customer);
            }
        }

        // Complete adding customer
        function completeAddCustomer(customer) {
            systemData.customers.push(customer);
            saveData();
            
            alert('Customer added successfully!');
            document.getElementById('addCustomerForm').reset();
            
            // Switch to customer list tab
            document.querySelector('a[href="#customerList"]').click();
            loadCustomerData();
        }

        // Load customer data
        function loadCustomerData() {
            const customerTableBody = document.getElementById('customerTableBody');
            customerTableBody.innerHTML = systemData.customers.map(customer => `
                <tr>
                    <td>${customer.fullName}</td>
                    <td>${customer.age}</td>
                    <td>${customer.idNumber}</td>
                    <td>${customer.nationality}</td>
                    <td>${customer.contact}</td>
                    <td>${customer.totalDebt} AED</td>
                    <td>
                        <button class="btn btn-sm btn-info view-customer" data-id="${customer.id}">View</button>
                        <button class="btn btn-sm btn-warning edit-customer" data-id="${customer.id}">Edit</button>
                        <button class="btn btn-sm btn-danger delete-customer" data-id="${customer.id}">Delete</button>
                    </td>
                </tr>
            `).join('');
            
            // Add event listeners to customer buttons
            document.querySelectorAll('.view-customer').forEach(btn => {
                btn.addEventListener('click', function() {
                    const customerId = this.getAttribute('data-id');
                    viewCustomerDetails(customerId);
                });
            });
            
            document.querySelectorAll('.edit-customer').forEach(btn => {
                btn.addEventListener('click', function() {
                    const customerId = this.getAttribute('data-id');
                    editCustomer(customerId);
                });
            });
            
            document.querySelectorAll('.delete-customer').forEach(btn => {
                btn.addEventListener('click', function() {
                    const customerId = this.getAttribute('data-id');
                    deleteCustomer(customerId);
                });
            });
        }

        // View customer details
        function viewCustomerDetails(customerId) {
            const customer = systemData.customers.find(c => c.id === customerId);
            if (!customer) return;
            
            const customerDetailsContent = document.getElementById('customerDetailsContent');
            customerDetailsContent.innerHTML = `
                <div class="row">
                    <div class="col-md-6">
                        <h4>${customer.fullName}</h4>
                        <table class="table table-bordered">
                            <tr>
                                <th>Age</th>
                                <td>${customer.age}</td>
                            </tr>
                            <tr>
                                <th>ID Number</th>
                                <td>${customer.idNumber}</td>
                            </tr>
                            <tr>
                                <th>Nationality</th>
                                <td>${customer.nationality}</td>
                            </tr>
                            <tr>
                                <th>Contact</th>
                                <td>${customer.contact}</td>
                            </tr>
                            <tr>
                                <th>Address</th>
                                <td>${customer.address}</td>
                            </tr>
                            <tr>
                                <th>Total Debt</th>
                                <td>${customer.totalDebt} AED</td>
                            </tr>
                        </table>
                    </div>
                    <div class="col-md-6">
                        ${customer.guaranteeDoc ? `
                            <h5>Guarantee Document</h5>
                            <img src="${customer.guaranteeDoc}" class="img-fluid" alt="Guarantee Document">
                        ` : ''}
                    </div>
                </div>
                <div class="row mt-3">
                    <div class="col-12">
                        <h5>Rental History</h5>
                        <div class="table-responsive">
                            <table class="table table-sm">
                                <thead>
                                    <tr>
                                        <th>Vehicle</th>
                                        <th>Start Date</th>
                                        <th>End Date</th>
                                        <th>Amount</th>
                                        <th>Status</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${systemData.rentals.filter(r => r.customerId === customerId).map(rental => {
                                        const vehicle = systemData.vehicles.find(v => v.id === rental.vehicleId);
                                        return `
                                            <tr>
                                                <td>${vehicle ? vehicle.name : 'Unknown'}</td>
                                                <td>${rental.startDate}</td>
                                                <td>${rental.endDate}</td>
                                                <td>${rental.totalAmount} AED</td>
                                                <td><span class="badge ${rental.status === 'Active' ? 'bg-success' : 'bg-secondary'}">${rental.status}</span></td>
                                            </tr>
                                        `;
                                    }).join('')}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            `;
            
            document.getElementById('customerDetailsCard').style.display = 'block';
        }

        // Close customer details
        function closeCustomerDetails() {
            document.getElementById('customerDetailsCard').style.display = 'none';
        }

        // Edit customer
        function editCustomer(customerId) {
            // Implementation for editing customer
            alert('Edit customer functionality would be implemented here');
        }

        // Delete customer
        function deleteCustomer(customerId) {
            if (confirm('Are you sure you want to delete this customer?')) {
                systemData.customers = systemData.customers.filter(c => c.id !== customerId);
                saveData();
                loadCustomerData();
                alert('Customer deleted successfully!');
            }
        }

        // Handle create rental
        function handleCreateRental(e) {
            e.preventDefault();
            
            const customerInput = document.getElementById('rentalCustomer').value;
            const vehicleInput = document.getElementById('rentalVehicle').value;
            
            // Find customer and vehicle by name
            const customer = systemData.customers.find(c => c.fullName === customerInput);
            const vehicle = systemData.vehicles.find(v => v.name === vehicleInput);
            
            if (!customer) {
                alert('Customer not found!');
                return;
            }
            
            if (!vehicle) {
                alert('Vehicle not found!');
                return;
            }
            
            if (vehicle.status !== 'Available') {
                alert('Vehicle is not available for rental!');
                return;
            }
            
            const rental = {
                id: generateId(),
                invoiceCode: document.getElementById('invoiceCode').value || generateInvoiceCode(),
                customerId: customer.id,
                customerName: customer.fullName,
                vehicleId: vehicle.id,
                vehicleName: vehicle.name,
                rentalAmount: parseFloat(document.getElementById('rentalAmount').value),
                rentalDays: parseInt(document.getElementById('rentalDays').value),
                startDate: document.getElementById('rentalStartDate').value,
                endDate: document.getElementById('rentalEndDate').value,
                totalAmount: parseFloat(document.getElementById('rentalAmount').value) * parseInt(document.getElementById('rentalDays').value),
                status: 'Active',
                createdAt: new Date().toISOString()
            };
            
            systemData.rentals.push(rental);
            
            // Update vehicle status
            vehicle.status = 'Rented';
            
            saveData();
            
            alert('Rental created successfully!');
            document.getElementById('createRentalForm').reset();
            
            // Print invoice
            printInvoice(rental);
            
            loadRentalData();
        }

        // Load rental data
        function loadRentalData() {
            const rentalTableBody = document.getElementById('rentalTableBody');
            rentalTableBody.innerHTML = systemData.rentals.map(rental => `
                <tr>
                    <td>${rental.invoiceCode}</td>
                    <td>${rental.customerName}</td>
                    <td>${rental.vehicleName}</td>
                    <td>${rental.startDate}</td>
                    <td>${rental.endDate}</td>
                    <td>${rental.totalAmount} AED</td>
                    <td><span class="badge ${rental.status === 'Active' ? 'bg-success' : 'bg-secondary'}">${rental.status}</span></td>
                    <td>
                        <button class="btn btn-sm btn-info print-invoice" data-id="${rental.id}">Print</button>
                        ${rental.status === 'Active' ? `<button class="btn btn-sm btn-warning return-vehicle" data-id="${rental.id}">Return</button>` : ''}
                    </td>
                </tr>
            `).join('');
            
            // Add event listeners to rental buttons
            document.querySelectorAll('.print-invoice').forEach(btn => {
                btn.addEventListener('click', function() {
                    const rentalId = this.getAttribute('data-id');
                    printRentalInvoice(rentalId);
                });
            });
            
            document.querySelectorAll('.return-vehicle').forEach(btn => {
                btn.addEventListener('click', function() {
                    const rentalId = this.getAttribute('data-id');
                    initiateVehicleReturn(rentalId);
                });
            });
        }

        // Print rental invoice
        function printRentalInvoice(rentalId) {
            const rental = systemData.rentals.find(r => r.id === rentalId);
            if (!rental) return;
            
            printInvoice(rental);
        }

        // Print invoice
        function printInvoice(rental) {
            // Set print content
            document.getElementById('printInvoiceCode').textContent = rental.invoiceCode;
            document.getElementById('printInvoiceDate').textContent = new Date().toISOString().split('T')[0];
            document.getElementById('printCustomerName').textContent = rental.customerName;
            document.getElementById('printVehicleName').textContent = rental.vehicleName;
            
            const customer = systemData.customers.find(c => c.id === rental.customerId);
            if (customer) {
                document.getElementById('printCustomerId').textContent = customer.idNumber;
                document.getElementById('printCustomerAddress').textContent = customer.address;
            }
            
            document.getElementById('printRentalAmount').textContent = `${rental.rentalAmount} AED`;
            document.getElementById('printRentalDays').textContent = rental.rentalDays;
            document.getElementById('printTotalAmount').textContent = `${rental.totalAmount} AED`;
            
            // Set system name and logo for printing
            document.getElementById('printSystemName').textContent = systemData.settings.systemName;
            
            // Show print dialog
            const printContent = document.getElementById('invoicePrint');
            printContent.style.display = 'block';
            
            window.print();
            
            printContent.style.display = 'none';
        }

        // Initiate vehicle return
        function initiateVehicleReturn(rentalId) {
            const rental = systemData.rentals.find(r => r.id === rentalId);
            if (!rental) return;
            
            // Switch to returns tab
            document.querySelector('a[href="#returns"]').click();
            
            // Pre-fill the return form
            document.getElementById('returnInvoiceSearch').value = rental.invoiceCode;
            searchInvoiceForReturn();
        }

        // Search invoice for return
        function searchInvoiceForReturn() {
            const invoiceCode = document.getElementById('returnInvoiceSearch').value;
            const rental = systemData.rentals.find(r => r.invoiceCode === invoiceCode && r.status === 'Active');
            
            if (!rental) {
                alert('Active rental with this invoice code not found!');
                return;
            }
            
            document.getElementById('returnCustomer').value = rental.customerName;
            document.getElementById('returnVehicle').value = rental.vehicleName;
            document.getElementById('returnRentalStartDate').value = rental.startDate;
            document.getElementById('returnExpectedDate').value = rental.endDate;
            
            document.getElementById('returnFormContainer').style.display = 'block';
        }

        // Handle return vehicle
        function handleReturnVehicle(e) {
            e.preventDefault();
            
            const invoiceCode = document.getElementById('returnInvoiceSearch').value;
            const rental = systemData.rentals.find(r => r.invoiceCode === invoiceCode && r.status === 'Active');
            
            if (!rental) {
                alert('Active rental with this invoice code not found!');
                return;
            }
            
            const returnRecord = {
                id: generateId(),
                rentalId: rental.id,
                invoiceCode: rental.invoiceCode,
                customerId: rental.customerId,
                customerName: rental.customerName,
                vehicleId: rental.vehicleId,
                vehicleName: rental.vehicleName,
                actualReturnDate: document.getElementById('returnActualDate').value,
                odometer: parseInt(document.getElementById('returnOdometer').value),
                fuelLevel: document.getElementById('returnFuelLevel').value,
                condition: document.getElementById('returnCondition').value,
                notes: document.getElementById('returnNotes').value,
                createdAt: new Date().toISOString()
            };
            
            systemData.returns.push(returnRecord);
            
            // Update rental status
            rental.status = 'Completed';
            
            // Update vehicle status and odometer
            const vehicle = systemData.vehicles.find(v => v.id === rental.vehicleId);
            if (vehicle) {
                vehicle.status = 'Available';
                vehicle.odometer = returnRecord.odometer;
            }
            
            saveData();
            
            alert('Vehicle returned successfully!');
            document.getElementById('returnVehicleForm').reset();
            document.getElementById('returnFormContainer').style.display = 'none';
            
            loadReturnData();
        }

        // Load return data
        function loadReturnData() {
            const returnHistoryTableBody = document.getElementById('returnHistoryTableBody');
            returnHistoryTableBody.innerHTML = systemData.returns.map(returnRecord => `
                <tr>
                    <td>${returnRecord.invoiceCode}</td>
                    <td>${returnRecord.customerName}</td>
                    <td>${returnRecord.vehicleName}</td>
                    <td>${returnRecord.actualReturnDate}</td>
                    <td>${returnRecord.fuelLevel}</td>
                    <td>${returnRecord.condition}</td>
                    <td>
                        <button class="btn btn-sm btn-info view-return" data-id="${returnRecord.id}">View</button>
                    </td>
                </tr>
            `).join('');
        }

        // Handle schedule maintenance
        function handleScheduleMaintenance(e) {
            e.preventDefault();
            
            const vehicleInput = document.getElementById('maintenanceVehicle').value;
            const vehicle = systemData.vehicles.find(v => v.name === vehicleInput);
            
            if (!vehicle) {
                alert('Vehicle not found!');
                return;
            }
            
            const maintenance = {
                id: generateId(),
                vehicleId: vehicle.id,
                vehicleName: vehicle.name,
                type: document.getElementById('maintenanceType').value,
                date: document.getElementById('maintenanceDate').value,
                cost: parseFloat(document.getElementById('maintenanceCost').value),
                description: document.getElementById('maintenanceDescription').value,
                status: 'Scheduled',
                createdAt: new Date().toISOString()
            };
            
            systemData.maintenance.push(maintenance);
            
            // Update vehicle status if needed
            if (maintenance.type === 'Major Repair') {
                vehicle.status = 'Maintenance';
            }
            
            saveData();
            
            alert('Maintenance scheduled successfully!');
            document.getElementById('scheduleMaintenanceForm').reset();
            
            loadMaintenanceData();
        }

        // Load maintenance data
        function loadMaintenanceData() {
            const maintenanceTableBody = document.getElementById('maintenanceTableBody');
            maintenanceTableBody.innerHTML = systemData.maintenance.map(maintenance => `
                <tr class="${maintenance.status === 'Scheduled' ? 'maintenance-status' : ''}">
                    <td>${maintenance.vehicleName}</td>
                    <td>${maintenance.type}</td>
                    <td>${maintenance.date}</td>
                    <td>${maintenance.cost} AED</td>
                    <td><span class="badge ${maintenance.status === 'Scheduled' ? 'bg-warning' : 'bg-success'}">${maintenance.status}</span></td>
                    <td>
                        <button class="btn btn-sm btn-info view-maintenance" data-id="${maintenance.id}">View</button>
                        ${maintenance.status === 'Scheduled' ? `<button class="btn btn-sm btn-success complete-maintenance" data-id="${maintenance.id}">Complete</button>` : ''}
                    </td>
                </tr>
            `).join('');
            
            // Add event listeners to maintenance buttons
            document.querySelectorAll('.complete-maintenance').forEach(btn => {
                btn.addEventListener('click', function() {
                    const maintenanceId = this.getAttribute('data-id');
                    completeMaintenance(maintenanceId);
                });
            });
        }

        // Complete maintenance
        function completeMaintenance(maintenanceId) {
            const maintenance = systemData.maintenance.find(m => m.id === maintenanceId);
            if (!maintenance) return;
            
            maintenance.status = 'Completed';
            
            // Update vehicle status if it was in maintenance
            const vehicle = systemData.vehicles.find(v => v.id === maintenance.vehicleId);
            if (vehicle && vehicle.status === 'Maintenance') {
                vehicle.status = 'Available';
            }
            
            saveData();
            loadMaintenanceData();
            
            alert('Maintenance completed successfully!');
        }

        // Handle record payment
        function handleRecordPayment(e) {
            e.preventDefault();
            
            const invoiceCode = document.getElementById('paymentInvoice').value;
            const rental = systemData.rentals.find(r => r.invoiceCode === invoiceCode);
            
            if (!rental) {
                alert('Rental with this invoice code not found!');
                return;
            }
            
            const payment = {
                id: generateId(),
                rentalId: rental.id,
                invoiceCode: rental.invoiceCode,
                customerId: rental.customerId,
                customerName: rental.customerName,
                amount: parseFloat(document.getElementById('paymentAmount').value),
                date: document.getElementById('paymentDate').value,
                method: document.getElementById('paymentMethod').value,
                notes: document.getElementById('paymentNotes').value,
                createdAt: new Date().toISOString()
            };
            
            systemData.payments.push(payment);
            
            saveData();
            
            alert('Payment recorded successfully!');
            document.getElementById('recordPaymentForm').reset();
            
            loadPaymentData();
        }

        // Load payment data
        function loadPaymentData() {
            const paymentTableBody = document.getElementById('paymentTableBody');
            paymentTableBody.innerHTML = systemData.payments.map(payment => `
                <tr>
                    <td>${payment.invoiceCode}</td>
                    <td>${payment.customerName}</td>
                    <td>${payment.amount} AED</td>
                    <td>${payment.date}</td>
                    <td>${payment.method}</td>
                    <td>
                        <button class="btn btn-sm btn-info view-payment" data-id="${payment.id}">View</button>
                    </td>
                </tr>
            `).join('');
        }

        // Handle add fine
        function handleAddFine(e) {
            e.preventDefault();
            
            const invoiceCode = document.getElementById('fineInvoice').value;
            const rental = systemData.rentals.find(r => r.invoiceCode === invoiceCode);
            
            if (!rental) {
                alert('Rental with this invoice code not found!');
                return;
            }
            
            const fine = {
                id: generateId(),
                rentalId: rental.id,
                invoiceCode: rental.invoiceCode,
                customerId: rental.customerId,
                customerName: rental.customerName,
                type: document.getElementById('fineType').value,
                amount: parseFloat(document.getElementById('fineAmount').value),
                date: document.getElementById('fineDate').value,
                description: document.getElementById('fineDescription').value,
                status: 'Unpaid',
                createdAt: new Date().toISOString()
            };
            
            systemData.fines.push(fine);
            
            // Update customer debt
            const customer = systemData.customers.find(c => c.id === rental.customerId);
            if (customer) {
                customer.totalDebt += fine.amount;
            }
            
            saveData();
            
            alert('Fine added successfully!');
            document.getElementById('addFineForm').reset();
            
            loadFineData();
        }

        // Load fine data
        function loadFineData() {
            const fineTableBody = document.getElementById('fineTableBody');
            fineTableBody.innerHTML = systemData.fines.map(fine => `
                <tr>
                    <td>${fine.invoiceCode}</td>
                    <td>${fine.customerName}</td>
                    <td>${fine.type}</td>
                    <td>${fine.amount} AED</td>
                    <td>${fine.date}</td>
                    <td><span class="badge ${fine.status === 'Unpaid' ? 'bg-danger' : 'bg-success'}">${fine.status}</span></td>
                    <td>
                        <button class="btn btn-sm btn-info view-fine" data-id="${fine.id}">View</button>
                        ${fine.status === 'Unpaid' ? `<button class="btn btn-sm btn-success pay-fine" data-id="${fine.id}">Pay</button>` : ''}
                    </td>
                </tr>
            `).join('');
            
            // Add event listeners to fine buttons
            document.querySelectorAll('.pay-fine').forEach(btn => {
                btn.addEventListener('click', function() {
                    const fineId = this.getAttribute('data-id');
                    payFine(fineId);
                });
            });
        }

        // Pay fine
        function payFine(fineId) {
            const fine = systemData.fines.find(f => f.id === fineId);
            if (!fine) return;
            
            fine.status = 'Paid';
            
            // Update customer debt
            const customer = systemData.customers.find(c => c.id === fine.customerId);
            if (customer) {
                customer.totalDebt -= fine.amount;
            }
            
            saveData();
            loadFineData();
            
            alert('Fine paid successfully!');
        }

        // Handle F.RETU.RENT form
        function handleFrrForm(e) {
            e.preventDefault();
            
            const invoiceCode = document.getElementById('frrInvoiceSearch').value;
            const rental = systemData.rentals.find(r => r.invoiceCode === invoiceCode && r.status === 'Active');
            
            if (!rental) {
                alert('Active rental with this invoice code not found!');
                return;
            }
            
            const frrRecord = {
                id: generateId(),
                rentalId: rental.id,
                invoiceCode: rental.invoiceCode,
                customerId: rental.customerId,
                customerName: rental.customerName,
                vehicleId: rental.vehicleId,
                vehicleName: rental.vehicleName,
                actualReturnDate: document.getElementById('frrActualDate').value,
                odometer: parseInt(document.getElementById('frrOdometer').value),
                fuelLevel: document.getElementById('frrFuelLevel').value,
                condition: document.getElementById('frrCondition').value,
                notes: document.getElementById('frrNotes').value,
                createdAt: new Date().toISOString()
            };
            
            // Check if this is a duplicate of a regular return
            const existingReturn = systemData.returns.find(r => r.rentalId === rental.id);
            if (!existingReturn) {
                systemData.returns.push(frrRecord);
            }
            
            // Update rental status
            rental.status = 'Completed';
            
            // Update vehicle status and odometer
            const vehicle = systemData.vehicles.find(v => v.id === rental.vehicleId);
            if (vehicle) {
                vehicle.status = 'Available';
                vehicle.odometer = frrRecord.odometer;
            }
            
            saveData();
            
            alert('F.RETU.RENT completed successfully!');
            document.getElementById('frrForm').reset();
            document.getElementById('frrFormContainer').style.display = 'none';
            
            loadFrrData();
        }

        // Search invoice for F.RETU.RENT
        function searchInvoiceForFrr() {
            const invoiceCode = document.getElementById('frrInvoiceSearch').value;
            const rental = systemData.rentals.find(r => r.invoiceCode === invoiceCode && r.status === 'Active');
            
            if (!rental) {
                alert('Active rental with this invoice code not found!');
                return;
            }
            
            document.getElementById('frrCustomer').value = rental.customerName;
            document.getElementById('frrVehicle').value = rental.vehicleName;
            document.getElementById('frrRentalStartDate').value = rental.startDate;
            document.getElementById('frrExpectedDate').value = rental.endDate;
            
            document.getElementById('frrFormContainer').style.display = 'block';
        }

        // Load F.RETU.RENT data
        function loadFrrData() {
            const frrHistoryTableBody = document.getElementById('frrHistoryTableBody');
            frrHistoryTableBody.innerHTML = systemData.returns.map(returnRecord => `
                <tr>
                    <td>${returnRecord.invoiceCode}</td>
                    <td>${returnRecord.customerName}</td>
                    <td>${returnRecord.vehicleName}</td>
                    <td>${returnRecord.actualReturnDate}</td>
                    <td>${returnRecord.fuelLevel}</td>
                    <td>${returnRecord.condition}</td>
                    <td>
                        <button class="btn btn-sm btn-info view-frr" data-id="${returnRecord.id}">View</button>
                    </td>
                </tr>
            `).join('');
        }

        // Handle generate report
        function handleGenerateReport(e) {
            e.preventDefault();
            
            const reportType = document.getElementById('reportType').value;
            const startDate = document.getElementById('reportStartDate').value;
            const endDate = document.getElementById('reportEndDate').value;
            
            if (!reportType || !startDate || !endDate) {
                alert('Please fill all fields');
                return;
            }
            
            let reportData = '';
            
            switch(reportType) {
                case 'rental':
                    reportData = generateRentalReport(startDate, endDate);
                    break;
                case 'revenue':
                    reportData = generateRevenueReport(startDate, endDate);
                    break;
                case 'vehicle':
                    reportData = generateVehicleReport(startDate, endDate);
                    break;
                case 'customer':
                    reportData = generateCustomerReport(startDate, endDate);
                    break;
            }
            
            document.getElementById('reportResults').innerHTML = reportData;
        }

        // Generate rental report
        function generateRentalReport(startDate, endDate) {
            const rentalsInPeriod = systemData.rentals.filter(r => 
                r.startDate >= startDate && r.startDate <= endDate
            );
            
            return `
                <h4>Rental Report (${startDate} to ${endDate})</h4>
                <div class="table-responsive">
                    <table class="table table-bordered">
                        <thead>
                            <tr>
                                <th>Invoice Code</th>
                                <th>Customer</th>
                                <th>Vehicle</th>
                                <th>Start Date</th>
                                <th>End Date</th>
                                <th>Amount</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${rentalsInPeriod.map(rental => `
                                <tr>
                                    <td>${rental.invoiceCode}</td>
                                    <td>${rental.customerName}</td>
                                    <td>${rental.vehicleName}</td>
                                    <td>${rental.startDate}</td>
                                    <td>${rental.endDate}</td>
                                    <td>${rental.totalAmount} AED</td>
                                    <td>${rental.status}</td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                </div>
                <p><strong>Total Rentals:</strong> ${rentalsInPeriod.length}</p>
                <p><strong>Total Revenue:</strong> ${rentalsInPeriod.reduce((sum, rental) => sum + rental.totalAmount, 0)} AED</p>
            `;
        }

        // Generate revenue report
        function generateRevenueReport(startDate, endDate) {
            const paymentsInPeriod = systemData.payments.filter(p => 
                p.date >= startDate && p.date <= endDate
            );
            
            const totalRevenue = paymentsInPeriod.reduce((sum, payment) => sum + payment.amount, 0);
            
            return `
                <h4>Revenue Report (${startDate} to ${endDate})</h4>
                <div class="table-responsive">
                    <table class="table table-bordered">
                        <thead>
                            <tr>
                                <th>Invoice Code</th>
                                <th>Customer</th>
                                <th>Amount</th>
                                <th>Date</th>
                                <th>Method</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${paymentsInPeriod.map(payment => `
                                <tr>
                                    <td>${payment.invoiceCode}</td>
                                    <td>${payment.customerName}</td>
                                    <td>${payment.amount} AED</td>
                                    <td>${payment.date}</td>
                                    <td>${payment.method}</td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                </div>
                <p><strong>Total Payments:</strong> ${paymentsInPeriod.length}</p>
                <p><strong>Total Revenue:</strong> ${totalRevenue} AED</p>
            `;
        }

        // Generate vehicle report
        function generateVehicleReport(startDate, endDate) {
            const vehicleUtilization = systemData.vehicles.map(vehicle => {
                const vehicleRentals = systemData.rentals.filter(r => 
                    r.vehicleId === vehicle.id && 
                    r.startDate >= startDate && 
                    r.startDate <= endDate
                );
                
                const rentalDays = vehicleRentals.reduce((sum, rental) => {
                    const start = new Date(rental.startDate);
                    const end = new Date(rental.endDate);
                    const days = Math.ceil((end - start) / (1000 * 60 * 60 * 24));
                    return sum + days;
                }, 0);
                
                const totalPeriodDays = Math.ceil((new Date(endDate) - new Date(startDate)) / (1000 * 60 * 60 * 24)) + 1;
                const utilizationRate = (rentalDays / totalPeriodDays) * 100;
                
                return {
                    vehicle: vehicle.name,
                    rentalCount: vehicleRentals.length,
                    rentalDays,
                    utilizationRate: utilizationRate.toFixed(2)
                };
            });
            
            return `
                <h4>Vehicle Utilization Report (${startDate} to ${endDate})</h4>
                <div class="table-responsive">
                    <table class="table table-bordered">
                        <thead>
                            <tr>
                                <th>Vehicle</th>
                                <th>Rental Count</th>
                                <th>Rental Days</th>
                                <th>Utilization Rate</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${vehicleUtilization.map(util => `
                                <tr>
                                    <td>${util.vehicle}</td>
                                    <td>${util.rentalCount}</td>
                                    <td>${util.rentalDays}</td>
                                    <td>${util.utilizationRate}%</td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                </div>
            `;
        }

        // Generate customer report
        function generateCustomerReport(startDate, endDate) {
            const customerActivity = systemData.customers.map(customer => {
                const customerRentals = systemData.rentals.filter(r => 
                    r.customerId === customer.id && 
                    r.startDate >= startDate && 
                    r.startDate <= endDate
                );
                
                const totalSpent = customerRentals.reduce((sum, rental) => sum + rental.totalAmount, 0);
                
                return {
                    customer: customer.fullName,
                    rentalCount: customerRentals.length,
                    totalSpent
                };
            }).filter(c => c.rentalCount > 0);
            
            return `
                <h4>Customer Activity Report (${startDate} to ${endDate})</h4>
                <div class="table-responsive">
                    <table class="table table-bordered">
                        <thead>
                            <tr>
                                <th>Customer</th>
                                <th>Rental Count</th>
                                <th>Total Spent</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${customerActivity.map(activity => `
                                <tr>
                                    <td>${activity.customer}</td>
                                    <td>${activity.rentalCount}</td>
                                    <td>${activity.totalSpent} AED</td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                </div>
            `;
        }

        // Handle save settings
        function handleSaveSettings(e) {
            e.preventDefault();
            
            systemData.settings.systemName = document.getElementById('systemName').value;
            systemData.settings.currency = document.getElementById('currency').value;
            systemData.settings.dateFormat = document.getElementById('dateFormat').value;
            
            // Handle logo upload
            const logoInput = document.getElementById('systemLogo');
            if (logoInput.files.length > 0) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    systemData.settings.logo = e.target.result;
                    completeSaveSettings();
                };
                reader.readAsDataURL(logoInput.files[0]);
            } else {
                completeSaveSettings();
            }
        }

        // Complete save settings
        function completeSaveSettings() {
            saveData();
            
            // Update UI with new settings
            document.getElementById('headerSystemName').textContent = systemData.settings.systemName;
            document.getElementById('sidebarSystemName').textContent = systemData.settings.systemName;
            
            if (systemData.settings.logo) {
                document.getElementById('headerLogo').src = systemData.settings.logo;
                document.getElementById('headerLogo').style.display = 'inline';
                document.getElementById('sidebarLogo').src = systemData.settings.logo;
                document.getElementById('sidebarLogo').style.display = 'block';
            }
            
            alert('Settings saved successfully!');
        }

        // Load settings data
        function loadSettingsData() {
            document.getElementById('systemName').value = systemData.settings.systemName;
            document.getElementById('currency').value = systemData.settings.currency;
            document.getElementById('dateFormat').value = systemData.settings.dateFormat;
            
            // Load roles data
            const rolesTableBody = document.getElementById('rolesTableBody');
            rolesTableBody.innerHTML = systemData.roles.map(role => `
                <tr>
                    <td>${role.name}</td>
                    <td>${role.permissions.join(', ')}</td>
                    <td>${systemData.users.filter(u => u.role === role.name).length}</td>
                </tr>
            `).join('');
            
            // Load users for management
            const usersTableBody = document.getElementById('usersTableBody');
            usersTableBody.innerHTML = systemData.users.map(user => `
                <tr>
                    <td>${user.username}</td>
                    <td>${user.fullName}</td>
                    <td>${user.role}</td>
                    <td><span class="badge ${user.active ? 'bg-success' : 'bg-danger'}">${user.active ? 'Active' : 'Inactive'}</span></td>
                    <td>
                        <button class="btn btn-sm btn-warning edit-user" data-id="${user.username}">Edit</button>
                        <button class="btn btn-sm btn-danger delete-user" data-id="${user.username}">Delete</button>
                    </td>
                </tr>
            `).join('');
            
            // Load roles for management
            const rolesManagementTableBody = document.getElementById('rolesManagementTableBody');
            rolesManagementTableBody.innerHTML = systemData.roles.map(role => `
                <tr>
                    <td>${role.name}</td>
                    <td>${role.permissions.join(', ')}</td>
                    <td>
                        <button class="btn btn-sm btn-warning edit-role" data-id="${role.name}">Edit</button>
                        <button class="btn btn-sm btn-danger delete-role" data-id="${role.name}">Delete</button>
                    </td>
                </tr>
            `).join('');
        }

        // Handle change password
        function handleChangePassword(e) {
            e.preventDefault();
            
            const currentPassword = document.getElementById('currentPassword').value;
            const newPassword = document.getElementById('newPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            
            if (currentUser.password !== currentPassword) {
                alert('Current password is incorrect!');
                return;
            }
            
            if (newPassword !== confirmPassword) {
                alert('New passwords do not match!');
                return;
            }
            
            // Update password
            currentUser.password = newPassword;
            
            // Update in system data
            const userIndex = systemData.users.findIndex(u => u.username === currentUser.username);
            if (userIndex !== -1) {
                systemData.users[userIndex].password = newPassword;
            }
            
            saveData();
            sessionStorage.setItem('loggedInUser', JSON.stringify(currentUser));
            
            alert('Password changed successfully!');
            document.getElementById('changePasswordForm').reset();
            
            // Close modal
            const modal = bootstrap.Modal.getInstance(document.getElementById('changePasswordModal'));
            modal.hide();
        }

        // Show add user modal
        function showAddUserModal() {
            // Populate roles dropdown
            const roleSelect = document.getElementById('newUserRole');
            roleSelect.innerHTML = '<option value="">Select role</option>' +
                systemData.roles.map(role => `<option value="${role.name}">${role.name}</option>`).join('');
            
            // Show modal
            const modal = new bootstrap.Modal(document.getElementById('addUserModal'));
            modal.show();
        }

        // Handle add user
        function handleAddUser(e) {
            e.preventDefault();
            
            const username = document.getElementById('newUsername').value;
            const fullName = document.getElementById('newUserFullName').value;
            const password = document.getElementById('newUserPassword').value;
            const role = document.getElementById('newUserRole').value;
            
            // Check if username already exists
            if (systemData.users.find(u => u.username === username)) {
                alert('Username already exists!');
                return;
            }
            
            const user = {
                username,
                password,
                fullName,
                role,
                active: true
            };
            
            systemData.users.push(user);
            saveData();
            
            alert('User added successfully!');
            document.getElementById('addUserForm').reset();
            
            // Close modal
            const modal = bootstrap.Modal.getInstance(document.getElementById('addUserModal'));
            modal.hide();
            
            // Reload settings data
            loadSettingsData();
        }

        // Show add role modal
        function showAddRoleModal() {
            // Populate permissions list
            const permissionsList = document.getElementById('permissionsList');
            const allPermissions = [
                'dashboard', 'vehicles', 'customers', 'rentals', 'returns', 
                'maintenance', 'payments', 'fines', 'reports', 'frr', 'settings'
            ];
            
            permissionsList.innerHTML = allPermissions.map(permission => `
                <div class="form-check permission-item">
                    <input class="form-check-input permission-checkbox" type="checkbox" value="${permission}" id="perm-${permission}">
                    <label class="form-check-label" for="perm-${permission}">
                        ${permission.charAt(0).toUpperCase() + permission.slice(1)}
                    </label>
                </div>
            `).join('');
            
            // Show modal
            const modal = new bootstrap.Modal(document.getElementById('addRoleModal'));
            modal.show();
        }

        // Handle add role
        function handleAddRole(e) {
            e.preventDefault();
            
            const roleName = document.getElementById('newRoleName').value;
            
            // Check if role already exists
            if (systemData.roles.find(r => r.name === roleName)) {
                alert('Role already exists!');
                return;
            }
            
            // Get selected permissions
            const selectedPermissions = Array.from(document.querySelectorAll('.permission-checkbox:checked'))
                .map(checkbox => checkbox.value);
            
            const role = {
                name: roleName,
                permissions: selectedPermissions
            };
            
            systemData.roles.push(role);
            saveData();
            
            alert('Role added successfully!');
            document.getElementById('addRoleForm').reset();
            
            // Close modal
            const modal = bootstrap.Modal.getInstance(document.getElementById('addRoleModal'));
            modal.hide();
            
            // Reload settings data
            loadSettingsData();
        }

        // Handle backup
        function handleBackup() {
            const dataStr = JSON.stringify(systemData);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            
            const exportFileDefaultName = `car-rental-backup-${new Date().toISOString().split('T')[0]}.json`;
            
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();
            
            alert('Backup created successfully!');
        }

        // Handle restore
        function handleRestore() {
            const fileInput = document.getElementById('restoreFile');
            
            if (fileInput.files.length === 0) {
                alert('Please select a backup file to restore');
                return;
            }
            
            const file = fileInput.files[0];
            const reader = new FileReader();
            
            reader.onload = function(e) {
                try {
                    const backupData = JSON.parse(e.target.result);
                    
                    if (confirm('Are you sure you want to restore from backup? This will replace all current data.')) {
                        systemData = backupData;
                        saveData();
                        
                        // Reload the application
                        location.reload();
                    }
                } catch (error) {
                    alert('Error restoring backup: Invalid file format');
                }
            };
            
            reader.readAsText(file);
        }

        // Initialize auto-suggest functionality
        function initializeAutoSuggest() {
            // Nationality suggestions
            const nationalities = [
                "Afghan", "Albanian", "Algerian", "American", "Andorran", "Angolan", "Antiguan", "Argentine", 
                "Armenian", "Australian", "Austrian", "Azerbaijani", "Bahamian", "Bahraini", "Bangladeshi", 
                "Barbadian", "Belarusian", "Belgian", "Belizean", "Beninese", "Bhutanese", "Bolivian", 
                "Bosnian", "Botswanan", "Brazilian", "British", "Bruneian", "Bulgarian", "Burkinabe", 
                "Burmese", "Burundian", "Cambodian", "Cameroonian", "Canadian", "Cape Verdean", "Central African", 
                "Chadian", "Chilean", "Chinese", "Colombian", "Comoran", "Congolese", "Costa Rican", 
                "Croatian", "Cuban", "Cypriot", "Czech", "Danish", "Djibouti", "Dominican", "Dutch", 
                "East Timorese", "Ecuadorean", "Egyptian", "Emirati", "Equatorial Guinean", "Eritrean", 
                "Estonian", "Ethiopian", "Fijian", "Filipino", "Finnish", "French", "Gabonese", "Gambian", 
                "Georgian", "German", "Ghanaian", "Greek", "Grenadian", "Guatemalan", "Guinean", "Guyanese", 
                "Haitian", "Herzegovinian", "Honduran", "Hungarian", "Icelandic", "Indian", "Indonesian", 
                "Iranian", "Iraqi", "Irish", "Israeli", "Italian", "Ivorian", "Jamaican", "Japanese", 
                "Jordanian", "Kazakh", "Kenyan", "Kittian", "Kosovar", "Kuwaiti", "Kyrgyz", "Laotian", 
                "Latvian", "Lebanese", "Liberian", "Libyan", "Liechtenstein", "Lithuanian", "Luxembourg", 
                "Macedonian", "Malagasy", "Malawian", "Malaysian", "Maldivian", "Malian", "Maltese", 
                "Marshall", "Mauritanian", "Mauritian", "Mexican", "Micronesian", "Moldovan", "Monacan", 
                "Mongolian", "Montenegrin", "Moroccan", "Mosotho", "Motswana", "Mozambican", "Namibian", 
                "Nauruan", "Nepalese", "New Zealand", "Nicaraguan", "Nigerian", "Nigerien", "North Korean", 
                "Northern Irish", "Norwegian", "Omani", "Pakistani", "Palauan", "Palestinian", "Panamanian", 
                "Papua New Guinean", "Paraguayan", "Peruvian", "Polish", "Portuguese", "Qatari", "Romanian", 
                "Russian", "Rwandan", "Saint Lucian", "Salvadoran", "Samoan", "San Marinese", "Sao Tomean", 
                "Saudi", "Scottish", "Senegalese", "Serbian", "Seychellois", "Sierra Leonean", "Singaporean", 
                "Slovak", "Slovenian", "Solomon Island", "Somali", "South African", "South Korean", "Spanish", 
                "Sri Lankan", "Sudanese", "Surinamer", "Swazi", "Swedish", "Swiss", "Syrian", "Taiwanese", 
                "Tajik", "Tanzanian", "Thai", "Togolese", "Tongan", "Trinidadian", "Tunisian", "Turkish", 
                "Tuvaluan", "Ugandan", "Ukrainian", "Uruguayan", "Uzbek", "Vanuatuan", "Venezuelan", 
                "Vietnamese", "Welsh", "Yemenite", "Zambian", "Zimbabwean"
            ];
            
            document.getElementById('customerNationality').addEventListener('input', function() {
                showSuggestions(this, nationalities, 'nationalitySuggestions');
            });
            
            // Customer suggestions for rental
            document.getElementById('rentalCustomer').addEventListener('input', function() {
                const customerNames = systemData.customers.map(c => c.fullName);
                showSuggestions(this, customerNames, 'customerSuggestions');
            });
            
            // Vehicle suggestions for rental
            document.getElementById('rentalVehicle').addEventListener('input', function() {
                const availableVehicles = systemData.vehicles.filter(v => v.status === 'Available').map(v => v.name);
                showSuggestions(this, availableVehicles, 'vehicleSuggestions');
            });
            
            // Invoice suggestions for returns
            document.getElementById('returnInvoiceSearch').addEventListener('input', function() {
                const activeRentalInvoices = systemData.rentals.filter(r => r.status === 'Active').map(r => r.invoiceCode);
                showSuggestions(this, activeRentalInvoices, 'returnInvoiceSuggestions');
            });
            
            // Vehicle suggestions for maintenance
            document.getElementById('maintenanceVehicle').addEventListener('input', function() {
                const vehicleNames = systemData.vehicles.map(v => v.name);
                showSuggestions(this, vehicleNames, 'maintenanceVehicleSuggestions');
            });
            
            // Invoice suggestions for payments
            document.getElementById('paymentInvoice').addEventListener('input', function() {
                const rentalInvoices = systemData.rentals.map(r => r.invoiceCode);
                showSuggestions(this, rentalInvoices, 'paymentInvoiceSuggestions');
            });
            
            // Invoice suggestions for fines
            document.getElementById('fineInvoice').addEventListener('input', function() {
                const rentalInvoices = systemData.rentals.map(r => r.invoiceCode);
                showSuggestions(this, rentalInvoices, 'fineInvoiceSuggestions');
            });
            
            // Invoice suggestions for F.RETU.RENT
            document.getElementById('frrInvoiceSearch').addEventListener('input', function() {
                const activeRentalInvoices = systemData.rentals.filter(r => r.status === 'Active').map(r => r.invoiceCode);
                showSuggestions(this, activeRentalInvoices, 'frrInvoiceSuggestions');
            });
            
            // Click outside to close suggestions
            document.addEventListener('click', function(e) {
                if (!e.target.matches('.suggestion-item') && !e.target.matches('.suggestion-input')) {
                    hideAllSuggestions();
                }
            });
        }

        // Show suggestions
        function showSuggestions(inputElement, suggestions, suggestionsId) {
            const inputValue = inputElement.value.toLowerCase();
            const filteredSuggestions = suggestions.filter(s => 
                s.toLowerCase().includes(inputValue)
            );
            
            const suggestionsElement = document.getElementById(suggestionsId);
            suggestionsElement.innerHTML = '';
            
            if (filteredSuggestions.length > 0 && inputValue.length > 0) {
                filteredSuggestions.forEach(suggestion => {
                    const div = document.createElement('div');
                    div.className = 'suggestion-item';
                    div.textContent = suggestion;
                    div.addEventListener('click', function() {
                        inputElement.value = suggestion;
                        hideAllSuggestions();
                    });
                    suggestionsElement.appendChild(div);
                });
                
                suggestionsElement.style.display = 'block';
                suggestionsElement.style.width = inputElement.offsetWidth + 'px';
            } else {
                suggestionsElement.style.display = 'none';
            }
        }

        // Hide all suggestions
        function hideAllSuggestions() {
            document.querySelectorAll('.suggestion-list').forEach(el => {
                el.style.display = 'none';
            });
        }

        // Search functionality handlers
        function handleVehicleSearch() {
            const searchTerm = document.getElementById('vehicleSearch').value.toLowerCase();
            const filteredVehicles = systemData.vehicles.filter(vehicle => 
                vehicle.name.toLowerCase().includes(searchTerm) ||
                vehicle.model.toLowerCase().includes(searchTerm) ||
                vehicle.plate.toLowerCase().includes(searchTerm)
            );
            
            const vehicleTableBody = document.getElementById('vehicleTableBody');
            vehicleTableBody.innerHTML = filteredVehicles.map(vehicle => `
                <tr>
                    <td>
                        ${vehicle.image ? `<img src="${vehicle.image}" class="vehicle-image" alt="${vehicle.name}">` : '<i class="fas fa-car text-muted"></i>'}
                    </td>
                    <td>${vehicle.name}</td>
                    <td>${vehicle.model}</td>
                    <td>${vehicle.color}</td>
                    <td>${vehicle.plate}</td>
                    <td>${vehicle.odometer}</td>
                    <td>${vehicle.rentalPrice} AED</td>
                    <td><span class="badge ${getStatusBadgeClass(vehicle.status)}">${vehicle.status}</span></td>
                    <td>
                        <button class="btn btn-sm btn-info view-vehicle" data-id="${vehicle.id}">View</button>
                        <button class="btn btn-sm btn-warning edit-vehicle" data-id="${vehicle.id}">Edit</button>
                        <button class="btn btn-sm btn-danger delete-vehicle" data-id="${vehicle.id}">Delete</button>
                    </td>
                </tr>
            `).join('');
            
            // Reattach event listeners
            document.querySelectorAll('.view-vehicle').forEach(btn => {
                btn.addEventListener('click', function() {
                    const vehicleId = this.getAttribute('data-id');
                    viewVehicleDetails(vehicleId);
                });
            });
        }

        // Similar search handlers for other sections...
        function handleCustomerSearch() {
            const searchTerm = document.getElementById('customerSearch').value.toLowerCase();
            const filteredCustomers = systemData.customers.filter(customer => 
                customer.fullName.toLowerCase().includes(searchTerm) ||
                customer.idNumber.toLowerCase().includes(searchTerm) ||
                customer.contact.toLowerCase().includes(searchTerm)
            );
            
            const customerTableBody = document.getElementById('customerTableBody');
            customerTableBody.innerHTML = filteredCustomers.map(customer => `
                <tr>
                    <td>${customer.fullName}</td>
                    <td>${customer.age}</td>
                    <td>${customer.idNumber}</td>
                    <td>${customer.nationality}</td>
                    <td>${customer.contact}</td>
                    <td>${customer.totalDebt} AED</td>
                    <td>
                        <button class="btn btn-sm btn-info view-customer" data-id="${customer.id}">View</button>
                        <button class="btn btn-sm btn-warning edit-customer" data-id="${customer.id}">Edit</button>
                        <button class="btn btn-sm btn-danger delete-customer" data-id="${customer.id}">Delete</button>
                    </td>
                </tr>
            `).join('');
        }

        function handleRentalSearch() {
            const searchTerm = document.getElementById('rentalSearch').value.toLowerCase();
            const filteredRentals = systemData.rentals.filter(rental => 
                rental.invoiceCode.toLowerCase().includes(searchTerm) ||
                rental.customerName.toLowerCase().includes(searchTerm) ||
                rental.vehicleName.toLowerCase().includes(searchTerm)
            );
            
            const rentalTableBody = document.getElementById('rentalTableBody');
            rentalTableBody.innerHTML = filteredRentals.map(rental => `
                <tr>
                    <td>${rental.invoiceCode}</td>
                    <td>${rental.customerName}</td>
                    <td>${rental.vehicleName}</td>
                    <td>${rental.startDate}</td>
                    <td>${rental.endDate}</td>
                    <td>${rental.totalAmount} AED</td>
                    <td><span class="badge ${rental.status === 'Active' ? 'bg-success' : 'bg-secondary'}">${rental.status}</span></td>
                    <td>
                        <button class="btn btn-sm btn-info print-invoice" data-id="${rental.id}">Print</button>
                        ${rental.status === 'Active' ? `<button class="btn btn-sm btn-warning return-vehicle" data-id="${rental.id}">Return</button>` : ''}
                    </td>
                </tr>
            `).join('');
        }

        // Initialize charts
        function initializeCharts() {
            // Vehicle status chart is initialized in loadDashboardData
        }

        // Utility functions
        function generateId() {
            return Date.now().toString(36) + Math.random().toString(36).substr(2);
        }

        function generateInvoiceCode() {
            return 'INV-' + Date.now().toString(36).toUpperCase();
        }

        function getStatusBadgeClass(status) {
            switch(status) {
                case 'Available': return 'bg-success';
                case 'Rented': return 'bg-warning';
                case 'Maintenance': return 'bg-danger';
                default: return 'bg-secondary';
            }
        }

        // Add search handlers for other sections (simplified for brevity)
        function handleReturnHistorySearch() {
            // Implementation similar to other search handlers
        }

        function handleMaintenanceSearch() {
            // Implementation similar to other search handlers
        }

        function handlePaymentSearch() {
            // Implementation similar to other search handlers
        }

        function handleFineSearch() {
            // Implementation similar to other search handlers
        }

        function handleFrrHistorySearch() {
            // Implementation similar to other search handlers
        }
    </script>
</body>
</html>